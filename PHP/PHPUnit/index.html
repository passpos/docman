

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PHPUnit latest Manual</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/_static/css/theme.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="copyright" title="版权所有" href="index.html#document-copyright" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html#document-index" class="icon icon-home"> PHPUnit
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation">1. 安装 PHPUnit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#php-phar">PHP 档案包 (PHAR)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#windows">Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#phpunit-phar">校验 PHPUnit PHAR 发行包</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#composer">Composer</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#installation-optional-packages">可选的组件包</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-writing-tests-for-phpunit">2. 编写 PHPUnit 测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tests-for-phpunit-test-dependencies">测试的依赖关系</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tests-for-phpunit-data-providers">数据供给器</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tests-for-phpunit-exceptions">对异常进行测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#php">对 PHP 错误进行测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tests-for-phpunit-output">对输出进行测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tests-for-phpunit-error-output">错误相关信息的输出</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#writing-tests-for-phpunit-error-output-edge-cases">边缘情况</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-textui">3. 命令行测试执行器</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#textui-clioptions">命令行选项</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-fixtures">4. 基境(fixture)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#setup-teardown">setUp() 多 tearDown() 少</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fixtures-sharing-fixture">基境共享</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fixtures-global-state">全局状态</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-organizing-tests">5. 组织测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#organizing-tests-filesystem">用文件系统来编排测试套件</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xml">用 XML 配置来编排测试套件</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-risky-tests">6. 有风险的测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#risky-tests-useless-tests">无用测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#risky-tests-unintentionally-covered-code">意外的代码覆盖</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#risky-tests-output-during-test-execution">测试执行期间产生的输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#risky-tests-test-execution-timeout">测试执行时长的超时限制</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#risky-tests-global-state-manipulation">全局状态篡改</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-incomplete-and-skipped-tests">7. 未完成的测试与跳过的测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#incomplete-and-skipped-tests-incomplete-tests">未完成的测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#incomplete-and-skipped-tests-skipping-tests">跳过测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#requires">用 &#64;requires 来跳过测试</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-database">8. 数据库测试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#database-supported-vendors-for-database-testing">数据库测试所支持的供应商</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#database-difficulties-in-database-testing">数据库测试的难点</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#database-the-four-stages-of-a-database-test">数据库测试的四个阶段</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-clean-up-database">1. 清理数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-set-up-fixture">2. 建立基境</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-run-test-verify-outcome-and-teardown">3–5. 运行测试、验证结果、并拆除基境</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#phpunit">PHPUnit 数据库测试用例的配置</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#getconnection">实现 getConnection()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#getdataset">实现 getDataSet()</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#ddl">数据库构架(DDL)怎么办？</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#testcase">小建议：使用你自己的抽象数据库 TestCase 类</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dataset-datatable">理解 DataSet（数据集）和 DataTable（数据表）</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-available-implementations">可用的各种实现</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-beware-of-foreign-keys">当心外键</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-implementing-your-own-datasetsdatatables">实现自有的 DataSet/DataTable</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api">数据库连接 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#database-database-assertions-api">数据库断言 API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-asserting-the-row-count-of-a-table">对表中数据行的数量作出断言</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-asserting-the-state-of-a-table">对表的状态作出断言</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-asserting-the-result-of-a-query">对查询的结果作出断言</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-asserting-the-state-of-multiple-tables">对多个表的状态作出断言</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#faq">常见问题（FAQ）</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#database-will-phpunit-re-create-the-database-schema-for-each-test">PHPUnit 会为每个测试（重新）创建数据库吗？</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#pdo">为了让数据库扩展模块正常工作，需要在应用程序中使用 PDO 吗？</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#too-much-connections">如果看到 “Too much Connections“ 错误该怎么办？</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#flat-xml-csv-null">Flat XML / CSV 数据集中如何处理 NULL？</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-test-doubles">9. 测试替身</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#stubs">Stubs （桩件）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mock-object">仿件对象(Mock Object)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#prophecy">Prophecy</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#trait">对特质(Trait)与抽象类进行模仿</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#web-web-services">对 Web 服务(Web Services)进行上桩或模仿</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#test-doubles-mocking-the-filesystem">对文件系统进行模仿</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-testing-practices">10. 测试实践</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#testing-practices-during-development">在开发过程中</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#testing-practices-during-debugging">在调试过程中</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-code-coverage-analysis">11. 代码覆盖率分析</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-coverage-analysis-metrics">用于代码覆盖率的软件衡量标准</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-coverage-analysis-whitelisting-files">将文件列入白名单</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-coverage-analysis-ignoring-code-blocks">略过代码块</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-coverage-analysis-specifying-covered-methods">指明要覆盖的方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-coverage-analysis-edge-cases">边缘情况</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-other-uses-for-tests">12. 测试的其他用途</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-uses-for-tests-agile-documentation">敏捷文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-uses-for-tests-cross-team-tests">跨团队测试</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-logging">13. Logging （日志记录）</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#xml">测试结果 (XML)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#logging-codecoverage-xml">代码覆盖率 (XML)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#text">代码覆盖率 (TEXT)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extending-phpunit">14. 扩展 PHPUnit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#phpunit-framework-testcase">PHPUnit\Framework\TestCase 的子类</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extending-phpunit-custom-assertions">编写自定义断言</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#phpunit-framework-testlistener">实现 PHPUnit\Framework\TestListener</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#phpunit-framework-test">实现 PHPUnit_Framework_Test</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-assertions">1. 断言方法的用法：静态 vs. 非静态</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertarrayhaskey">2. assertArrayHasKey()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertclasshasattribute">3. assertClassHasAttribute()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertarraysubset">4. assertArraySubset()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertclasshasstaticattribute">5. assertClassHasStaticAttribute()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertcontains">6. assertContains()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertcontainsonly">7. assertContainsOnly()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertcontainsonlyinstancesof">8. assertContainsOnlyInstancesOf()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertcount">9. assertCount()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertdirectoryexists">10. assertDirectoryExists()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertdirectoryisreadable">11. assertDirectoryIsReadable()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertdirectoryiswritable">12. assertDirectoryIsWritable()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertempty">13. assertEmpty()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertequalxmlstructure">14. assertEqualXMLStructure()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertequals">15. assertEquals()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertfalse">16. assertFalse()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertfileequals">17. assertFileEquals()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertfileexists">18. assertFileExists()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertfileisreadable">19. assertFileIsReadable()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertfileiswritable">20. assertFileIsWritable()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertgreaterthan">21. assertGreaterThan()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertgreaterthanorequal">22. assertGreaterThanOrEqual()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertinfinite">23. assertInfinite()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertinstanceof">24. assertInstanceOf()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertinternaltype">25. assertInternalType()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertisreadable">26. assertIsReadable()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertiswritable">27. assertIsWritable()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertjsonfileequalsjsonfile">28. assertJsonFileEqualsJsonFile()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertjsonstringequalsjsonfile">29. assertJsonStringEqualsJsonFile()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertjsonstringequalsjsonstring">30. assertJsonStringEqualsJsonString()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertlessthan">31. assertLessThan()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertlessthanorequal">32. assertLessThanOrEqual()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertnan">33. assertNan()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertnull">34. assertNull()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertobjecthasattribute">35. assertObjectHasAttribute()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertregexp">36. assertRegExp()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertstringmatchesformat">37. assertStringMatchesFormat()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertstringmatchesformatfile">38. assertStringMatchesFormatFile()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertsame">39. assertSame()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertstringendswith">40. assertStringEndsWith()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertstringequalsfile">41. assertStringEqualsFile()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertstringstartswith">42. assertStringStartsWith()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertthat">43. assertThat()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#asserttrue">44. assertTrue()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertxmlfileequalsxmlfile">45. assertXmlFileEqualsXmlFile()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertxmlstringequalsxmlfile">46. assertXmlStringEqualsXmlFile()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#assertxmlstringequalsxmlstring">47. assertXmlStringEqualsXmlString()</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-annotations">48. &#64;author</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#after">49. &#64;after</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#afterclass">50. &#64;afterClass</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#backupglobals">51. &#64;backupGlobals</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#backupstaticattributes">52. &#64;backupStaticAttributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#before">53. &#64;before</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#beforeclass">54. &#64;beforeClass</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#codecoverageignore">55. &#64;codeCoverageIgnore*</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#covers">56. &#64;covers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#coversdefaultclass">57. &#64;coversDefaultClass</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#coversnothing">58. &#64;coversNothing</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#dataprovider">59. &#64;dataProvider</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#depends">60. &#64;depends</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#expectedexception">61. &#64;expectedException</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#expectedexceptioncode">62. &#64;expectedExceptionCode</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#expectedexceptionmessage">63. &#64;expectedExceptionMessage</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#expectedexceptionmessageregexp">64. &#64;expectedExceptionMessageRegExp</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#group">65. &#64;group</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#large">66. &#64;large</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#medium">67. &#64;medium</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#preserveglobalstate">68. &#64;preserveGlobalState</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#requires">69. &#64;requires</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#runtestsinseparateprocesses">70. &#64;runTestsInSeparateProcesses</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#runinseparateprocess">71. &#64;runInSeparateProcess</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#small">72. &#64;small</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#test">73. &#64;test</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#testdox">74. &#64;testdox</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#ticket">75. &#64;ticket</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#uses">76. &#64;uses</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-configuration">77. XML 配置文件</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#phpunit">PHPUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#appendixes-configuration-testsuites">测试套件</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#whitelisting-files-for-code-coverage">Whitelisting Files for Code Coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#logging">Logging （日志记录）</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#appendixes-configuration-test-listeners">测试监听器</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#php-ini">设定 PHP INI 设置、常量、全局变量</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-bibliography">78. 参考书目</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">PHPUnit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>PHPUnit latest Manual</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/sebastianbergmann/phpunit-documentation-chinese/blob/master/src/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="phpunit-manual">
<h1>PHPUnit Manual</h1>
<p>Edition for PHPUnit latest. Updated on 2020 年 02 月 07 日.</p>
<p>Sebastian Bergmann</p>
<p>This work is licensed under the Creative Commons Attribution 3.0 Unported License.</p>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<span id="document-installation"></span><div class="section" id="phpunit">
<span id="installation"></span><h2>安装 PHPUnit</h2>
<p>需求
##</p>
<p>PHPUnit 7.0 需要 PHP 7.1，强烈推荐使用最新版本的 PHP。</p>
<p>PHPUnit 需要使用 <a class="reference external" href="http://php.net/manual/en/dom.setup.php">dom</a> 和 <a class="reference external" href="http://php.net/manual/en/json.installation.php">json</a> 扩展，它们通常是默认启用的。</p>
<p>PHPUnit 还需要 <a class="reference external" href="http://php.net/manual/en/pcre.installation.php">pcre</a>、<a class="reference external" href="http://php.net/manual/en/reflection.installation.php">reflection</a>、<a class="reference external" href="http://php.net/manual/en/spl.installation.php">spl</a> 扩展。这些标准扩展默认启用，并且除非修改 PHP 的构建系统和 C 源代码，否则无法禁用它们。</p>
<p>代码覆盖率分析报告功能需要 <a class="reference external" href="http://php.net/manual/en/tokenizer.installation.php">Xdebug &lt;http://xdebug.org/&gt;`_（2.5.0以上）与 `tokenizer</a> 扩展。生成 XML 格式的报告需要有 <a class="reference external" href="http://php.net/manual/en/xmlwriter.installation.php">xmlwriter</a> 扩展。</p>
<div class="section" id="php-phar">
<span id="installation-phar"></span><h3>PHP 档案包 (PHAR)</h3>
<p>要获取 PHPUnit，最简单的方法是下载 PHPUnit 的 <a class="reference external" href="http://php.net/phar">PHP 档案包 (PHAR)</a>，它将 PHPUnit 所需要的所有必要组件（以及某些可选组件）捆绑在单个文件中：</p>
<p>要使用 PHP档案包(PHAR)需要有 <a class="reference external" href="http://php.net/manual/en/phar.installation.php">phar</a> 扩展。</p>
<p>如果启用了 <a class="reference external" href="http://suhosin.org/">Suhosin</a> 扩展，需要在 <code class="docutils literal notranslate"><span class="pre">php.ini</span></code> 中允许执行 PHAR：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>suhosin.executor.include.whitelist <span class="o">=</span> phar
</pre></div>
</div>
<p>如果要全局安装 PHAR：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$  wget https://phar.phpunit.de/phpunit-7.0.phar
$  chmod +x phpunit-7.0.phar
$  sudo mv phpunit-7.0.phar /usr/local/bin/phpunit
$  phpunit --version
PHPUnit x.y.z by Sebastian Bergmann and contributors.
</pre></div>
</div>
<p>也可以直接使用下载的 PHAR 文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$  wget https://phar.phpunit.de/phpunit-7.0.phar
$  php phpunit-7.0.phar --version
PHPUnit x.y.z by Sebastian Bergmann and contributors.
</pre></div>
</div>
<div class="section" id="windows">
<span id="installation-phar-windows"></span><h4>Windows</h4>
<p>整体上说，在 Windows 下安装 PHAR 和手工`在 Windows 下安装 Composer &lt;<a class="reference external" href="https://getcomposer.org/doc/00-intro.md#installation-windows">https://getcomposer.org/doc/00-intro.md#installation-windows</a>&gt;`_ 是一样的过程：</p>
<ol class="arabic">
<li><p class="first">为 PHP 的二进制可执行文件建立一个目录，例如 <code class="file docutils literal notranslate"><span class="pre">C:\bin</span></code></p>
</li>
<li><p class="first">将 ;C:bin 附加到 <code class="docutils literal notranslate"><span class="pre">PATH</span></code> 环境变量中（<a class="reference external" href="http://stackoverflow.com/questions/6318156/adding-python-path-on-windows-7">相关帮助</a>）</p>
</li>
<li><p class="first">下载 <a class="reference external" href="https://phar.phpunit.de/phpunit-7.0.phar">https://phar.phpunit.de/phpunit-7.0.phar</a> 并将文件保存到 <code class="file docutils literal notranslate"><span class="pre">C:\bin\phpunit.phar</span></code></p>
</li>
<li><p class="first">打开命令行（例如，按 <kbd class="kbd docutils literal notranslate">Windows</kbd><kbd class="kbd docutils literal notranslate">R</kbd> » 输入 cmd » <kbd class="kbd docutils literal notranslate">ENTER</kbd>)</p>
</li>
<li><p class="first">建立外包覆批处理脚本（最后得到 <code class="file docutils literal notranslate"><span class="pre">C:\bin\phpunit.cmd</span></code>）：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\U</span>sers<span class="se">\u</span>sername&gt;  <span class="nb">cd</span> C:<span class="se">\b</span>in
C:<span class="se">\b</span>in&gt;  <span class="nb">echo</span> @php <span class="s2">&quot;%~dp0phpunit.phar&quot;</span> %* &gt; phpunit.cmd
C:<span class="se">\b</span>in&gt;  <span class="nb">exit</span>
</pre></div>
</div>
</li>
<li><p class="first">新开一个命令行窗口，确认一下可以在任意路径下执行 PHPUnit：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>C:<span class="se">\U</span>sers<span class="se">\u</span>sername&gt;  phpunit --version
PHPUnit x.y.z by Sebastian Bergmann and contributors.
</pre></div>
</div>
</li>
</ol>
<p>对于 Cygwin 或 MingW32 (例如 TortoiseGit) shell 环境，可以跳过第五步。 取而代之的是，把文件保存为 <code class="file docutils literal notranslate"><span class="pre">phpunit</span></code> （没有 <code class="file docutils literal notranslate"><span class="pre">.phar</span></code> 扩展名），然后用 chmod 775 phpunit 将其设为可执行。</p>
</div>
<div class="section" id="phpunit-phar">
<span id="installation-phar-verification"></span><h4>校验 PHPUnit PHAR 发行包</h4>
<p>由 PHPUnit 项目分发的所有官方代码发行包都由发行包管理器进行签名。在 <a class="reference external" href="https://phar.phpunit.de/">phar.phpunit.de</a> 上有 PGP 签名和 SHA1 散列值可用于校验。</p>
<p>下面的例子详细说明了如何对发行包进行校验。首先下载 <code class="file docutils literal notranslate"><span class="pre">phpunit.phar</span></code> 和与之对应的单独 PGP 签名 <code class="file docutils literal notranslate"><span class="pre">phpunit.phar.asc</span></code>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://phar.phpunit.de/phpunit.phar
wget https://phar.phpunit.de/phpunit.phar.asc
</pre></div>
</div>
<p>用单独的签名(<code class="file docutils literal notranslate"><span class="pre">phpunit.phar</span></code>)对 PHPUnit 的 PHP 档案包(<code class="file docutils literal notranslate"><span class="pre">phpunit.phar.asc</span></code>)进行校验：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gpg phpunit.phar.asc
gpg: Signature made Sat 19 Jul 2014 01:28:02 PM CEST using RSA key ID 6372C20A
gpg: Can&#39;t check signature: public key not found
</pre></div>
</div>
<p>在本地系统中没有发行包管理器的公钥(<code class="docutils literal notranslate"><span class="pre">6372C20A</span></code>)。为了能进行校验，必须从某个密钥服务器上取得发行包管理器的公钥。其中一个服务器是 <code class="file docutils literal notranslate"><span class="pre">pgp.uni-mainz.de</span></code>。所有密钥服务器是链接在一起的，因此连接到任一密钥服务器都可以。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gpg --keyserver pgp.uni-mainz.de --recv-keys 0x4AA394086372C20A
gpg: requesting key 6372C20A from hkp server pgp.uni-mainz.de
gpg: key 6372C20A: public key <span class="s2">&quot;Sebastian Bergmann &lt;sb@sebastian-bergmann.de&gt;&quot;</span> imported
gpg: Total number processed: <span class="m">1</span>
gpg:               imported: <span class="m">1</span>  <span class="o">(</span>RSA: <span class="m">1</span><span class="o">)</span>
</pre></div>
</div>
<p>现在已经取得了条目名称为”Sebastian Bergmann &lt;<a class="reference external" href="mailto:sb&#37;&#52;&#48;sebastian-bergmann&#46;de">sb<span>&#64;</span>sebastian-bergmann<span>&#46;</span>de</a>&gt;”的公钥。不过无法检验这个密钥确实是由名叫 Sebastian Bergmann 的人创建的。但是可以先试着校验发行包的签名：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gpg phpunit.phar.asc
gpg: Signature made Sat <span class="m">19</span> Jul <span class="m">2014</span> <span class="m">01</span>:28:02 PM CEST using RSA key ID 6372C20A
gpg: Good signature from <span class="s2">&quot;Sebastian Bergmann &lt;sb@sebastian-bergmann.de&gt;&quot;</span>
gpg:                 aka <span class="s2">&quot;Sebastian Bergmann &lt;sebastian@php.net&gt;&quot;</span>
gpg:                 aka <span class="s2">&quot;Sebastian Bergmann &lt;sebastian@thephp.cc&gt;&quot;</span>
gpg:                 aka <span class="s2">&quot;Sebastian Bergmann &lt;sebastian@phpunit.de&gt;&quot;</span>
gpg:                 aka <span class="s2">&quot;Sebastian Bergmann &lt;sebastian.bergmann@thephp.cc&gt;&quot;</span>
gpg:                 aka <span class="s2">&quot;[jpeg image of size 40635]&quot;</span>
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: D840 6D0D <span class="m">8294</span> <span class="m">7747</span> <span class="m">2937</span>  <span class="m">7831</span> 4AA3 <span class="m">9408</span> <span class="m">6372</span> C20A
</pre></div>
</div>
<p>此时，签名已经没问题了，但是这个公钥还不能信任。签名没问题意味着文件未被篡改。可是由于公钥加密系统的性质，还需要再校验密钥 <code class="docutils literal notranslate"><span class="pre">6372C20A</span></code> 确实是由真正的 Sebastian Bergmann 创建的。</p>
<p>任何攻击者都能创建公钥并将其上传到公钥服务器。他们可以建立一个带恶意的发行包，并用这个假密钥进行签名。这样，如果尝试对这个损坏了的发行包进行签名校验，由于密钥是“真”密钥，校验将成功完成。因此，需要对这个密钥的真实性进行校验。如何对公钥的真实性进行校验已经超出了本文档的范畴。</p>
<p>有个比较谨慎的做法是创建一个脚本来管理 PHPUnit 的安装，在运行测试套件之前校验 GnuPG 签名。例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="nv">clean</span><span class="o">=</span><span class="m">1</span> <span class="c1"># 是否在测试完成之后删除 phpunit.phar ？</span>
<span class="nv">aftercmd</span><span class="o">=</span><span class="s2">&quot;php phpunit.phar --bootstrap bootstrap.php src/tests&quot;</span>
gpg --fingerprint D8406D0D82947747293778314AA394086372C20A
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;\033[33mDownloading PGP Public Key...\033[0m&quot;</span>
    gpg --recv-keys D8406D0D82947747293778314AA394086372C20A
    <span class="c1"># Sebastian Bergmann &lt;sb@sebastian-bergmann.de&gt;</span>
    gpg --fingerprint D8406D0D82947747293778314AA394086372C20A
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> -e <span class="s2">&quot;\033[31mCould not download PGP public key for verification\033[0m&quot;</span>
        <span class="nb">exit</span>
    <span class="k">fi</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$clean</span><span class="s2">&quot;</span> -eq <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c1"># 如果存在就清理掉</span>
    <span class="k">if</span> <span class="o">[</span> -f phpunit.phar <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        rm -f phpunit.phar
    <span class="k">fi</span>
    <span class="k">if</span> <span class="o">[</span> -f phpunit.phar.asc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        rm -f phpunit.phar.asc
    <span class="k">fi</span>
<span class="k">fi</span>

<span class="c1"># 抓取最新的发行版和对应的签名</span>
<span class="k">if</span> <span class="o">[</span> ! -f phpunit.phar <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    wget https://phar.phpunit.de/phpunit.phar
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> ! -f phpunit.phar.asc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    wget https://phar.phpunit.de/phpunit.phar.asc
<span class="k">fi</span>

<span class="c1"># 在运行前先校验</span>
gpg --verify phpunit.phar.asc phpunit.phar
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span>
    <span class="nb">echo</span> -e <span class="s2">&quot;\033[33mBegin Unit Testing\033[0m&quot;</span>
    <span class="c1"># 运行测试套件</span>
    <span class="sb">`</span><span class="nv">$after_cmd</span><span class="sb">`</span>
    <span class="c1"># 清理</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$clean</span><span class="s2">&quot;</span> -eq <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> -e <span class="s2">&quot;\033[32mCleaning Up!\033[0m&quot;</span>
        rm -f phpunit.phar
        rm -f phpunit.phar.asc
    <span class="k">fi</span>
<span class="k">else</span>
    <span class="nb">echo</span>
    chmod -x phpunit.phar
    mv phpunit.phar /tmp/bad-phpunit.phar
    mv phpunit.phar.asc /tmp/bad-phpunit.phar.asc
    <span class="nb">echo</span> -e <span class="s2">&quot;\033[31mSignature did not match! PHPUnit has been moved to /tmp/bad-phpunit.phar\033[0m&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="composer">
<span id="installation-composer"></span><h3>Composer</h3>
<p>如果用 <a class="reference external" href="https://getcomposer.org/">Composer</a> 来管理项目的依赖关系，只要在项目的 <code class="docutils literal notranslate"><span class="pre">composer.json</span></code> 文件中简单地加上对 <code class="docutils literal notranslate"><span class="pre">phpunit/phpunit</span></code> 的依赖关系即可：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>composer require --dev phpunit/phpunit ^<span class="p">|</span>version<span class="p">|</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-optional-packages">
<span id="id4"></span><h3>可选的组件包</h3>
<p>有以下可选组件包可用：</p>
<p><code class="docutils literal notranslate"><span class="pre">PHP_Invoker</span></code></p>
<blockquote>
<div><p>一个工具类，可以用带有超时限制的方式调用可调用内容。当需要在严格模式下保证测试的超时限制时，这个组件包是必须的。</p>
<p>PHPUnit 的 PHAR 分发中已经包含了此组件包。可以用以下命令来经由 Composer 安装此组件包：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>composer require --dev phpunit/php-invoker
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DbUnit</span></code></p>
<blockquote>
<div><p>移植到 PHP/PHPUnit 上的 DbUnit 用于提供对数据库交互测试的支持。</p>
<p>PHPUnit 的 PHAR 分发中已经包含了此组件包。可以用以下命令来经由 Composer 安装此组件包：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>composer require --dev phpunit/dbunit
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<span id="document-writing-tests-for-phpunit"></span><div class="section" id="phpunit">
<span id="writing-tests-for-phpunit"></span><h2>编写 PHPUnit 测试</h2>
<p><a class="reference internal" href="#writing-tests-for-phpunit-examples-stacktest-php"><span class="std std-numref">Example 2.1</span></a> 展示了如何用 PHPUnit 编写测试来对 PHP 数组操作进行测试。本例介绍了用 PHPUnit 编写测试的基本惯例与步骤：</p>
<ol class="arabic">
<li><p class="first">针对类 <code class="docutils literal notranslate"><span class="pre">Class</span></code> 的测试写在类 <a href="#id1"><span class="problematic" id="id2">``</span></a>ClassTest``中。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">ClassTest``（通常）继承自</span> <span class="pre">``PHPUnit\Framework\TestCase</span></code>。</p>
</li>
<li><p class="first">测试都是命名为 <code class="docutils literal notranslate"><span class="pre">test*</span></code> 的公用方法。</p>
<p>也可以在方法的文档注释块(docblock)中使用 <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code> 标注将其标记为测试方法。</p>
</li>
<li><p class="first">在测试方法内，类似于 <code class="docutils literal notranslate"><span class="pre">assertSame()</span></code> (参见 <span class="xref std std-ref">appendixes.assertions</span>) 这样的断言方法用来对实际值与预期值的匹配做出断言。</p>
</li>
</ol>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-stacktest-php">
<div class="code-block-caption"><span class="caption-text">用 PHPUnit 测试数组操作</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StackTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPushAndPop</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>

        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$stack</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$stack</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">*Martin Fowler*:</span>

<span class="x">当你想把一些东西写到 ``print`` 语句或者调试表达式中时，别这么做，将其写成一个测试来代替。</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-tests-for-phpunit-test-dependencies">
<span id="id3"></span><h3>测试的依赖关系</h3>
<blockquote>
<div><p><em>Adrian Kuhn et. al.</em>:</p>
<p>单元测试主要是作为一种良好实践来编写的，它能帮助开发人员识别并修复 bug、重构代码，还可以看作被测软件单元的文档。要实现这些好处，理想的单元测试应当覆盖程序中所有可能的路径。一个单元测试通常覆盖一个函数或方法中的一个特定路径。但是，测试方法并不一定非要是一个封装良好的独立实体。测试方法之间经常有隐含的依赖关系暗藏在测试的实现方案中。</p>
</div></blockquote>
<p>PHPUnit支持对测试方法之间的显式依赖关系进行声明。这种依赖关系并不是定义在测试方法的执行顺序中，而是允许生产者(producer)返回一个测试基境(fixture)的实例，并将此实例传递给依赖于它的消费者(consumer)们。</p>
<ul class="simple">
<li>生产者(producer)，是能生成被测单元并将其作为返回值的测试方法。</li>
<li>消费者(consumer)，是依赖于一个或多个生产者及其返回值的测试方法。</li>
</ul>
<p><a class="reference internal" href="#writing-tests-for-phpunit-examples-stacktest2-php"><span class="std std-numref">Example 2.2</span></a> 展示了如何用 <code class="docutils literal notranslate"><span class="pre">&#64;depends</span></code> 标注来表达测试方法之间的依赖关系。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-stacktest2-php">
<div class="code-block-caption"><span class="caption-text">用 <code class="docutils literal notranslate"><span class="pre">&#64;depends</span></code> 标注来表达依赖关系</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StackTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEmpty</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testEmpty</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPush</span><span class="p">(</span><span class="k">array</span> <span class="nv">$stack</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$stack</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$stack</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$stack</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testPush</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPop</span><span class="p">(</span><span class="k">array</span> <span class="nv">$stack</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$stack</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在上例中，第一个测试， <code class="docutils literal notranslate"><span class="pre">testEmpty()</span></code>，创建了一个新数组，并断言其为空。随后，此测试将此基境作为结果返回。第二个测试，<code class="docutils literal notranslate"><span class="pre">testPush()</span></code>，依赖于 <code class="docutils literal notranslate"><span class="pre">testEmpty()</span></code> ，并将所依赖的测试之结果作为参数传入。最后，<code class="docutils literal notranslate"><span class="pre">testPop()</span></code> 依赖于 <code class="docutils literal notranslate"><span class="pre">testPush()</span></code>。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">默认情况下，生产者所产生的返回值将“原样”传递给相应的消费者。这意味着，如果生产者返回的是一个对象，那么传递给消费者的将是一个指向此对象的引用。如果需要传递对象的副本而非引用，则应当用 &#64;depends clone 替代 &#64;depends。</p>
</div>
<p>为了快速定位缺陷，我们希望把注意力集中于相关的失败测试上。这就是为什么当某个测试所依赖的测试失败时，PHPUnit 会跳过这个测试。通过利用测试之间的依赖关系，缺陷定位得到了改进，如 <a class="reference internal" href="#writing-tests-for-phpunit-examples-dependencyfailuretest-php"><span class="std std-numref">Example 2.3</span></a> 中所示。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-dependencyfailuretest-php">
<div class="code-block-caption"><span class="caption-text">利用测试之间的依赖关系</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DependencyFailureTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOne</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testOne</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testTwo</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --verbose DependencyFailureTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

FS

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DependencyFailureTest::testOne
Failed asserting that <span class="nb">false</span> is true.

/home/sb/DependencyFailureTest.php:6

There was <span class="m">1</span> skipped test:

<span class="m">1</span><span class="o">)</span> DependencyFailureTest::testTwo
This <span class="nb">test</span> depends on <span class="s2">&quot;DependencyFailureTest::testOne&quot;</span> to pass.

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>, Skipped: <span class="m">1</span>.
</pre></div>
</div>
<p>测试可以使用多个 <code class="docutils literal notranslate"><span class="pre">&#64;depends</span></code> 标注。PHPUnit 不会更改测试的运行顺序，因此你需要自行保证某个测试所依赖的所有测试均出现于这个测试之前。</p>
<p>拥有多个 <code class="docutils literal notranslate"><span class="pre">&#64;depends</span></code> 标注的测试，其第一个参数是第一个生产者提供的基境，第二个参数是第二个生产者提供的基境，以此类推。参见 <a class="reference internal" href="#writing-tests-for-phpunit-examples-multipledependencies-php"><span class="std std-numref">Example 2.4</span></a></p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-examples-multipledependencies-php">
<div class="code-block-caption"><span class="caption-text">有多重依赖的测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MultipleDependenciesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerFirst</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="s1">&#39;first&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerSecond</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="s1">&#39;second&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testProducerFirst</span>
<span class="sd">     * @depends testProducerSecond</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConsumer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">],</span>
            <span class="nb">func_get_args</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --verbose MultipleDependenciesTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

...

Time: <span class="m">0</span> seconds, Memory: <span class="m">3</span>.25Mb

OK <span class="o">(</span><span class="m">3</span> tests, <span class="m">3</span> assertions<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-tests-for-phpunit-data-providers">
<span id="id4"></span><h3>数据供给器</h3>
<p>测试方法可以接受任意参数。这些参数由数据供给器方法（在 <a class="reference internal" href="#writing-tests-for-phpunit-data-providers-examples-datatest-php"><span class="std std-numref">Example 2.5</span></a> 中，是 <code class="docutils literal notranslate"><span class="pre">additionProvider()</span></code> 方法）提供。用 <code class="docutils literal notranslate"><span class="pre">&#64;dataProvider</span></code> 标注来指定使用哪个数据供给器方法。</p>
<p>数据供给器方法必须声明为 <code class="docutils literal notranslate"><span class="pre">public</span></code>，其返回值要么是一个数组，其每个元素也是数组；要么是一个实现了 <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> 接口的对象，在对它进行迭代时每步产生一个数组。每个数组都是测试数据集的一部分，将以它的内容作为参数来调用测试方法。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-datatest-php">
<div class="code-block-caption"><span class="caption-text">使用返回数组的数组的数据供给器</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit DataTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

...F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DataTest::testAdd with data <span class="nb">set</span> <span class="c1">#3 (1, 1, 3)</span>
Failed asserting that <span class="m">2</span> matches expected <span class="m">3</span>.

/home/sb/DataTest.php:9

FAILURES!
Tests: <span class="m">4</span>, Assertions: <span class="m">4</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p>当使用到大量数据集时，最好逐个用字符串键名对其命名，避免用默认的数字键名。这样输出信息会更加详细些，其中将包含打断测试的数据集所对应的名称。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-datatest1-php">
<div class="code-block-caption"><span class="caption-text">使用带有命名数据集的数据供给器</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;adding zeros&#39;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;zero plus one&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;one plus zero&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;one plus one&#39;</span>  <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit DataTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

...F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DataTest::testAdd with data <span class="nb">set</span> <span class="s2">&quot;one plus one&quot;</span> <span class="o">(</span><span class="m">1</span>, <span class="m">1</span>, <span class="m">3</span><span class="o">)</span>
Failed asserting that <span class="m">2</span> matches expected <span class="m">3</span>.

/home/sb/DataTest.php:9

FAILURES!
Tests: <span class="m">4</span>, Assertions: <span class="m">4</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-datatest2-php">
<div class="code-block-caption"><span class="caption-text">使用返回迭代器对象的数据供给器</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">require</span> <span class="s1">&#39;CsvFileIterator.php&#39;</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider additionProvider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">additionProvider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">CsvFileIterator</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit DataTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

...F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DataTest::testAdd with data <span class="nb">set</span> <span class="c1">#3 (&#39;1&#39;, &#39;1&#39;, &#39;3&#39;)</span>
Failed asserting that <span class="m">2</span> matches expected <span class="s1">&#39;3&#39;</span>.

/home/sb/DataTest.php:11

FAILURES!
Tests: <span class="m">4</span>, Assertions: <span class="m">4</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-csvfileiterator-php">
<div class="code-block-caption"><span class="caption-text">CsvFileIterator 类</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CsvFileIterator</span> <span class="k">implements</span> <span class="nx">Iterator</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$key</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$current</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">rewind</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span> <span class="o">=</span> <span class="nb">fgetcsv</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span> <span class="o">=</span> <span class="nb">fgetcsv</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>如果测试同时从 <code class="docutils literal notranslate"><span class="pre">&#64;dataProvider</span></code> 方法和一个或多个 <code class="docutils literal notranslate"><span class="pre">&#64;depends</span></code> 测试接收数据，那么来自于数据供给器的参数将先于来自所依赖的测试的。来自于所依赖的测试的参数对于每个数据集都是一样的。参见:numref:<cite>writing-tests-for-phpunit.data-providers.examples.DependencyAndDataProviderCombo.php</cite></p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-data-providers-examples-dependencyanddataprovidercombo-php">
<div class="code-block-caption"><span class="caption-text">在同一个测试中组合使用 &#64;depends 和 &#64;dataProvider</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DependencyAndDataProviderComboTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">provider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[[</span><span class="s1">&#39;provider1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;provider2&#39;</span><span class="p">]];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerFirst</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="s1">&#39;first&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testProducerSecond</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="s1">&#39;second&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends testProducerFirst</span>
<span class="sd">     * @depends testProducerSecond</span>
<span class="sd">     * @dataProvider provider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConsumer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;provider1&#39;</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">],</span>
            <span class="nb">func_get_args</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --verbose DependencyAndDataProviderComboTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

...F

Time: <span class="m">0</span> seconds, Memory: <span class="m">3</span>.50Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DependencyAndDataProviderComboTest::testConsumer with data <span class="nb">set</span> <span class="c1">#1 (&#39;provider2&#39;)</span>
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
Array <span class="o">(</span>
-    <span class="nv">0</span> <span class="o">=</span>&gt; <span class="s1">&#39;provider1&#39;</span>
+    <span class="nv">0</span> <span class="o">=</span>&gt; <span class="s1">&#39;provider2&#39;</span>
<span class="nv">1</span> <span class="o">=</span>&gt; <span class="s1">&#39;first&#39;</span>
<span class="nv">2</span> <span class="o">=</span>&gt; <span class="s1">&#39;second&#39;</span>
<span class="o">)</span>

/home/sb/DependencyAndDataProviderComboTest.php:31

FAILURES!
Tests: <span class="m">4</span>, Assertions: <span class="m">4</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">如果一个测试依赖于另外一个使用了数据供给器的测试，仅当被依赖的测试至少能在一组数据上成功时，依赖于它的测试才会运行。使用了数据供给器的测试，其运行结果是无法注入到依赖于此测试的其他测试中的。</p>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">所有的数据供给器方法的执行都是在对 <code class="docutils literal notranslate"><span class="pre">setUpBeforeClass</span></code> 静态方法的调用和第一次对 <code class="docutils literal notranslate"><span class="pre">setUp</span></code> 方法的调用之前完成的。因此，无法在数据供给器中使用创建于这两个方法内的变量。这是必须的，这样 PHPUnit 才能计算测试的总数量。</p>
</div>
</div>
<div class="section" id="writing-tests-for-phpunit-exceptions">
<span id="id5"></span><h3>对异常进行测试</h3>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">writing-tests-for-phpunit.exceptions.examples.ExceptionTest.php`展示了如何用</span> <span class="pre">``&#64;expectException`</span></code> 标注来测试被测代码中是否抛出了异常。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-exceptiontest-php">
<div class="code-block-caption"><span class="caption-text">使用 expectException() 方法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExceptionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testException</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ExceptionTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ExceptionTest::testException
Expected exception InvalidArgumentException

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p>除了 <code class="docutils literal notranslate"><span class="pre">expectException()</span></code> 方法外，还有 <code class="docutils literal notranslate"><span class="pre">expectExceptionCode()</span></code>、<code class="docutils literal notranslate"><span class="pre">expectExceptionMessage()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">expectExceptionMessageRegExp()</span></code> 方法可以用于为被测代码所抛出的异常建立预期。</p>
<p>或者，也可以用 <code class="docutils literal notranslate"><span class="pre">&#64;expectedException</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionCode</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionMessage</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionMessageRegExp</span></code> 标注来为被测代码所抛出的异常建立预期。:numref:<a href="#id6"><span class="problematic" id="id7">`</span></a>writing-tests-for-phpunit.exceptions.examples.ExceptionTest2.php`展示了一个范例。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-exceptiontest2-php">
<div class="code-block-caption"><span class="caption-text">使用 &#64;expectedException 标注</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExceptionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @expectedException InvalidArgumentException</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testException</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ExceptionTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ExceptionTest::testException
Expected exception InvalidArgumentException

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="php">
<span id="writing-tests-for-phpunit-errors"></span><h3>对 PHP 错误进行测试</h3>
<p>默认情况下，PHPUnit 将测试在执行中触发的 PHP 错误、警告、通知都转换为异常。利用这些异常，就可以，比如说，预期测试将触发 PHP 错误，如:numref:<a href="#id8"><span class="problematic" id="id9">`</span></a>writing-tests-for-phpunit.exceptions.examples.ErrorTest.php`所示。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">PHP 的 <code class="docutils literal notranslate"><span class="pre">error_reporting</span></code> 运行时配置会对 PHPUnit 将哪些错误转换为异常有所限制。如果在这个特性上碰到问题，请确认 PHP 的配置中没有抑制想要测试的错误类型。</p>
</div>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-exceptions-examples-errortest-php">
<div class="code-block-caption"><span class="caption-text">用 &#64;expectedException 来预期 PHP 错误</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExpectedErrorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @expectedException PHPUnit\Framework\Error</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailingInclude</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">include</span> <span class="s1">&#39;not_existing_file.php&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit -d <span class="nv">error_reporting</span><span class="o">=</span><span class="m">2</span> ExpectedErrorTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

.

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

OK <span class="o">(</span><span class="m">1</span> test, <span class="m">1</span> assertion<span class="o">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Error\Notice</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Error\Warning</span></code> 分别代表 PHP 通知与 PHP 警告。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">对异常进行测试是越明确越好的。对太笼统的类进行测试有可能导致不良副作用。因此，不再允许用 <code class="docutils literal notranslate"><span class="pre">&#64;expectedException</span></code> 或 <code class="docutils literal notranslate"><span class="pre">setExpectedException()</span></code> 对 <code class="docutils literal notranslate"><span class="pre">Exception</span></code> 类进行测试。</p>
</div>
<p>如果测试依靠会触发错误的 PHP 函数，例如 <code class="docutils literal notranslate"><span class="pre">fopen</span></code> ，有时候在测试中使用错误抑制符会很有用。通过抑制住错误通知，就能对返回值进行检查，否则错误通知将会导致抛出 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\Error\Notice</span></code>。
.. code-block:: php</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">caption:</th><td class="field-body">对会引发PHP 错误的代码的返回值进行测试</td>
</tr>
<tr class="field-even field"><th class="field-name">name:</th><td class="field-body">writing-tests-for-phpunit.exceptions.examples.TriggerErrorReturnValue.php</td>
</tr>
</tbody>
</table>
<p>&lt;?php
use PHPUnitFrameworkTestCase;</p>
<p>class ErrorSuppressionTest extends TestCase
{</p>
<blockquote>
<div><dl class="docutils">
<dt>public function testFileWriting() {</dt>
<dd>$writer = new FileWriter;
$this-&gt;assertFalse(&#64;$writer-&gt;write(‘/is-not-writeable/file’, ‘stuff’));</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}
class FileWriter
{</p>
<blockquote>
<div><dl class="docutils">
<dt>public function write($file, $content) {</dt>
<dd><p class="first">$file = fopen($file, ‘w’);
if($file == false) {</p>
<blockquote>
<div>return false;</div></blockquote>
<p class="last">}
// …</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
<p>?&gt;</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ErrorSuppressionTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

.

Time: <span class="m">1</span> seconds, Memory: <span class="m">5</span>.25Mb

OK <span class="o">(</span><span class="m">1</span> test, <span class="m">1</span> assertion<span class="o">)</span>
</pre></div>
</div>
<p>如果不使用错误抑制符，此测试将会失败，并报告 <code class="docutils literal notranslate"><span class="pre">fopen(/is-not-writeable/file):</span> <span class="pre">failed</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">stream:</span> <span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code>。</p>
</div>
<div class="section" id="writing-tests-for-phpunit-output">
<span id="id10"></span><h3>对输出进行测试</h3>
<p>有时候，想要断言（比如说）某方法的运行过程中生成了预期的输出（例如，通过 <code class="docutils literal notranslate"><span class="pre">echo</span></code> 或 <code class="docutils literal notranslate"><span class="pre">print</span></code>）。<code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code> 类使用 PHP 的 <a class="reference external" href="http://www.php.net/manual/en/ref.outcontrol.php">输出缓冲</a> 特性来为此提供必要的功能支持。</p>
<p><a class="reference internal" href="#writing-tests-for-phpunit-output-examples-outputtest-php"><span class="std std-numref">Example 2.13</span></a> 展示了如何用 <code class="docutils literal notranslate"><span class="pre">expectOutputString()</span></code> 方法来设定所预期的输出。如果没有产生预期的输出，测试将计为失败。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-output-examples-outputtest-php">
<div class="code-block-caption"><span class="caption-text">对函数或方法的输出进行测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OutputTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExpectFooActualFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
        <span class="k">print</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExpectBarActualBaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
        <span class="k">print</span> <span class="s1">&#39;baz&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit OutputTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

.F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> OutputTest::testExpectBarActualBaz
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-<span class="s1">&#39;bar&#39;</span>
+<span class="s1">&#39;baz&#39;</span>

FAILURES!
Tests: <span class="m">2</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p><a class="reference internal" href="#writing-tests-for-phpunit-output-tables-api"><span class="std std-numref">Table 2.1</span></a> 中列举了用于对输出进行测试的各种方法。</p>
<table border="1" class="table docutils" id="writing-tests-for-phpunit-output-tables-api">
<caption><span class="caption-text">用于对输出进行测试的方法</span></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">方法</th>
<th class="head">含义</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">expectOutputRegex(string</span> <span class="pre">$regularExpression)</span></code></td>
<td>设置输出预期为输出应当匹配正则表达式 <code class="docutils literal notranslate"><span class="pre">$regularExpression</span></code>。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">expectOutputString(string</span> <span class="pre">$expectedString)</span></code></td>
<td>设置输出预期为输出应当与 <code class="docutils literal notranslate"><span class="pre">$expectedString</span></code> 字符串相等。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">setOutputCallback(callable</span> <span class="pre">$callback)</span></code></td>
<td>设置回调函数，用来做诸如将实际输出规范化之类的动作。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">getActualOutput()</span></code></td>
<td>获取实际输出。</td>
</tr>
</tbody>
</table>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">在严格模式下，本身产生输出的测试将会失败。</p>
</div>
</div>
<div class="section" id="writing-tests-for-phpunit-error-output">
<span id="id12"></span><h3>错误相关信息的输出</h3>
<p>当有测试失败时，PHPUnit 全力提供尽可能多的有助于找出问题所在的上下文信息。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-error-output-examples-arraydifftest-php">
<div class="code-block-caption"><span class="caption-text">数组比较失败时生成的错误相关信息输出</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArrayDiffTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ArrayDiffTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ArrayDiffTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array <span class="o">(</span>
     <span class="nv">0</span> <span class="o">=</span>&gt; <span class="m">1</span>
     <span class="nv">1</span> <span class="o">=</span>&gt; <span class="m">2</span>
-    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="m">3</span>
+    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="m">33</span>
     <span class="nv">3</span> <span class="o">=</span>&gt; <span class="m">4</span>
     <span class="nv">4</span> <span class="o">=</span>&gt; <span class="m">5</span>
     <span class="nv">5</span> <span class="o">=</span>&gt; <span class="m">6</span>
 <span class="o">)</span>

/home/sb/ArrayDiffTest.php:7

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p>在这个例子中，数组中只有一个值不同，但其他值也都同时显示出来，以提供关于错误发生的位置的上下文信息。</p>
<p>当生成的输出很长而难以阅读时，PHPUnit 将对其进行分割，并在每个差异附近提供少数几行上下文信息。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-error-output-examples-longarraydifftest-php">
<div class="code-block-caption"><span class="caption-text">长数组比较失败时生成的错误相关信息输出</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LongArrayDiffTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit LongArrayDiffTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> LongArrayDiffTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
     <span class="nv">13</span> <span class="o">=</span>&gt; <span class="m">2</span>
-    <span class="nv">14</span> <span class="o">=</span>&gt; <span class="m">3</span>
+    <span class="nv">14</span> <span class="o">=</span>&gt; <span class="m">33</span>
     <span class="nv">15</span> <span class="o">=</span>&gt; <span class="m">4</span>
     <span class="nv">16</span> <span class="o">=</span>&gt; <span class="m">5</span>
     <span class="nv">17</span> <span class="o">=</span>&gt; <span class="m">6</span>
 <span class="o">)</span>

/home/sb/LongArrayDiffTest.php:7

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<div class="section" id="writing-tests-for-phpunit-error-output-edge-cases">
<span id="id13"></span><h4>边缘情况</h4>
<p>当比较失败时，PHPUnit 为输入值建立文本表示，然后以此进行对比。这种实现导致在差异指示中显示出来的问题可能比实际上存在的多。</p>
<p>这种情况只出现在对数组或者对象使用 assertEquals 或其他“弱”比较函数时。</p>
<div class="literal-block-wrapper docutils container" id="writing-tests-for-phpunit-error-output-edge-cases-examples-arrayweakcomparisontest-php">
<div class="code-block-caption"><span class="caption-text">当使用弱比较时在生成的差异结果中出现的边缘情况</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArrayWeakComparisonTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquality</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ArrayWeakComparisonTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ArrayWeakComparisonTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array <span class="o">(</span>
-    <span class="nv">0</span> <span class="o">=</span>&gt; <span class="m">1</span>
+    <span class="nv">0</span> <span class="o">=</span>&gt; <span class="s1">&#39;1&#39;</span>
     <span class="nv">1</span> <span class="o">=</span>&gt; <span class="m">2</span>
-    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="m">3</span>
+    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="m">33</span>
     <span class="nv">3</span> <span class="o">=</span>&gt; <span class="m">4</span>
     <span class="nv">4</span> <span class="o">=</span>&gt; <span class="m">5</span>
     <span class="nv">5</span> <span class="o">=</span>&gt; <span class="m">6</span>
 <span class="o">)</span>

/home/sb/ArrayWeakComparisonTest.php:7

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p>在这个例子中，第一个索引项中的 <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">'1'</span></code> 在报告中被视为不同，虽然 assertEquals 认为这两个值是匹配的。</p>
</div>
</div>
</div>
<span id="document-textui"></span><div class="section" id="textui">
<span id="id1"></span><h2>命令行测试执行器</h2>
<p>PHPUnit 命令行测试执行器可通过 <code class="file docutils literal notranslate"><span class="pre">phpunit</span></code> 命令调用。下面的代码展示了如何用 PHPUnit 命令行测试执行器来运行测试：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ArrayTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

..

Time: <span class="m">0</span> seconds

OK <span class="o">(</span><span class="m">2</span> tests, <span class="m">2</span> assertions<span class="o">)</span>
</pre></div>
</div>
<p>上面这个调用例子中，PHPUnit 命令行测试执行器将在当前工作目录中寻找 <code class="file docutils literal notranslate"><span class="pre">ArrayTest.php</span></code> 源文件并加载之。而在此源文件中应当能找到 <code class="docutils literal notranslate"><span class="pre">ArrayTest</span></code> 测试用例类，此类中的测试将被执行。</p>
<p>对于每个测试的运行，PHPUnit 命令行工具输出一个字符来指示进展：</p>
<p><code class="docutils literal notranslate"><span class="pre">.</span></code></p>
<blockquote>
<div>当测试成功时输出。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">F</span></code></p>
<blockquote>
<div>当测试方法运行过程中一个断言失败时输出。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">E</span></code></p>
<blockquote>
<div>当测试方法运行过程中产生一个错误时输出。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">R</span></code></p>
<blockquote>
<div>当测试被标记为有风险时输出（参见:ref:<cite>risky-tests</cite>）。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">S</span></code></p>
<blockquote>
<div>当测试被跳过时输出（参见:ref:<cite>incomplete-and-skipped-tests</cite>）。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">I</span></code></p>
<blockquote>
<div>当测试被标记为不完整或未实现时输出（参见:ref:<cite>incomplete-and-skipped-tests</cite>）。</div></blockquote>
<p>PHPUnit 区分 <em>败(failure)*与*错误(error)</em>。失败指的是被违背了的 PHPUnit 断言，例如一个失败的 <code class="docutils literal notranslate"><span class="pre">assertEquals()</span></code> 调用。错误指的是意料之外的异常(exception)或 PHP 错误。这种差异已被证明在某些时候是非常有用的，因为错误往往比失败更容易修复。如果得到了一个非常长的问题列表，那么最好先对付错误，当错误全部修复了之后再试一次瞧瞧还有没有失败。</p>
<div class="section" id="textui-clioptions">
<span id="id2"></span><h3>命令行选项</h3>
<p>让我们来瞧瞧以下代码中命令行测试运行器的各种选项：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --help
PHPUnit 7.0.0 by Sebastian Bergmann and contributors.

Usage: phpunit [options] UnitTest [UnitTest.php]
       phpunit [options] &lt;directory&gt;

Code Coverage Options:

  --coverage-clover &lt;file&gt;    Generate code coverage report in Clover XML format.
  --coverage-crap4j &lt;file&gt;    Generate code coverage report in Crap4J XML format.
  --coverage-html &lt;dir&gt;       Generate code coverage report in HTML format.
  --coverage-php &lt;file&gt;       Export PHP_CodeCoverage object to file.
  --coverage-text=&lt;file&gt;      Generate code coverage report in text format.
                              Default: Standard output.
  --coverage-xml &lt;dir&gt;        Generate code coverage report in PHPUnit XML format.
  --whitelist &lt;dir&gt;           Whitelist &lt;dir&gt; for code coverage analysis.
  --disable-coverage-ignore   Disable annotations for ignoring code coverage.

Logging Options:

  --log-junit &lt;file&gt;          Log test execution in JUnit XML format to file.
  --log-teamcity &lt;file&gt;       Log test execution in TeamCity format to file.
  --testdox-html &lt;file&gt;       Write agile documentation in HTML format to file.
  --testdox-text &lt;file&gt;       Write agile documentation in Text format to file.
  --testdox-xml &lt;file&gt;        Write agile documentation in XML format to file.
  --reverse-list              Print defects in reverse order

Test Selection Options:

  --filter &lt;pattern&gt;          Filter which tests to run.
  --testsuite &lt;name,...&gt;      Filter which testsuite to run.
  --group ...                 Only runs tests from the specified group(s).
  --exclude-group ...         Exclude tests from the specified group(s).
  --list-groups               List available test groups.
  --list-suites               List available test suites.
  --test-suffix ...           Only search for test in files with specified
                              suffix(es). Default: Test.php,.phpt

Test Execution Options:

  --dont-report-useless-tests Do not report tests that do not test anything.
  --strict-coverage           Be strict about @covers annotation usage.
  --strict-global-state       Be strict about changes to global state
  --disallow-test-output      Be strict about output during tests.
  --disallow-resource-usage   Be strict about resource usage during small tests.
  --enforce-time-limit        Enforce time limit based on test size.
  --disallow-todo-tests       Disallow @todo-annotated tests.

  --process-isolation         Run each test in a separate PHP process.
  --globals-backup            Backup and restore $GLOBALS for each test.
  --static-backup             Backup and restore static attributes for each test.

  --colors=&lt;flag&gt;             Use colors in output (&quot;never&quot;, &quot;auto&quot; or &quot;always&quot;).
  --columns &lt;n&gt;               Number of columns to use for progress output.
  --columns max               Use maximum number of columns for progress output.
  --stderr                    Write to STDERR instead of STDOUT.
  --stop-on-error             Stop execution upon first error.
  --stop-on-failure           Stop execution upon first error or failure.
  --stop-on-warning           Stop execution upon first warning.
  --stop-on-risky             Stop execution upon first risky test.
  --stop-on-skipped           Stop execution upon first skipped test.
  --stop-on-incomplete        Stop execution upon first incomplete test.
  --fail-on-warning           Treat tests with warnings as failures.
  --fail-on-risky             Treat risky tests as failures.
  -v|--verbose                Output more verbose information.
  --debug                     Display debugging information.

  --loader &lt;loader&gt;           TestSuiteLoader implementation to use.
  --repeat &lt;times&gt;            Runs the test(s) repeatedly.
  --teamcity                  Report test execution progress in TeamCity format.
  --testdox                   Report test execution progress in TestDox format.
  --testdox-group             Only include tests from the specified group(s).
  --testdox-exclude-group     Exclude tests from the specified group(s).
  --printer &lt;printer&gt;         TestListener implementation to use.

Configuration Options:

  --bootstrap &lt;file&gt;          A &quot;bootstrap&quot; PHP file that is run before the tests.
  -c|--configuration &lt;file&gt;   Read configuration from XML file.
  --no-configuration          Ignore default configuration file (phpunit.xml).
  --no-coverage               Ignore code coverage configuration.
  --no-extensions             Do not load PHPUnit extensions.
  --include-path &lt;path(s)&gt;    Prepend PHP&#39;s include_path with given path(s).
  -d key[=value]              Sets a php.ini value.
  --generate-configuration    Generate configuration file with suggested settings.

Miscellaneous Options:

  -h|--help                   Prints this usage information.
  --version                   Prints the version and exits.
  --atleast-version &lt;min&gt;     Checks that version is greater than min and exits.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">phpunit</span> <span class="pre">UnitTest</span></code></p>
<blockquote>
<div><p>运行由 <code class="docutils literal notranslate"><span class="pre">UnitTest</span></code> 类提供的测试。这个类应当在 <code class="file docutils literal notranslate"><span class="pre">UnitTest.php</span></code> 源文件中声明。</p>
<p><code class="docutils literal notranslate"><span class="pre">UnitTest</span></code> 这个类必须满足以下二个条件之一：要么它继承自 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code>；要么它提供 <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span> <span class="pre">suite()</span></code> 方法，这个方法返回一个 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Test</span></code> 对象，比如，一个 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_TestSuite</span></code> 类的实例。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">phpunit</span> <span class="pre">UnitTest</span> <span class="pre">UnitTest.php</span></code></p>
<blockquote>
<div>运行由 <code class="docutils literal notranslate"><span class="pre">UnitTest</span></code> 类提供的测试。这个类应当在指定的源文件中声明。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--coverage-clover</span></code></p>
<blockquote>
<div><p>为运行的测试生成带有代码覆盖率信息的 XML 格式的日志文件。更多细节请参见:ref:<cite>logging</cite>。</p>
<p>请注意，此功能仅当安装了 tokenizer 和 Xdebug 这两个 PHP 扩展后才可用。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--coverage-crap4j</span></code></p>
<blockquote>
<div><p>生成 Crap4j 格式的代码覆盖率报告。更多细节请参见:ref:<cite>code-coverage-analysis</cite>。</p>
<p>请注意，此功能仅当安装了 tokenizer 和 Xdebug 这两个 PHP 扩展后才可用。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--coverage-html</span></code></p>
<blockquote>
<div><p>生成 HTML 格式的代码覆盖率报告。更多细节请参见 <a class="reference internal" href="index.html#code-coverage-analysis"><span class="std std-ref">代码覆盖率分析</span></a>。</p>
<p>请注意，此功能仅当安装了 tokenizer 和 Xdebug 这两个 PHP 扩展后才可用。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--coverage-php</span></code></p>
<blockquote>
<div><p>生成一个序列化后的 PHP_CodeCoverage 对象，此对象含有代码覆盖率信息。</p>
<p>请注意，此功能仅当安装了 tokenizer 和 Xdebug 这两个 PHP 扩展后才可用。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--coverage-text</span></code></p>
<blockquote>
<div><p>为运行的测试以人们可读的格式生成带有代码覆盖率信息的日志文件或命令行输出。更多细节请参见 <a class="reference internal" href="index.html#logging"><span class="std std-ref">Logging （日志记录）</span></a>。</p>
<p>请注意，此功能仅当安装了 tokenizer 和 Xdebug 这两个 PHP 扩展后才可用。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--log-junit</span></code></p>
<blockquote>
<div>为运行的测试生成 JUnit XML 格式的日志文件。更多细节请参见 <a class="reference internal" href="index.html#logging"><span class="std std-ref">Logging （日志记录）</span></a>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--testdox-html</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--testdox-text</span></code></p>
<blockquote>
<div>为运行的测试以 HTML 或纯文本格式生成敏捷文档。更多细节请参见 <a class="reference internal" href="index.html#other-uses-for-tests"><span class="std std-ref">测试的其他用途</span></a>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--filter</span></code></p>
<blockquote>
<div><p>只运行名称与给定模式匹配的测试。如果模式未闭合包裹于分隔符，PHPUnit 将用 <code class="docutils literal notranslate"><span class="pre">/</span></code> 分隔符对其进行闭合包裹。</p>
<p>测试名称将以以下格式之一进行匹配：</p>
<p><code class="docutils literal notranslate"><span class="pre">TestNamespace\TestCaseClass::testMethod</span></code></p>
<blockquote>
<div>默认的测试名称格式等价于在测试方法内使用 <code class="docutils literal notranslate"><span class="pre">__METHOD__</span></code> 魔术常量。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TestNamespace\TestCaseClass::testMethod</span> <span class="pre">with</span> <span class="pre">data</span> <span class="pre">set</span> <span class="pre">#0</span></code></p>
<blockquote>
<div>当测试拥有数据供给器时，数据的每轮迭代都会将其当前索引附加在默认测试名称结尾处。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TestNamespace\TestCaseClass::testMethod</span> <span class="pre">with</span> <span class="pre">data</span> <span class="pre">set</span> <span class="pre">&quot;my</span> <span class="pre">named</span> <span class="pre">data&quot;</span></code></p>
<blockquote>
<div><p>当测试拥有使用命名数据集的数据供给器时，数据的每轮迭代都会将当前名称附加在默认测试名称结尾处。命名数据集的例子参见:numref:<cite>textui.examples.TestCaseClass.php</cite>。</p>
<div class="literal-block-wrapper docutils container" id="textui-examples-testcaseclass-php">
<div class="code-block-caption"><span class="caption-text">命名数据集</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nx">TestNamespace</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestCaseClass</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider provider</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testMethod</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">provider</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;my named data&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="k">true</span><span class="p">],</span>
            <span class="s1">&#39;my data&#39;</span>       <span class="o">=&gt;</span> <span class="p">[</span><span class="k">true</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">/path/to/my/test.phpt</span></code></p>
<blockquote>
<div>对于 PHPT 测试，其测试名称是文件系统路径。</div></blockquote>
<p>有效的过滤器模式例子参见:numref:<cite>textui.examples.filter-patterns</cite>。</p>
<div class="literal-block-wrapper docutils container" id="textui-examples-filter-patterns">
<div class="code-block-caption"><span class="caption-text">过滤器模式例子</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<p>在匹配数据供给器时有一些额外的快捷方式，参见:numref:<cite>textui.examples.filter-shortcuts</cite>。</p>
<div class="literal-block-wrapper docutils container" id="textui-examples-filter-shortcuts">
<div class="code-block-caption"><span class="caption-text">过滤器的快捷方式</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--testsuite</span></code></p>
<blockquote>
<div>只运行名称与给定模式匹配的测试套件。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--group</span></code></p>
<blockquote>
<div><p>只运行来自指定分组（可以多个）的测试。可以用 <code class="docutils literal notranslate"><span class="pre">&#64;group</span></code> 标注为测试标记其所属的分组。</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;author</span></code> 标注是 <code class="docutils literal notranslate"><span class="pre">&#64;group</span></code> 的一个别名，允许按作者来筛选测试。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--exclude-group</span></code></p>
<blockquote>
<div>排除来自指定分组（可以多个）的测试。可以用 <code class="docutils literal notranslate"><span class="pre">&#64;group</span></code> 标注为测试标记其所属的分组。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--list-groups</span></code></p>
<blockquote>
<div>列出所有有效的测试分组。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--test-suffix</span></code></p>
<blockquote>
<div>只查找文件名以指定后缀（可以多个）结尾的测试文件。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--report-useless-tests</span></code></p>
<blockquote>
<div>更严格对待事实上不测试任何内容的测试。详情参见 <a class="reference internal" href="index.html#risky-tests"><span class="std std-ref">有风险的测试</span></a>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--strict-coverage</span></code></p>
<blockquote>
<div>更严格对待意外的代码覆盖。详情参见 <a class="reference internal" href="index.html#risky-tests"><span class="std std-ref">有风险的测试</span></a>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--strict-global-state</span></code></p>
<blockquote>
<div>更严格对待全局状态篡改。详情参见 <a class="reference internal" href="index.html#risky-tests"><span class="std std-ref">有风险的测试</span></a>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--disallow-test-output</span></code></p>
<blockquote>
<div>更严格对待测试执行期间产生的输出。详情参见:ref:<cite>risky-tests</cite>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--disallow-todo-tests</span></code></p>
<blockquote>
<div>不执行文档注释块中含有 <code class="docutils literal notranslate"><span class="pre">&#64;todo</span></code> 标注的测试。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--enforce-time-limit</span></code></p>
<blockquote>
<div>根据测试规模对其加上执行时长限制。详情参见:ref:<cite>risky-tests</cite>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--process-isolation</span></code></p>
<blockquote>
<div>每个测试都在独立的PHP进程中运行。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--no-globals-backup</span></code></p>
<blockquote>
<div>不要备份并还原 $GLOBALS。更多细节请参见:ref:<cite>fixtures.global-state</cite>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--static-backup</span></code></p>
<blockquote>
<div>备份并还原用户定义的类中的静态属性。更多细节请参见:ref:<cite>fixtures.global-state</cite>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--colors</span></code></p>
<blockquote>
<div><p>使用彩色输出。Windows下，用 <a class="reference external" href="https://github.com/adoxa/ansicon">ANSICON</a> 或 <a class="reference external" href="https://github.com/Maximus5/ConEmu">ConEmu</a>。</p>
<p>本选项有三个可能的值：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">never</span></code>: 完全不使用彩色输出。当未使用 <code class="docutils literal notranslate"><span class="pre">--colors</span></code> 选项时，这是默认值。</li>
<li><code class="docutils literal notranslate"><span class="pre">auto</span></code>: 如果当前终端不支持彩色、或者输出被管道输出至其他命令、或输出被重定向至文件时，不使用彩色输出，其余情况使用彩色。</li>
<li><code class="docutils literal notranslate"><span class="pre">always</span></code>: 总是使用彩色输出，即使当前终端不支持彩色、输出被管道输出至其他命令、或输出被重定向至文件。</li>
</ul>
<p>当使用了 <code class="docutils literal notranslate"><span class="pre">--colors</span></code> 选项但未指定任何值时，将选择 <code class="docutils literal notranslate"><span class="pre">auto</span></code> 做为其值。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--columns</span></code></p>
<blockquote>
<div>定义输出所使用的列数。如果将其值定义为 <code class="docutils literal notranslate"><span class="pre">max</span></code>，则使用当前终端所支持的最大列数。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--stderr</span></code></p>
<blockquote>
<div>选择输出到 <code class="docutils literal notranslate"><span class="pre">STDERR</span></code> 而非 <code class="docutils literal notranslate"><span class="pre">STDOUT</span></code>.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--stop-on-error</span></code></p>
<blockquote>
<div>首次错误出现后停止执行。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--stop-on-failure</span></code></p>
<blockquote>
<div>首次错误或失败出现后停止执行。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--stop-on-risky</span></code></p>
<blockquote>
<div>首次碰到有风险的测试时停止执行。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--stop-on-skipped</span></code></p>
<blockquote>
<div>首次碰到跳过的测试时停止执行。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--stop-on-incomplete</span></code></p>
<blockquote>
<div>首次碰到不完整的测试时停止执行。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--verbose</span></code></p>
<blockquote>
<div>输出更详尽的信息，例如不完整或者跳过的测试的名称。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--debug</span></code></p>
<blockquote>
<div>输出调试信息，例如当一个测试开始执行时输出其名称。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--loader</span></code></p>
<blockquote>
<div><p>指定要使用的 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Runner_TestSuiteLoader</span></code> 实现。</p>
<p>标准的测试套件加载器将在当前工作目录和 PHP 的 <code class="docutils literal notranslate"><span class="pre">include_path</span></code> 配置指令中指定的每个目录内查找源文件。诸如 <code class="docutils literal notranslate"><span class="pre">Project_Package_Class</span></code> 这样的类名对应的源文件名为 <code class="file docutils literal notranslate"><span class="pre">Project/Package/Class.php</span></code>。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--repeat</span></code></p>
<blockquote>
<div>将测试重复运行指定次数。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--testdox</span></code></p>
<blockquote>
<div>将测试进度以敏捷文档方式报告。更多细节请参见 <a class="reference internal" href="index.html#other-uses-for-tests"><span class="std std-ref">测试的其他用途</span></a>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--printer</span></code></p>
<blockquote>
<div>指定要使用的结果输出器(printer)。输出器类必须扩展 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Util_Printer</span></code> 并且实现 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestListener</span></code> 接口。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--bootstrap</span></code></p>
<blockquote>
<div>在测试前先运行一个 “bootstrap” PHP 文件。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--configuration</span></code>, <code class="docutils literal notranslate"><span class="pre">-c</span></code></p>
<blockquote>
<div><p>从 XML 文件中读取配置信息。更多细节请参见:ref:<cite>appendixes.configuration</cite>。</p>
<p>如果 <code class="file docutils literal notranslate"><span class="pre">phpunit.xml</span></code> 或 <code class="file docutils literal notranslate"><span class="pre">phpunit.xml.dist</span></code> （按此顺序）存在于当前工作目录并且*未*使用 <code class="docutils literal notranslate"><span class="pre">--configuration</span></code>，将自动从此文件中读取配置。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--no-configuration</span></code></p>
<blockquote>
<div>忽略当前工作目录下的 <code class="file docutils literal notranslate"><span class="pre">phpunit.xml</span></code> 与 <code class="file docutils literal notranslate"><span class="pre">phpunit.xml.dist</span></code>。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--include-path</span></code></p>
<blockquote>
<div>向 PHP 的 <code class="docutils literal notranslate"><span class="pre">include_path</span></code> 开头添加指定路径（可以多个）。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-d</span></code></p>
<blockquote>
<div>设置指定的 PHP 配置选项的值。</div></blockquote>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">请注意，从 4.8 开始，选项不能放在参数之后。</p>
</div>
</div>
</div>
<span id="document-fixtures"></span><div class="section" id="fixture">
<span id="fixtures"></span><h2>基境(fixture)</h2>
<p>在编写测试时，最费时的部分之一是编写代码来将整个场景设置成某个已知的状态，并在测试结束后将其复原到初始状态。这个已知的状态称为测试的 <em>基境(fixture)</em>。</p>
<p>在:ref:<cite>writing-tests-for-phpunit.examples.StackTest.php`中，基境十分简单，就是存储在 ``$stack`</cite> 变量中的数组。然而，绝大多数时候基境均远比一个简单数组要复杂，用于建立基境的代码量也会随之增长。测试的真正内容就被淹没于建立基境带来的干扰中。当编写多个需要类似基境的测试时这个问题就变得更糟糕了。如果没有来自于测试框架的帮助，就不得不在写每一个测试时都将建立基境的代码重复一次。</p>
<p>PHPUnit 支持共享建立基境的代码。在运行某个测试方法前，会调用一个名叫 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 的模板方法。<code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 是创建测试所用对象的地方。当测试方法运行结束后，不管是成功还是失败，都会调用另外一个名叫 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 的模板方法。<code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 是清理测试所用对象的地方。</p>
<p>在:ref:<cite>writing-tests-for-phpunit.examples.StackTest2.php`中，我们在测试之间运用生产者-消费者关系来共享基境。这并非总是预期的方式，甚至有时是不可能的。:numref:`fixtures.examples.StackTest.php`展示了另外一个编写测试 ``StackTest`</cite> 的方式。在这个方式中，不再重用基境本身，而是重用建立基境的代码。首先声明一个实例变量，<code class="docutils literal notranslate"><span class="pre">$stack</span></code>，用来替代方法内的局部变量。然后把 <code class="docutils literal notranslate"><span class="pre">array</span></code> 基境的建立放到 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 方法中。最后，从测试方法中去除冗余代码，在 <code class="docutils literal notranslate"><span class="pre">assertEquals()</span></code> 断言方法中使用新引入的实例变量 <code class="docutils literal notranslate"><span class="pre">$this-&gt;stack``替代方法内的局部变量</span> <span class="pre">``$stack</span></code>。</p>
<div class="literal-block-wrapper docutils container" id="fixtures-examples-stacktest-php">
<div class="code-block-caption"><span class="caption-text">用 setUp() 建立栈的基境</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StackTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$stack</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEmpty</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPush</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPop</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stack</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>测试类的每个测试方法都会运行一次 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 模板方法（同时，每个测试方法都是在一个全新的测试类实例上运行的）。</p>
<p>另外，<code class="docutils literal notranslate"><span class="pre">setUpBeforeClass()</span></code> 与 <code class="docutils literal notranslate"><span class="pre">tearDownAfterClass()</span></code> 模板方法将分别在测试用例类的第一个测试运行之前和测试用例类的最后一个测试运行之后调用。</p>
<p>下面这个例子中展示了测试用例类中所有可用的模板方法。</p>
<div class="literal-block-wrapper docutils container" id="fixtures-examples-templatemethodstest-php">
<div class="code-block-caption"><span class="caption-text">展示所有可用模板方法的例子</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TemplateMethodsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setUpBeforeClass</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">assertPreConditions</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOne</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testTwo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">assertPostConditions</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">tearDownAfterClass</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">onNotSuccessfulTest</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span> <span class="no">__METHOD__</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit TemplateMethodsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

TemplateMethodsTest::setUpBeforeClass
TemplateMethodsTest::setUp
TemplateMethodsTest::assertPreConditions
TemplateMethodsTest::testOne
TemplateMethodsTest::assertPostConditions
TemplateMethodsTest::tearDown
.TemplateMethodsTest::setUp
TemplateMethodsTest::assertPreConditions
TemplateMethodsTest::testTwo
TemplateMethodsTest::tearDown
TemplateMethodsTest::onNotSuccessfulTest
FTemplateMethodsTest::tearDownAfterClass

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> TemplateMethodsTest::testTwo
Failed asserting that &lt;boolean:false&gt; is true.
/home/sb/TemplateMethodsTest.php:30

FAILURES!
Tests: <span class="m">2</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<div class="section" id="setup-teardown">
<span id="fixtures-more-setup-than-teardown"></span><h3>setUp() 多 tearDown() 少</h3>
<p>理论上说，<code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 是精确对称的，但是实践中并非如此。实际上，只有在 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 中分配了诸如文件或套接字之类的外部资源时才需要实现 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 。如果 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 中只创建纯 PHP 对象，通常可以略过 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code>。不过，如果在 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 中创建了大量对象，你可能想要在 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 中 <code class="docutils literal notranslate"><span class="pre">unset()</span></code> 指向这些对象的变量，这样它们就可以被垃圾回收机制回收掉。对测试用例对象的垃圾回收动作则是不可预知的。</p>
<p>变体
##</p>
<p>如果两个基境建立工作略有不同的测试该怎么办？有两种可能：</p>
<ul class="simple">
<li>如果两个 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 代码仅有微小差异，把有差异的代码内容从 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 移到测试方法内。</li>
<li>如果两个 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 是确实不一样，那么需要另外一个测试用例类。参考基境建立工作的不同之处来命名这个类。</li>
</ul>
</div>
<div class="section" id="fixtures-sharing-fixture">
<span id="id1"></span><h3>基境共享</h3>
<p>有几个好的理由来在测试之间共享基境，但是大部分情况下，在测试之间共享基境的需求都源于某个未解决的设计问题。</p>
<p>一个有实际意义的多测试间共享基境的例子是数据库连接：只登录数据库一次，然后重用此连接，而不是每个测试都建立一个新的数据库连接。这样能加快测试的运行。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">fixtures.sharing-fixture.examples.DatabaseTest.php`用</span> <span class="pre">``setUpBeforeClass()`</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tearDownAfterClass()</span></code> 模板方法来分别在测试用例类的第一个测试之前和最后一个测试之后连接与断开数据库。</p>
<div class="literal-block-wrapper docutils container" id="fixtures-sharing-fixture-examples-databasetest-php">
<div class="code-block-caption"><span class="caption-text">在同一个测试套件内的不同测试之间共享基境</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="nv">$dbh</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setUpBeforeClass</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;sqlite::memory:&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">tearDownAfterClass</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>需要反复强调的是：在测试之间共享基境会降低测试的价值。潜在的设计问题是对象之间并非松散耦合。如果解决掉潜在的设计问题并使用桩件(stub)（参见:ref:<cite>test-doubles</cite>）来编写测试，就能达成更好的结果，而不是在测试之间产生运行时依赖并错过改进设计的机会。</p>
</div>
<div class="section" id="fixtures-global-state">
<span id="id2"></span><h3>全局状态</h3>
<p><a href="#id3"><span class="problematic" id="id4">`</span></a>使用单件(singleton)的代码很难测试。 &lt;<a class="reference external" href="http://googletesting.blogspot.com/2008/05/tott-using-dependancy-injection-to.html">http://googletesting.blogspot.com/2008/05/tott-using-dependancy-injection-to.html</a>&gt;`_使用全局变量的代码也一样。通常情况下，欲测代码和全局变量之间会强烈耦合，并且其创建无法控制。另外一个问题是，一个测试对全局变量的改变可能会破坏另外一个测试。</p>
<p>在 PHP 中，全局变量是这样运作的：</p>
<ul class="simple">
<li>全局变量 <code class="docutils literal notranslate"><span class="pre">$foo</span> <span class="pre">=</span> <span class="pre">'bar';</span></code> 实际上是存储为 <code class="docutils literal notranslate"><span class="pre">$GLOBALS['foo']</span> <span class="pre">=</span> <span class="pre">'bar';</span></code> 的。</li>
<li><a href="#id5"><span class="problematic" id="id6">``</span></a>$GLOBALS``这个变量是一种被称为*超全局*变量的变量。</li>
<li>超全局变量是一种在任何变量作用域中都总是可用的内建变量。</li>
<li>在函数或者方法的变量作用域中，要访问全局变量 <code class="docutils literal notranslate"><span class="pre">$foo</span></code>，可以直接访问 <code class="docutils literal notranslate"><span class="pre">$GLOBALS['foo']</span></code>，或者用 <code class="docutils literal notranslate"><span class="pre">global</span> <span class="pre">$foo;</span></code> 来创建一个引用全局变量的局部变量。</li>
</ul>
<p>除了全局变量，类的静态属性也是一种全局状态。</p>
<p>在版本 6 之前，默认情况下，PHPUnit 用一种更改全局变量与超全局变量(<code class="docutils literal notranslate"><span class="pre">$GLOBALS</span></code>、<code class="docutils literal notranslate"><span class="pre">$_ENV</span></code>、<code class="docutils literal notranslate"><span class="pre">$_POST</span></code>、<code class="docutils literal notranslate"><span class="pre">$_GET</span></code>、<code class="docutils literal notranslate"><span class="pre">$_COOKIE</span></code>、<code class="docutils literal notranslate"><span class="pre">$_SERVER</span></code>、<code class="docutils literal notranslate"><span class="pre">$_FILES</span></code>、<code class="docutils literal notranslate"><span class="pre">$_REQUEST</span></code>)不会影响到其他测试的方式来运行所有测试。</p>
<p>在版本 6 中，默认情况下 PHPUnit 不再对全局变量和超全局变量进行这种备份与恢复的操作。可以用 <code class="docutils literal notranslate"><span class="pre">--globals-backup</span></code> 选项或在 XML 配置文件中用 <code class="docutils literal notranslate"><span class="pre">backupGlobals=&quot;true&quot;</span></code> 将其激活。</p>
<p>通过用 <code class="docutils literal notranslate"><span class="pre">--static-backup</span></code> 选项或在 XML 配置文件中设置option or setting <code class="docutils literal notranslate"><span class="pre">backupStaticAttributes=&quot;true&quot;</span></code>，可以将此隔离扩展到类的静态属性。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p>对全局变量和类的静态属性的备份与还原操作使用了 <code class="docutils literal notranslate"><span class="pre">serialize()</span></code> 与 <code class="docutils literal notranslate"><span class="pre">unserialize()</span></code>。</p>
<p class="last">某些类的实例对象（比如 <code class="docutils literal notranslate"><span class="pre">PDO</span></code>）无法序列化，因此如果把这样一个对象存放在比如说 <code class="docutils literal notranslate"><span class="pre">$GLOBALS</span></code> 数组内时，备份操作就会出问题。</p>
</div>
<p>在:ref:<cite>appendixes.annotations.backupGlobals`中所讨论的 ``&#64;backupGlobals`</cite> 标注可以用来控制对全局变量的备份与还原操作。另外，还可以提供一个全局变量的黑名单，黑名单中的全局变量将被排除于备份与还原操作之外，就像这样：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$backupGlobalsBlacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;globalVariable&#39;</span><span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">在方法（例如 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 方法）内对 <code class="docutils literal notranslate"><span class="pre">$backupGlobalsBlacklist</span></code> 属性进行设置是无效的。</p>
</div>
<p>在 <a class="reference internal" href="index.html#appendixes-annotations-backupstaticattributes"><span class="std std-ref">&#64;backupStaticAttributes</span></a> 中提到的 <code class="docutils literal notranslate"><span class="pre">&#64;backupStaticAttributes</span></code> 标注可以用于在每个测试之前备份所有已声明类的静态属性值并在其后恢复。</p>
<p>它所处理的并不只是测试类自身，而是在测试开始时已声明的所有类。它只作用于静态类属性，不作用于函数内声明的静态变量。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p>只有启用了 <code class="docutils literal notranslate"><span class="pre">&#64;backupStaticAttributes</span></code> 的测试方法才会在方法之前执行此操作。如果在此之前运行的某个没有启用 <code class="docutils literal notranslate"><span class="pre">&#64;backupStaticAttributes</span></code> 的测试方法改变了静态属性的值，那么被备份及还原的将会是这个改变后的值——而非初始声明时提供的默认值。PHP 并不额外记录任何静态变量的声明时提供的初始默认值。</p>
<p>同样的情况也发生于测试内部新加载/声明的类的静态属性上。它们也无法在测试结束之后复原为声明时提供的原始默认值，因为无从得知这些默认值。这些被修改过的值会泄漏到后继测试中。</p>
<p class="last">对单元测试而言，推荐在 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 中显式的重置测试中使用到的静态属性（最好同时在 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 中执行重置，这样就保证不会影响到后继的测试）。</p>
</div>
<p>可以提供黑名单来将静态属性从备份与还原操作中排除出去：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$backupStaticAttributesBlacklist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;className&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;attributeName&#39;</span><span class="p">]</span>
    <span class="p">];</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">在方法（例如  <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> ）内对 <code class="docutils literal notranslate"><span class="pre">$backupStaticAttributesBlacklist</span></code> 属性进行设置是无效的。</p>
</div>
</div>
</div>
<span id="document-organizing-tests"></span><div class="section" id="organizing-tests">
<span id="id1"></span><h2>组织测试</h2>
<p>PHPUnit 的目标之一是测试应当可组合：我们希望能将任意数量的测试以任意组合方式运行，例如，整个项目的所有测试，或者项目中的某个组件内的所有类的测试，又或者仅仅某单个类的测试。</p>
<p>PHPUnit 支持好几种不同的方式来组织测试以及将它们编排组合成测试套件。本章介绍了最常用的方法。</p>
<div class="section" id="organizing-tests-filesystem">
<span id="id2"></span><h3>用文件系统来编排测试套件</h3>
<p>编排测试套件的各种方式中，最简单的大概就是把所有测试用例源文件放在一个测试目录中。通过对测试目录进行递归遍历，PHPUnit 能自动发现并运行测试。</p>
<p>现在来看看 <a class="reference external" href="http://github.com/sebastianbergmann/money/">sebastianbergmann/money</a> 这个库的测试套件。在这个项目的目录结构中，可以看到 <code class="file docutils literal notranslate"><span class="pre">tests</span></code> 目录下的测试用例类镜像了 <code class="file docutils literal notranslate"><span class="pre">src</span></code> 目录下被测系统(SUT, System Under Test)的包(package)与类(class)的结构：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>src                                 tests
<span class="sb">`</span>-- Currency.php                    <span class="sb">`</span>-- CurrencyTest.php
<span class="sb">`</span>-- IntlFormatter.php               <span class="sb">`</span>-- IntlFormatterTest.php
<span class="sb">`</span>-- Money.php                       <span class="sb">`</span>-- MoneyTest.php
<span class="sb">`</span>-- autoload.php
</pre></div>
</div>
<p>要运行这个库的全部测试，只要将 PHPUnit 命令行测试执行器指向测试目录即可：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --bootstrap src/autoload.php tests
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann.

.................................

Time: <span class="m">636</span> ms, Memory: <span class="m">3</span>.50Mb

OK <span class="o">(</span><span class="m">33</span> tests, <span class="m">52</span> assertions<span class="o">)</span>
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">当 PHPUnit 命令行测试执行器指向一个目录时，它会在目录下查找 <code class="file docutils literal notranslate"><span class="pre">*Test.php</span></code> 文件。</p>
</div>
<p>如果只想运行在 <code class="docutils literal notranslate"><span class="pre">CurrencyTest</span></code> 文件中的 <code class="file docutils literal notranslate"><span class="pre">tests/CurrencyTest.php</span></code> 测试用例类中声明的测试，可以使用如下命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --bootstrap src/autoload.php tests/CurrencyTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann.

........

Time: <span class="m">280</span> ms, Memory: <span class="m">2</span>.75Mb

OK <span class="o">(</span><span class="m">8</span> tests, <span class="m">8</span> assertions<span class="o">)</span>
</pre></div>
</div>
<p>如果想要对运行哪些测试有更细粒度的控制，可以使用 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 选项：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --bootstrap src/autoload.php --filter testObjectCanBeConstructedForValidConstructorArgument tests
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann.

..

Time: <span class="m">167</span> ms, Memory: <span class="m">3</span>.00Mb

OK <span class="o">(</span><span class="m">2</span> test, <span class="m">2</span> assertions<span class="o">)</span>
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">这种方法的缺点是无法控制测试的运行顺序。这可能导致测试的依赖关系方面的问题，参见 <a class="reference internal" href="index.html#writing-tests-for-phpunit-test-dependencies"><span class="std std-ref">测试的依赖关系</span></a>。在下一节中，可以看到如何用 XML 配置文件来明确指定测试的执行顺序。</p>
</div>
</div>
<div class="section" id="xml">
<span id="organizing-tests-xml-configuration"></span><h3>用 XML 配置来编排测试套件</h3>
<p>PHPUnit的 XML 配置文件（<a class="reference internal" href="index.html#appendixes-configuration"><span class="std std-ref">XML 配置文件</span></a>）也可以用于编排测试套件。<code class="xref std std-numref docutils literal notranslate"><span class="pre">organizing-tests.xml-configuration.examples.phpunit.xml`展示了一个最小化的</span> <span class="pre">:file:`phpunit.xml</span></code> 例子，它将在递归遍历 <code class="file docutils literal notranslate"><span class="pre">tests</span></code> 时添加所有在 <code class="file docutils literal notranslate"><span class="pre">*Test.php</span></code> 文件中找到的 <code class="docutils literal notranslate"><span class="pre">*Test</span></code> 类。</p>
<div class="literal-block-wrapper docutils container" id="organizing-tests-xml-configuration-examples-phpunit-xml">
<div class="code-block-caption"><span class="caption-text">用 XML 配置来编排测试套件</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">phpunit</span> <span class="nx">bootstrap</span><span class="o">=</span><span class="s2">&quot;src/autoload.php&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">testsuites</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">testsuite</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;money&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">directory</span><span class="o">&gt;</span><span class="nx">tests</span><span class="o">&lt;/</span><span class="nx">directory</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="nx">testsuite</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="nx">testsuites</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">phpunit</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>如果 <code class="file docutils literal notranslate"><span class="pre">phpunit.xml</span></code> 或 <code class="file docutils literal notranslate"><span class="pre">phpunit.xml.dist</span></code> （按此顺序）存在于当前工作目录并且*未*使用 <code class="docutils literal notranslate"><span class="pre">--configuration</span></code>，将自动从此文件中读取配置。</p>
<p>可以明确指定测试的执行顺序：</p>
<div class="literal-block-wrapper docutils container" id="organizing-tests-xml-configuration-examples-phpunit-xml2">
<div class="code-block-caption"><span class="caption-text">用 XML 配置来编排测试套件</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">phpunit</span> <span class="nx">bootstrap</span><span class="o">=</span><span class="s2">&quot;src/autoload.php&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">testsuites</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">testsuite</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;money&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">file</span><span class="o">&gt;</span><span class="nx">tests</span><span class="o">/</span><span class="nx">IntlFormatterTest</span><span class="o">.</span><span class="nx">php</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">file</span><span class="o">&gt;</span><span class="nx">tests</span><span class="o">/</span><span class="nx">MoneyTest</span><span class="o">.</span><span class="nx">php</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">file</span><span class="o">&gt;</span><span class="nx">tests</span><span class="o">/</span><span class="nx">CurrencyTest</span><span class="o">.</span><span class="nx">php</span><span class="o">&lt;/</span><span class="nb">file</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="nx">testsuite</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="nx">testsuites</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">phpunit</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-risky-tests"></span><div class="section" id="risky-tests">
<span id="id1"></span><h2>有风险的测试</h2>
<p>在执行测试时，PHPUnit 可以进行一些额外的检查，见下文。</p>
<div class="section" id="risky-tests-useless-tests">
<span id="id2"></span><h3>无用测试</h3>
<p>PHPUnit 可以更严格对待事实上不测试任何内容的测试。此项检查可以用命令行选项 <code class="docutils literal notranslate"><span class="pre">--report-useless-tests</span></code> 或在 PHPUnit 的 XML 配置文件中设置  <code class="docutils literal notranslate"><span class="pre">beStrictAboutTestsThatDoNotTestAnything=&quot;true&quot;</span></code> 来启用。</p>
<p>在启用本项检查后，如果某个测试未进行任何断言，它将被标记为有风险。仿件对象中的预期和诸如 &#64;expectedException 这样的标注同样视为断言。</p>
</div>
<div class="section" id="risky-tests-unintentionally-covered-code">
<span id="id3"></span><h3>意外的代码覆盖</h3>
<p>PHPUnit 可以更严格对待意外的代码覆盖。此项检查可以用命令行选项 <code class="docutils literal notranslate"><span class="pre">--strict-coverage</span></code> 或在 PHPUnit 的 XML 配置文件中设置 <code class="docutils literal notranslate"><span class="pre">beStrictAboutCoversAnnotation=&quot;true&quot;</span></code> 来启用。</p>
<p>在启用本项检查后，如果某个带有 &#64;covers 标注的测试执行了未在 &#64;covers 或 &#64;uses 标注中列出的代码，它将被标记为有风险。</p>
</div>
<div class="section" id="risky-tests-output-during-test-execution">
<span id="id4"></span><h3>测试执行期间产生的输出</h3>
<p>PHPUnit 可以更严格对待测试执行期间产生的输出。 此项检查可以用命令行选项 <code class="docutils literal notranslate"><span class="pre">--disallow-test-output</span></code> 或在 PHPUnit 的 XML 配置文件中设置 <code class="docutils literal notranslate"><span class="pre">beStrictAboutOutputDuringTests=&quot;true&quot;</span></code> 来启用。</p>
<p>在启用本项检查后，如果某个测试产生了输出，例如，在测试代码或被测代码中调用了 print，它将被标记为有风险。</p>
</div>
<div class="section" id="risky-tests-test-execution-timeout">
<span id="id5"></span><h3>测试执行时长的超时限制</h3>
<p>如果安装了 <code class="docutils literal notranslate"><span class="pre">PHP_Invoker</span></code> 包并且 <code class="docutils literal notranslate"><span class="pre">pcntl</span></code> 扩展可用，那么可以对测试的执行时长进行限制。此时间限制可以用命令行选项 <code class="docutils literal notranslate"><span class="pre">--enforce-time-limit</span></code> 或在 PHPUnit 的 XML 配置文件中设置 <code class="docutils literal notranslate"><span class="pre">beStrictAboutTestSize=&quot;true&quot;</span></code> 来启用。</p>
<p>带有 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 标注的测试如果执行时间超过60秒将视为失败。此超时限制可以通过XML配置文件中的 <code class="docutils literal notranslate"><span class="pre">timeoutForLargeTests</span></code> 属性进行配置。</p>
<p>带有 <code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 标注的测试如果执行时间超过10秒将视为失败。此超时限制可以通过XML配置文件中的 <code class="docutils literal notranslate"><span class="pre">timeoutForMediumTests</span></code> 属性进行配置。</p>
<p>没有 <code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 标注的测试都将视同为带有 <code class="docutils literal notranslate"><span class="pre">&#64;small``标注，这类测试如果执行时间超过1秒将视为失败。此超时限制可以通过XML配置文件中的</span> <span class="pre">``timeoutForSmallTests</span></code> 属性进行配置。</p>
</div>
<div class="section" id="risky-tests-global-state-manipulation">
<span id="id6"></span><h3>全局状态篡改</h3>
<p>PHPUnit 可以更严格对待篡改全局状态的测试。此项检查可以用命令行选项 <code class="docutils literal notranslate"><span class="pre">--strict-global-state</span></code> 或在 PHPUnit 的 XML 配置文件中设置 <code class="docutils literal notranslate"><span class="pre">beStrictAboutChangesToGlobalState=&quot;true&quot;</span></code> 来启用。</p>
</div>
</div>
<span id="document-incomplete-and-skipped-tests"></span><div class="section" id="incomplete-and-skipped-tests">
<span id="id1"></span><h2>未完成的测试与跳过的测试</h2>
<div class="section" id="incomplete-and-skipped-tests-incomplete-tests">
<span id="id2"></span><h3>未完成的测试</h3>
<p>开始写新的测试用例类时，可能想从写下空测试方法开始，比如：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>以此来跟踪需要编写的测试。空测试的问题是 PHPUnit 框架会将它们解读为成功。这种错误解读导致错误报告变得毫无用处——无法分辨出测试是真的成功了还是根本就未编写实现。在未实现的测试中调用 <code class="docutils literal notranslate"><span class="pre">$this-&gt;fail()</span></code> 同样没啥帮助，因为测试将被解读为失败。这和将未实现的测试解读为成功是一样的错误。</p>
<p>假如把成功的测试视为绿灯、测试失败视为红灯，那么还额外需要黄灯来将测试标记为未完成或尚未实现。<code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_IncompleteTest</span></code> 是一个标记接口，用于将测试方法抛出的异常标记为测试未完成或目前尚未实现而导致的结果。<code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_IncompleteTestError</span></code> 是这个接口的标准实现。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">incomplete-and-skipped-tests.incomplete-tests.examples.SampleTest.php`展示了一个测试用例类</span> <span class="pre">``SampleTest`</span></code>，它有一个测试方法 <code class="docutils literal notranslate"><span class="pre">testSomething()</span></code>。通过在测试方法中调用便捷方法 <code class="docutils literal notranslate"><span class="pre">markTestIncomplete()</span></code> （会自动抛出一个 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_IncompleteTestError</span></code> 异常）将这个测试标记为未完成。</p>
<div class="literal-block-wrapper docutils container" id="incomplete-and-skipped-tests-incomplete-tests-examples-sampletest-php">
<div class="code-block-caption"><span class="caption-text">将测试标记为未完成</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 可选：如果愿意，在这里随便测试点什么。</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="s1">&#39;这应该已经是能正常工作的。&#39;</span><span class="p">);</span>

        <span class="c1">// 在这里停止，并将此测试标记为未完成。</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">markTestIncomplete</span><span class="p">(</span>
          <span class="s1">&#39;此测试目前尚未实现。&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在 PHPUnit 命令行测试执行器的输出中，未完成的测试记为 <code class="docutils literal notranslate"><span class="pre">I</span></code>，如下例所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --verbose SampleTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

I

Time: <span class="m">0</span> seconds, Memory: <span class="m">3</span>.95Mb

There was <span class="m">1</span> incomplete test:

<span class="m">1</span><span class="o">)</span> SampleTest::testSomething
This <span class="nb">test</span> has not been implemented yet.

/home/sb/SampleTest.php:12
OK, but incomplete or skipped tests!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Incomplete: <span class="m">1</span>.
</pre></div>
</div>
<p>:numref:<a href="#id3"><span class="problematic" id="id4">`</span></a>incomplete-and-skipped-tests.incomplete-tests.tables.api`列举了用于将测试标记为未完成的 API。</p>
<table border="1" class="table docutils" id="incomplete-and-skipped-tests-incomplete-tests-tables-api">
<caption><span class="caption-text">用于未完成的测试的 API</span></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">方法</th>
<th class="head">含义</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">markTestIncomplete()</span></code></td>
<td>将当前测试标记为未完成。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">markTestIncomplete(string</span> <span class="pre">$message)</span></code></td>
<td>将当前测试标记为未完成，并用 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 作为说明信息。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="incomplete-and-skipped-tests-skipping-tests">
<span id="id5"></span><h3>跳过测试</h3>
<p>并非所有测试都能在任何环境中运行。比如说，考虑这样一种情况：一个数据库抽象层，针对其所支持的各种数据库系统有多个不同的驱动程序。针对 MySQL 驱动程序的测试当然只在 MySQL 服务器可用才能运行。</p>
<p><a class="reference internal" href="#incomplete-and-skipped-tests-skipping-tests-examples-databasetest-php"><span class="std std-numref">Example 7.2</span></a> 展示了一个测试用例类 <code class="docutils literal notranslate"><span class="pre">DatabaseTest</span></code>，它有一个测试方法 <code class="docutils literal notranslate"><span class="pre">testConnection()</span></code>。在测试用例类的 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 模板方法中，检查了 MySQLi 扩展是否可用，并且在扩展不可用时用 <code class="docutils literal notranslate"><span class="pre">markTestSkipped()</span></code> 方法来跳过此测试。</p>
<div class="literal-block-wrapper docutils container" id="incomplete-and-skipped-tests-skipping-tests-examples-databasetest-php">
<div class="code-block-caption"><span class="caption-text">跳过某个测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">extension_loaded</span><span class="p">(</span><span class="s1">&#39;mysqli&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">markTestSkipped</span><span class="p">(</span>
              <span class="s1">&#39;MySQLi 扩展不可用。&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在 PHPUnit 命令行测试执行器的输出中，被跳过的测试记为 <code class="docutils literal notranslate"><span class="pre">S</span></code>，如下例所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --verbose DatabaseTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

S

Time: <span class="m">0</span> seconds, Memory: <span class="m">3</span>.95Mb

There was <span class="m">1</span> skipped test:

<span class="m">1</span><span class="o">)</span> DatabaseTest::testConnection
The MySQLi extension is not available.

/home/sb/DatabaseTest.php:9
OK, but incomplete or skipped tests!
Tests: <span class="m">1</span>, Assertions: <span class="m">0</span>, Skipped: <span class="m">1</span>.
</pre></div>
</div>
<p>:numref:<a href="#id6"><span class="problematic" id="id7">`</span></a>incomplete-and-skipped-tests.skipped-tests.tables.api`列举了用于跳过测试的 API。</p>
<table border="1" class="table docutils" id="incomplete-and-skipped-tests-skipped-tests-tables-api">
<caption><span class="caption-text">用于跳过测试的 API</span></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">方法</th>
<th class="head">含义</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">markTestSkipped()</span></code></td>
<td>将当前测试标记为已跳过。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">markTestSkipped(string</span> <span class="pre">$message)</span></code></td>
<td>将当前测试标记为已跳过，并用 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 作为说明信息。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="requires">
<span id="incomplete-and-skipped-tests-skipping-tests-using-requires"></span><h3>用 &#64;requires 来跳过测试</h3>
<p>除了上述方法，还可以用 <code class="docutils literal notranslate"><span class="pre">&#64;requires</span></code> 标注来表达测试用例的一些常见前提条件。</p>
<table border="1" class="table docutils" id="incomplete-and-skipped-tests-requires-tables-api">
<caption><span class="caption-text">可能的 &#64;requires 用法</span></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">类型</th>
<th class="head">可能的值</th>
<th class="head">范例</th>
<th class="head">其他范例</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHP</span></code></td>
<td>任何 PHP 版本标识符</td>
<td>&#64;requires PHP 5.3.3</td>
<td>&#64;requires PHP 7.1-dev</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit</span></code></td>
<td>任何 PHPUnit 版本标识符</td>
<td>&#64;requires PHPUnit 3.6.3</td>
<td>&#64;requires PHPUnit 4.6</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">OS</span></code></td>
<td>用来对 <a class="reference external" href="http://php.net/manual/en/reserved.constants.php#constant.php-os">PHP_OS</a> 进行匹配的正则表达式</td>
<td>&#64;requires OS Linux</td>
<td>&#64;requires OS WIN32|WINNT</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">function</span></code></td>
<td>任何对 <a class="reference external" href="http://php.net/function_exists">function_exists</a> 而言有效的参数</td>
<td>&#64;requires function imap_open</td>
<td>&#64;requires function ReflectionMethod::setAccessible</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">extension</span></code></td>
<td>任何扩展模块名，可以附带有版本标识符</td>
<td>&#64;requires extension mysqli</td>
<td>&#64;requires extension redis 2.2.0</td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="incomplete-and-skipped-tests-skipping-tests-examples-databaseclassskippingtest-php">
<div class="code-block-caption"><span class="caption-text">用 &#64;requires 来跳过测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @requires extension mysqli</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">DatabaseTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @requires PHP 5.3</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 测试要求有 mysqli 扩展，并且 PHP &gt;= 5.3</span>
    <span class="p">}</span>

    <span class="c1">// ... 所有其他要求有 mysqli 扩展的测试</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>如果使用了某种在特定版本的 PHP 下无法编译的语法，请在此章节内查找 XML 配置信息中关于版本依赖的信息：<a class="reference internal" href="index.html#appendixes-configuration-testsuites"><span class="std std-ref">测试套件</span></a></p>
</div>
</div>
<span id="document-database"></span><div class="section" id="database">
<span id="id1"></span><h2>数据库测试</h2>
<p>在各种编程语言中，许多入门与中级的单元测试范例都暗示着这样一种信息：很容易用简单的测试来对应用程序的逻辑进行测试。但是对于以数据库为中心的应用程序而言，这与现实相去甚远。一旦开始使用诸如 Wordpress、TYPO3、或 Symfony（配合 Doctrine 或 Propel）之类的东西，就很容易在用 PHPUnit 时碰到超多问题：正是由于这些库和数据库之间实在耦合的太紧密了。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">请确保已经安装了 PHP 扩展模块 <code class="docutils literal notranslate"><span class="pre">pdo</span></code> 和与数据库对应的特定扩展，比如 <code class="docutils literal notranslate"><span class="pre">pdo_mysql</span></code>。否则以下范例是无法运行的。</p>
</div>
<p>你大概会在日常工作面对的项目中经历这一幕。你打算把你那或生疏或纯熟的 PHPUnit 技能用到工作中去，结果被以下问题之一卡住了：</p>
<ol class="arabic simple">
<li>待测方法执行了一个相当大的 JOIN 操作，并且得到的数据用于计算某些重要的结果。</li>
<li>业务逻辑中混合执行了 SELECT、INSERT、UPDATE 和 DELETE 语句。</li>
<li>为了给待测方法建立合理的初始数据，需要在两个以上（可能远超过）表里设置测试数据。</li>
</ol>
<p>DbUnit 扩展大大简化了为测试设置数据库的操作，并且可以在对数据执行了一系列操作之后验证数据库的内容。</p>
<div class="section" id="database-supported-vendors-for-database-testing">
<span id="id2"></span><h3>数据库测试所支持的供应商</h3>
<p>DbUnit 目前支持 MySQL、PostgreSQL、Oracle 和 SQLite。通过集成 <a class="reference external" href="http://framework.zend.com">Zend Framework</a> 或 <a class="reference external" href="http://www.doctrine-project.org">Doctrine 2</a>，也可以访问其他数据库系统，比如 IBM DB2 或者 Microsoft SQL Server。</p>
</div>
<div class="section" id="database-difficulties-in-database-testing">
<span id="id3"></span><h3>数据库测试的难点</h3>
<p>为什么所有单元测试的范例都不包含数据库交互？这里有个很好的理由：这类测试的建立和维护都很复杂。对数据库进行测试时，需要考虑以下这些变数：</p>
<ul class="simple">
<li>数据库和表</li>
<li>向表中插入测试所需要的行</li>
<li>测试运行完毕后验证数据库的状态</li>
<li>每个新测试都要清理数据库</li>
</ul>
<p>许多数据库 API，比如 PDO、MySQLi 或者 OCI8，都十分繁琐且书写起来十分冗长，因此，手工进行这些步骤绝对是噩梦。</p>
<p>测试代码应当尽可能简短精确，这有若干原因：</p>
<ul class="simple">
<li>你不希望因为生产代码的小变更而需要对测试代码进行数量可观的修改。</li>
<li>你希望在哪怕好几个月以后也能轻松地阅读并理解测试代码。</li>
</ul>
<p>另外，必须认识到，对于代码而言，本质上来说数据库是全局输入变量。测试套件中的两个不同的测试可能是运行在同一个数据库上的，并且可能把数据重用好多次。一个测试中出现的失败很容易影响到后继测试的结果，从而让整个测试过程变得非常艰难。前面提到的清理步骤对于解决“数据库是全局输入“的问题是非常重要的。</p>
<p>DbUnit 以一种优雅的方式来帮助简化数据库测试中的所有这些问题。</p>
<p>PHPUnit 无法帮你解决的问题是，相对于不使用数据的测试而言，数据库测试是非常慢的。随着数据库交互规模的增大，运行测试可能需要耗费可观的时间。然而，只要保持每个测试所使用的数据量较小并且尽可能用非数据库测试来对代码进行测试，即使很大的测试套件也能轻松在一分钟内跑完。</p>
<p>以 <a class="reference external" href="http://www.doctrine-project.org">Doctrine 2</a> 为例，此项目的测试套件目前包含了大约1000个测试，其中将近一半访问了数据库。但是在一台安装了MySQL的普通的台式机上，整个测试套件依然能在15秒钟内跑完。</p>
</div>
<div class="section" id="database-the-four-stages-of-a-database-test">
<span id="id5"></span><h3>数据库测试的四个阶段</h3>
<p>Gerard Meszaros 在他的书《xUnit 测试模式》中列出了单元测试的四个阶段：</p>
<ol class="arabic">
<li><p class="first">建立基境(fixture)</p>
</li>
<li><p class="first">执行被测系统</p>
</li>
<li><p class="first">验证结果</p>
</li>
<li><p class="first">拆除基境(fixture)</p>
<blockquote>
<div><p><em>什么是基境(fixture)？</em></p>
<p>基境(fixture)是对开始执行某个测试时应用程序和数据库所处初始状态的描述。</p>
</div></blockquote>
</li>
</ol>
<p>对数据库进行测试至少要处理建立与拆除的步骤，在其中完成清理工作，并将所需的基境数据写入表内。因而，对于数据库扩展模块而言，在数据库测试中有很好的理由将这四个步骤还原成类似下面这样的工作流程，这个流程对于每个测试都会完整执行：</p>
<div class="section" id="database-clean-up-database">
<span id="id6"></span><h4>1. 清理数据库</h4>
<p>由于总是会有某个测试运行在并不确定表中是否有数据的数据库上，PHPUnit 在所有指定表上执行 TRUNCATE 操作来把它们清空。</p>
</div>
<div class="section" id="database-set-up-fixture">
<span id="id7"></span><h4>2. 建立基境</h4>
<p>PHPUnit 随后将迭代所有指定的基境数据行并将其插入到对应的表里。</p>
</div>
<div class="section" id="database-run-test-verify-outcome-and-teardown">
<span id="id8"></span><h4>3–5. 运行测试、验证结果、并拆除基境</h4>
<p>在所有数据库都完成重置并加载好初始状态后，PHPUnit 才会执行实际的测试。这个部分的测试代码完全不需要数据库扩展模块的参与，可以随意测试任何想要测试的内容。</p>
<p>在测试中，验证的目的可以使用一个名为 <code class="docutils literal notranslate"><span class="pre">assertDataSetsEqual()</span></code> 的特殊断言来实现。当然，这完全是可选的。这个特性将在“数据库断言“一节中进行解说。</p>
</div>
</div>
<div class="section" id="phpunit">
<span id="database-configuration-of-a-phpunit-database-testcase"></span><h3>PHPUnit 数据库测试用例的配置</h3>
<p>一般而言，使用 PHPUnit 时，测试用例都是按如下方式扩展自 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code> 类：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCalculate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>如果测试代码用到了数据库扩展模块，那么建立的过程就会更复杂一些，需要扩展另一个抽象 TestCase 类，它要求实现两个抽象方法，<code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">getDataSet()</span></code>：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyGuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;sqlite::memory:&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createDefaultDBConnection</span><span class="p">(</span><span class="nv">$pdo</span><span class="p">,</span> <span class="s1">&#39;:memory:&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return PHPUnit_Extensions_Database_DataSet_IDataSet</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXMLDataSet</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;/_files/guestbook-seed.xml&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="getconnection">
<span id="database-implementing-getconnection"></span><h4>实现 getConnection()</h4>
<p>为了让清理与载入基境的功能正常运作，PHPUnit 数据库扩展模块需要用 PDO 库来实现跨供应商抽象访问数据库连接。重要的是要注意到，使用 PHPUnit 的数据库扩展模块并不要求应用程序本身基于PDO，PDO连接仅仅用于清理和建立基境。</p>
<p>在之前的例子里，我们在内存中创建 Sqlite 数据库并建立了连接，将此连接传递给 <code class="docutils literal notranslate"><span class="pre">createDefaultDBConnection</span></code> 方法，这个方法将 PDO 实例和第二参数（数据库名）包装在一个非常简单的数据库连接抽象层中，这个抽象层的类型是 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Extensions_Database_DB_IDatabaseConnection</span></code>。</p>
<p>“使用数据库连接“一节解说了这个接口的API以及如何充分利用它们。</p>
</div>
<div class="section" id="getdataset">
<span id="database-implementing-getdataset"></span><h4>实现 getDataSet()</h4>
<p><code class="docutils literal notranslate"><span class="pre">getDataSet()</span></code> 方法定义了在每个测试执行之前的数据库初始状态应该是什么样。数据库的状态通过由 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Extensions_Database_DataSet_IDataSet</span></code> 所代表的 DataSet（数据集）和由 <a href="#id9"><span class="problematic" id="id10">``</span></a>PHPUnit_Extensions_Database_DataSet_IDataTable``所代表的 DataTable（数据表）这两个概念进行抽象。下一节将详细讲述这些概念是如何运作的以及在数据库测试中使用它们有什么好处。</p>
<p>对于具体实现，只需要知道 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 中会调用一次 <code class="docutils literal notranslate"><span class="pre">getDataSet()</span></code> 方法来接收基境数据集并将其插入数据库。在范例中使用了工厂方法 <code class="docutils literal notranslate"><span class="pre">createFlatXMLDataSet($filename)</span></code>，它代表一个用 XML 表示的数据集。</p>
</div>
<div class="section" id="ddl">
<span id="database-what-about-the-database-schema-ddl"></span><h4>数据库构架(DDL)怎么办？</h4>
<p>PHPUnit 假设在测试运行之前数据库以及其中的所有表(table)、触发器(trigger)、序列(Sequence)和视图(view)都已经创建好。这意味着开发者必须在运行测试套件之前确保数据库已经正确建立。</p>
<p>有几种方法来达成这个数据库测试的先决条件。</p>
<ol class="arabic simple">
<li>如果使用的是持久化数据库(不是 Sqlite Memory)，可以很轻松地用 phpMyAdmin（针对MySQL）之类的工具来一次性建立数据库，并在每个测试中复用这个数据库。</li>
<li>如果使用的是诸如 <a class="reference external" href="http://www.doctrine-project.org">Doctrine 2</a> 或 <a class="reference external" href="http://www.propelorm.org/">Propel</a> 这样的库，可以用它们的API来在测试运行前一次性建立所需的数据库。可以利用 <a class="reference external" href="textui.html">PHPUnit 的引导和配置</a> 功能来在每次测试运行时执行这些代码。</li>
</ol>
</div>
<div class="section" id="testcase">
<span id="database-tip-use-your-own-abstract-database-testcase"></span><h4>小建议：使用你自己的抽象数据库 TestCase 类</h4>
<p>从前面的实现范例中容易发现 <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> 方法是相当稳定的，可以在不同的数据库测试用例中重用。另外，为了保持测试的性能良好和数据库的开销较低，可以对代码进行一点重构，来为应用程序形成一个通用的抽象测试用例，同时依然可以为每个具体测试用例指定不同的数据基境：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">MyApp_Tests_DatabaseTestCase</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="c1">// only instantiate pdo once for test clean-up/fixture load</span>
    <span class="k">static</span> <span class="k">private</span> <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="c1">// only instantiate PHPUnit_Extensions_Database_DB_IDatabaseConnection once per test</span>
    <span class="k">private</span> <span class="nv">$conn</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;sqlite::memory:&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createDefaultDBConnection</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span><span class="p">,</span> <span class="s1">&#39;:memory:&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>这个例子里，数据库连接信息硬编码在 PDO 连接里了。PHPUnit 有另外一个绝妙的特性，可以让这个 TestCase 类更加通用。通过 <a class="reference external" href="appendixes.configuration.html#appendixes.configuration.php-ini-constants-variables">XML 配置</a> 可以为每个测试单独配置数据库连接信息。首先，在应用程序的 tests/ 目录下创建 “phpunit.xml“ 文件，内容大体是这样：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span> ?&gt;
&lt;phpunit&gt;
    &lt;php&gt;
        &lt;var <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;DB_DSN&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;mysql:dbname=myguestbook;host=localhost&quot;</span> /&gt;
        &lt;var <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;DB_USER&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;user&quot;</span> /&gt;
        &lt;var <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;DB_PASSWD&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;passwd&quot;</span> /&gt;
        &lt;var <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;DB_DBNAME&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;myguestbook&quot;</span> /&gt;
    &lt;/php&gt;
&lt;/phpunit&gt;
</pre></div>
</div>
<p>现在可以修改 TestCase 类了，像这样：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Generic_Tests_DatabaseTestCase</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="c1">// only instantiate pdo once for test clean-up/fixture load</span>
    <span class="k">static</span> <span class="k">private</span> <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="c1">// only instantiate PHPUnit_Extensions_Database_DB_IDatabaseConnection once per test</span>
    <span class="k">private</span> <span class="nv">$conn</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;DB_DSN&#39;</span><span class="p">],</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">],</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;DB_PASSWD&#39;</span><span class="p">]</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createDefaultDBConnection</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span><span class="p">,</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;DB_DBNAME&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>现在可以从命令行界面以不同的配置来运行数据库测试套件了：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ user@desktop&gt; phpunit --configuration developer-a.xml MyTests/
$ user@desktop&gt; phpunit --configuration developer-b.xml MyTests/
</pre></div>
</div>
<p>在开发机上进行开发时能够轻松的针对不同的目标数据库来运行数据库测试显得非常重要。如果多个开发人员在同一个数据库连接上运行数据库测试，很容易因为竞态而导致测试失败。</p>
</div>
</div>
<div class="section" id="dataset-datatable">
<span id="database-understanding-datasets-and-datatables"></span><h3>理解 DataSet（数据集）和 DataTable（数据表）</h3>
<p>PHPUnit 的数据库扩展模块的核心概念是 DataSet（数据集）和 DataTable（数据表）。为了掌握如何使用 PHPUnit 进行测试，需要试着去了解这些简单的概念。DataSet（数据集）和 DataTable（数据表）是围绕着数据库表、行、列的抽象层。通过一套简单的API，底层数据库内容被隐藏在对象结构之下，同时，这个对象结构也可以用其他非数据库数据源来实现。</p>
<p>为了能比较实际内容和预期内容，这种抽象是必须的。预期内容可以用诸如 XML、 YAML、 CSV 文件或者 PHP 数组等方式来表达。DataSet 和 DataTable 接口以语义相似的方式模拟关系数据库存储，从而能够对这些概念上完全不同的数据源进行比较。</p>
<p>在测试中，数据库断言的工作流由以下三个简单的步骤组成：</p>
<ul class="simple">
<li>用表名称来指定数据库中的一个或多个表（实际上是指定了一个数据集）</li>
<li>用你喜欢的格式（YAML、XML等等）来指定预期数据集</li>
<li>断言这两个数据集陈述是彼此相等的。</li>
</ul>
<p>在 PHPUnit 的数据库扩展中，断言并非唯一使用 DataSet 和 DataTable 的情形。就像上一节中所展示的那样，它们也用于描述数据库的初始内容。数据库 TestCase 类强制要求定义一个基境数据集，随后用它来：</p>
<ul class="simple">
<li>根据此数据集所指定的所有表名，将数据库中对应表内的行全部删除。</li>
<li>将数据集内数据表中的所有行写入数据库。</li>
</ul>
<div class="section" id="database-available-implementations">
<span id="id13"></span><h4>可用的各种实现</h4>
<p>有三种不同类型的 DataSet/DataTable：</p>
<ul class="simple">
<li>基于文件的 DataSet 和 DataTable</li>
<li>基于查询的 DataSet 和 DataTable</li>
<li>筛选与组合 DataSet 和 DataTable</li>
</ul>
<p>基于文件的数据集和表一般用于初始化基境或描述数据库的预期状态。</p>
<div class="section" id="flat-xml-dataset-xml">
<span id="database-flat-xml-dataset"></span><h5>Flat XML DataSet （平直 XML 数据集）</h5>
<p>最常见的一种数据集名叫 Flat XML。这是一种非常简单的 XML 格式，根节点为 <code class="docutils literal notranslate"><span class="pre">&lt;dataset&gt;</span></code>，根节点下的每个标签就代表数据库中的一行数据。标签的名称就等于表名，而每个属性代表一个列。一个简单的留言本应用程序的例子大致上可能是这样：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello buddy!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;joe&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-24 17:15:23&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;I like it!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;nancy&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-26 12:14:20&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>显然，这非常易于编写。在这里，<code class="docutils literal notranslate"><span class="pre">&lt;guestbook&gt;</span></code> 是表名，这个表内有两行记录，每行有四个列：“id“、“content“、“user“ 和 “created“，以及各自的值。</p>
<p>不过，这种简单性是有代价的。</p>
<p>从上面这个例子里不太容易看出该如何指定一个空表。其实可以插入一个没有属性值的标签，以空表的名字作为标签名。空的 guestbook 表所对应的 Flat XML 文件大致上可能是这样：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>在 Flat XML DataSet 中，要处理 NULL 值会非常烦。在几乎所有数据库中（Oracle 是个例外），NULL 值和空字符串值是有区别的，这一点在 Flat XML 格式中很难表述。可以在数据行的表述中省略掉对应的属性来表示NULL值。假定上面这个留言本通过在 user 列使用 NULL 值的方式来允许匿名留言，那么 guestbook 表的内容可能是这样：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello buddy!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;joe&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-24 17:15:23&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;I like it!&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-26 12:14:20&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>在这个例子里第二个条目是匿名发表的。但是这为列的识别带来了一个非常严重的问题。在数据集相等断言的判定过程中，每个数据集都需要指明每个表拥有哪些列。如果有一个列在数据表的所有行里其值都是 NULL，那么数据库扩展模块又该从何得知表中包含这个列呢？</p>
<p>在这里，Flat XML DataSet 做了一个关键假设：一个表的列信息由此表第一行的属性定义决定。在上面这个例子里，这意味着 guestbook 有 “id“、“content“、“user“ 和 “created“ 这几个列。第二行中 “user“ 列没有定义，因此将向数据库中插入 NULL 值。</p>
<p>如果从数据集中删掉第一行，因为没有指定 “user“，guestbook 表拥有的列就只剩下 “id“、“content“ 和 “created“。</p>
<p>要在有 NULL 值的情况下有效地使用 Flat XML Dataset，就必须保证每个表的第一行不包含 NULL 值，只有后继的那些行才能省略属性。这就有点棘手，因为数据行的排列顺序也是数据断言的一个相关因素。</p>
<p>反过来，如果在 Flat XML Dataset 中只指明了实际表中所有列的某个子集，那么所有省略掉的列都会设为它们的的默认值。如果某个省略掉的列的定义是 “NOT NULL DEFAULT NULL“，就会出现错误。</p>
<p>总的来说，建议只在不需要 NULL 值的情况下使用 Flat XML Dataset。</p>
<p>可以在数据库 TestCase 中调用 <code class="docutils literal notranslate"><span class="pre">createFlatXmlDataSet($filename)</span></code> 方法来创建 Flat XML Dataset 实例：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTestCase</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s1">&#39;myFlatXmlFixture.xml&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="xml-dataset-xml">
<span id="database-xml-dataset"></span><h5>XML DataSet （XML 数据集）</h5>
<p>有另外一种更加结构化的 XML DataSet，它写起来有点冗长，但是规避了 Flat XML DataSet 所存在的 NULL 问题。在根节点 <code class="docutils literal notranslate"><span class="pre">&lt;dataset&gt;</span></code> 内，可以指定 <code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;column&gt;</span></code>、 <code class="docutils literal notranslate"><span class="pre">&lt;row&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;null</span> <span class="pre">/&gt;</span></code> 标签。和上面用 Flat XML 所定义的留言本数据集等价的 XML DataSet 如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;table <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;guestbook&quot;</span>&gt;
        &lt;column&gt;id&lt;/column&gt;
        &lt;column&gt;content&lt;/column&gt;
        &lt;column&gt;user&lt;/column&gt;
        &lt;column&gt;created&lt;/column&gt;
        &lt;row&gt;
            &lt;value&gt;1&lt;/value&gt;
            &lt;value&gt;Hello buddy!&lt;/value&gt;
            &lt;value&gt;joe&lt;/value&gt;
            &lt;value&gt;2010-04-24 <span class="m">17</span>:15:23&lt;/value&gt;
        &lt;/row&gt;
        &lt;row&gt;
            &lt;value&gt;2&lt;/value&gt;
            &lt;value&gt;I like it!&lt;/value&gt;
            &lt;null /&gt;
            &lt;value&gt;2010-04-26 <span class="m">12</span>:14:20&lt;/value&gt;
        &lt;/row&gt;
    &lt;/table&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>所定义的每个 <code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code> 都有一个名称，并且必须有对所有列及其名称的定义。其下可以包含零个或任意正整数个 <code class="docutils literal notranslate"><span class="pre">&lt;row&gt;</span></code> 元素。没有定义 <code class="docutils literal notranslate"><span class="pre">&lt;row&gt;</span></code> 意味着这是个空表。<code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;null</span> <span class="pre">/&gt;</span></code> 标签必须按照之前给定 <code class="docutils literal notranslate"><span class="pre">&lt;column&gt;</span></code> 元素的顺序来指定。<code class="docutils literal notranslate"><span class="pre">&lt;null</span> <span class="pre">/&gt;</span></code> 标签显然意味着这个值为 NULL。</p>
<p>可以在数据库 TestCase 中调用 <code class="docutils literal notranslate"><span class="pre">createXmlDataSet($filename)</span></code> 方法来创建 XML DataSet 实例：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTestCase</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createXMLDataSet</span><span class="p">(</span><span class="s1">&#39;myXmlFixture.xml&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="mysql-xml-dataset-mysql-xml">
<span id="database-mysql-xml-dataset"></span><h5>MySQL XML DataSet （MySQL XML 数据集）</h5>
<p>这种新的 XML 格式是 <cite>MySQL 数据库服务器 &lt;http://www.mysql.com&gt;`_专用的。PHPUnit 3.5 加入了对这种格式的支持。可以用 ```mysqldump`</cite> &lt;<a class="reference external" href="http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html">http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html</a>&gt;`_ 工具来生成这种格式的文件。与同样为 <code class="docutils literal notranslate"><span class="pre">mysqldump</span></code> 所支持的 CSV 数据集不同，这种 XML 格式可以在单个文件中包含多个表的数据。要生成这种格式的文件，可以这样调用 <code class="docutils literal notranslate"><span class="pre">mysqldump</span></code>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mysqldump --xml -t -u <span class="o">[</span>username<span class="o">]</span> --password<span class="o">=[</span>password<span class="o">]</span> <span class="o">[</span>database<span class="o">]</span> &gt; /path/to/file.xml
</pre></div>
</div>
<p>可以在数据库 TestCase 中调用 <code class="docutils literal notranslate"><span class="pre">createMySQLXMLDataSet($filename)</span></code> 方法来使用这个文件：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTestCase</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMySQLXMLDataSet</span><span class="p">(</span><span class="s1">&#39;/path/to/file.xml&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="yaml-dataset-yaml">
<span id="database-yaml-dataset"></span><h5>YAML DataSet （YAML 数据集）</h5>
<p>也可以用 YAML DataSet 来写这个留言本的例子：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>guestbook:
  -
    id: <span class="m">1</span>
    content: <span class="s2">&quot;Hello buddy!&quot;</span>
    user: <span class="s2">&quot;joe&quot;</span>
    created: <span class="m">2010</span>-04-24 <span class="m">17</span>:15:23
  -
    id: <span class="m">2</span>
    content: <span class="s2">&quot;I like it!&quot;</span>
    user:
    created: <span class="m">2010</span>-04-26 <span class="m">12</span>:14:20
</pre></div>
</div>
<p>简单方便，同时还解决了和它类似的 FLat XML DataSet 所具有的 NULL 问题。在 YAML 中，只有列名而没有指定值就表示 NULL。空白字符串则这样指定：<code class="docutils literal notranslate"><span class="pre">column1:</span> <span class="pre">&quot;&quot;</span></code>。</p>
<p>目前，数据库 TestCase 中没有 YAML DataSet 的工厂方法，因此需要手工进行实例化：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\DataSet\YamlDataSet</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">YamlGuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">YamlDataSet</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;/_files/guestbook.yml&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="csv-dataset-csv">
<span id="database-csv-dataset"></span><h5>CSV DataSet （CSV 数据集）</h5>
<p>另外一种基于文件的 DataSet 是基于 CSV 文件的。数据集中的每个表用一个单独的 CSV 文件表示。对于留言本的例子，可以这样定义 guestbook-table.csv 文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>id,content,user,created
<span class="m">1</span>,<span class="s2">&quot;Hello buddy!&quot;</span>,<span class="s2">&quot;joe&quot;</span>,<span class="s2">&quot;2010-04-24 17:15:23&quot;</span>
<span class="m">2</span>,<span class="s2">&quot;I like it!&quot;</span>,<span class="s2">&quot;nancy&quot;</span>,<span class="s2">&quot;2010-04-26 12:14:20&quot;</span>
</pre></div>
</div>
<p>用 Excel 或者 OpenOffice 来对这种格式进行编辑是非常方便的，但是在 CSV DataSet 中无法指定 NULL 值。给出一个空白列的结果是往这个列中插入数据库的默认空值。</p>
<p>可以这样创建 CSV DataSet：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\DataSet\CsvDataSet</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CsvGuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CsvDataSet</span><span class="p">();</span>
        <span class="nv">$dataSet</span><span class="o">-&gt;</span><span class="na">addTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;/_files/guestbook.csv&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$dataSet</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="array-datase">
<span id="database-array-dataset"></span><h5>Array DataSe （数组数据集）</h5>
<p>在 PHPUnit 的数据库扩展中，（尚）没有基于数组的 DataSet，不过很容易自行实现之。留言本的例子大致是这样：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArrayGuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">MyApp_DbUnit_ArrayDataSet</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;guestbook&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="p">[</span>
                        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hello buddy!&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;joe&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2010-04-24 17:15:23&#39;</span>
                    <span class="p">],</span>
                    <span class="p">[</span>
                        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;I like it!&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
                        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2010-04-26 12:14:20&#39;</span>
                    <span class="p">],</span>
                <span class="p">],</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP 版本的 DataSet 相比于所有其他基于文件的 DataSet 相比有很明显的优点：</p>
<ul class="simple">
<li>PHP 数组显然可以处理 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值。</li>
<li>不需要为断言提供任何额外文件，可以直接在 TestCase 中指定。</li>
</ul>
<p>对于这种 DataSet 而言，和平直 XML、CSV、YAML DataSet 一样，表的列名信息由第一个指定的行的键名定义。在上面这个例子里，就是 “id“、“content“、“user“ 和 “created“。</p>
<p>这个数组 DataSet 类的实现是非常简单直接的：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">class</span> <span class="nc">MyApp_DbUnit_ArrayDataSet</span> <span class="k">extends</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_AbstractDataSet</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$tables</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**</span>
<span class="sd">     * @param array $data</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">AS</span> <span class="nv">$tableName</span> <span class="o">=&gt;</span> <span class="nv">$rows</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$columns</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$columns</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="nv">$metaData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_DefaultTableMetaData</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">,</span> <span class="nv">$columns</span><span class="p">);</span>
            <span class="nv">$table</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_DefaultTable</span><span class="p">(</span><span class="nv">$metaData</span><span class="p">);</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$rows</span> <span class="k">AS</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">addRow</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tables</span><span class="p">[</span><span class="nv">$tableName</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$table</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">createIterator</span><span class="p">(</span><span class="nv">$reverse</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_DefaultTableIterator</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tables</span><span class="p">,</span> <span class="nv">$reverse</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTable</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tables</span><span class="p">[</span><span class="nv">$tableName</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$tableName</span><span class="s2"> is not a table in the current database.&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">tables</span><span class="p">[</span><span class="nv">$tableName</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="query-sql-dataset-sql">
<span id="database-query-sql-dataset"></span><h5>Query (SQL) DataSet （查询(SQL)数据集）</h5>
<p>对于数据库断言，不仅需要有基于文件的 DataSet，同时也需要有一种内含数据库实际内容的基于查询/SQL 的 DataSet。Query DataSet 在此闪亮登场：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$ds</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_QueryDataSet</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">());</span>
<span class="nv">$ds</span><span class="o">-&gt;</span><span class="na">addTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>单纯以名称来添加表是一种隐式地用以下查询来定义 DataTable 的方法：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$ds</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_QueryDataSet</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">());</span>
<span class="nv">$ds</span><span class="o">-&gt;</span><span class="na">addTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT * FROM guestbook&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>可以在这种用法中为你的表任意指定查询，例如限定行、列，或者加上 <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> 子句：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$ds</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_QueryDataSet</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">());</span>
<span class="nv">$ds</span><span class="o">-&gt;</span><span class="na">addTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT id, content FROM guestbook ORDER BY created DESC&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>在关于数据库断言的那一节中有更多关于如何使用 Query DataSet 的细节。</p>
</div>
<div class="section" id="database-db-dataset">
<span id="database-database-db-dataset"></span><h5>Database (DB) Dataset （数据库数据集）</h5>
<p>通过访问测试所使用的数据库连接，可以自动创建包含数据库所有表以及其内容的 DataSet。所使用的数据库由数据库连接工厂方法的第二个参数指定。</p>
<p>可以像 <code class="docutils literal notranslate"><span class="pre">testGuestbook()</span></code> 中那样创建整个数据库所对应的 DataSet，或者像 <code class="docutils literal notranslate"><span class="pre">testFilteredGuestbook()</span></code> 方法中那样用一个白名单来将 DataSet 限制在若干表名的集合上。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MySqlGuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getConnection</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$database</span> <span class="o">=</span> <span class="s1">&#39;my_database&#39;</span><span class="p">;</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="s1">&#39;my_user&#39;</span><span class="p">;</span>
        <span class="nv">$password</span> <span class="o">=</span> <span class="s1">&#39;my_password&#39;</span><span class="p">;</span>
        <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:...&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createDefaultDBConnection</span><span class="p">(</span><span class="nv">$pdo</span><span class="p">,</span> <span class="nv">$database</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGuestbook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">();</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFilteredGuestbook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$tableNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;guestbook&#39;</span><span class="p">];</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">(</span><span class="nv">$tableNames</span><span class="p">);</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="replacement-dataset">
<span id="database-replacement-dataset"></span><h5>Replacement DataSet （替换数据集）</h5>
<p>前面谈到了 Flat XML 和 CSV DataSet 所存在的 NULL 问题，不过有一种稍微有点复杂的解决方法可以让这两种数据集都能正常处理 NULL。</p>
<p>Replacement DataSet 是已有数据集的修饰器(decorator)，能够将数据集中任意列的值替换为其他替代值。为了让留言本的例子能够处理 NULL 值，首先指定类似这样的文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello buddy!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;joe&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-24 17:15:23&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;I like it!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;##NULL##&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-26 12:14:20&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>然后将 Flat XML DataSet 包装在 Replacement DataSet 中：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ReplacementTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$ds</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s1">&#39;myFlatXmlFixture.xml&#39;</span><span class="p">);</span>
        <span class="nv">$rds</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_ReplacementDataSet</span><span class="p">(</span><span class="nv">$ds</span><span class="p">);</span>
        <span class="nv">$rds</span><span class="o">-&gt;</span><span class="na">addFullReplacement</span><span class="p">(</span><span class="s1">&#39;##NULL##&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$rds</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="dataset-filter">
<span id="database-dataset-filter"></span><h5>DataSet Filter （数据集筛选器）</h5>
<p>如果有一个非常大的基境文件，可以用数据集筛选器来为需要包含在子数据集中的表和列指定白/黑名单。与 DB DataSet 联用来对数据集中的列进行筛选尤其方便。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataSetFilterTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIncludeFilteredGuestbook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$tableNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;guestbook&#39;</span><span class="p">];</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">();</span>

        <span class="nv">$filterDataSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_DataSetFilter</span><span class="p">(</span><span class="nv">$dataSet</span><span class="p">);</span>
        <span class="nv">$filterDataSet</span><span class="o">-&gt;</span><span class="na">addIncludeTables</span><span class="p">([</span><span class="s1">&#39;guestbook&#39;</span><span class="p">]);</span>
        <span class="nv">$filterDataSet</span><span class="o">-&gt;</span><span class="na">setIncludeColumnsForTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">]);</span>
        <span class="c1">// ..</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExcludeFilteredGuestbook</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$tableNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;guestbook&#39;</span><span class="p">];</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">();</span>

        <span class="nv">$filterDataSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_DataSetFilter</span><span class="p">(</span><span class="nv">$dataSet</span><span class="p">);</span>
        <span class="nv">$filterDataSet</span><span class="o">-&gt;</span><span class="na">addExcludeTables</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">]);</span> <span class="c1">// 只保留 guestbook 表！</span>
        <span class="nv">$filterDataSet</span><span class="o">-&gt;</span><span class="na">setExcludeColumnsForTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">]);</span>
        <span class="c1">// ..</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">*注意：*不能对同一个表同时应用排除与包含两种列筛选器，只能分别应用于不同的表。另外，表的白名单和黑名单也只能选择其一，不能二者同时使用。</span>
</pre></div>
</div>
</div>
<div class="section" id="composite-dataset">
<span id="database-composite-dataset"></span><h5>Composite DataSet （组合数据集）</h5>
<p>Composite DataSet 能将多个已存在的数据集聚合成单个数据集，因此非常有用。如果多个数据集中存在同样的表，其中的数据行将按照指定的顺序进行追加。例如，假设有两个数据集， <em>fixture1.xml</em>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello buddy!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;joe&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-24 17:15:23&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>和 <em>fixture2.xml</em>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;I like it!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;##NULL##&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-26 12:14:20&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>通过 Composite DataSet 可以把这两个基境文件聚合在一起：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CompositeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$ds1</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s1">&#39;fixture1.xml&#39;</span><span class="p">);</span>
        <span class="nv">$ds2</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s1">&#39;fixture2.xml&#39;</span><span class="p">);</span>

        <span class="nv">$compositeDs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_CompositeDataSet</span><span class="p">();</span>
        <span class="nv">$compositeDs</span><span class="o">-&gt;</span><span class="na">addDataSet</span><span class="p">(</span><span class="nv">$ds1</span><span class="p">);</span>
        <span class="nv">$compositeDs</span><span class="o">-&gt;</span><span class="na">addDataSet</span><span class="p">(</span><span class="nv">$ds2</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$compositeDs</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="database-beware-of-foreign-keys">
<span id="id14"></span><h4>当心外键</h4>
<p>在建立基境的过程中， PHPUnit 的数据库扩展模块按照基境中所指定的顺序将数据行插入到数据库内。假如数据库中使用了外键，这就意味着必须指定好表的顺序，以避免外键约束失败。</p>
</div>
<div class="section" id="database-implementing-your-own-datasetsdatatables">
<span id="id15"></span><h4>实现自有的 DataSet/DataTable</h4>
<p>为了理解 DataSet 和 DataTable 的内部实现，让我们来看看 DataSet 的接口。如果没打算自行实现 DataSet 或者 DataTable，可以直接跳过这一部分。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">interface</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_IDataSet</span> <span class="k">extends</span> <span class="nx">IteratorAggregate</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTableNames</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTableMetaData</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTable</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">assertEquals</span><span class="p">(</span><span class="nx">PHPUnit_Extensions_Database_DataSet_IDataSet</span> <span class="nv">$other</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getReverseIterator</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>这些 public 接口在数据库 TestCase 中 <code class="docutils literal notranslate"><span class="pre">assertDataSetsEqual()</span></code> 断言内使用，用以检测数据集是否相等。IDataSet 中继承自 <code class="docutils literal notranslate"><span class="pre">IteratorAggregate</span></code> 接口的 <code class="docutils literal notranslate"><span class="pre">getIterator()</span></code> 方法用于对数据集中的所有表进行迭代。逆序迭代器让 PHPUnit 能够按照与创建时相反的顺序对所有表执行 TRUNCATE 操作，以此来保证满足外键约束。</p>
<p>根据具体实现的不同，要采取不同的方法来将表实例添加到数据集中。例如，在所有基于文件的数据集中，表都是在构造过程中直接从源文件生成并加入数据集中，比如 <code class="docutils literal notranslate"><span class="pre">YamlDataSet</span></code>、<code class="docutils literal notranslate"><span class="pre">XmlDataSet</span></code> 和 <a href="#id16"><span class="problematic" id="id17">``</span></a>FlatXmlDataSet``均是如此。</p>
<p>数据表则由以下接口表示：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">interface</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_ITable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTableMetaData</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRowCount</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getValue</span><span class="p">(</span><span class="nv">$row</span><span class="p">,</span> <span class="nv">$column</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRow</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">assertEquals</span><span class="p">(</span><span class="nx">PHPUnit_Extensions_Database_DataSet_ITable</span> <span class="nv">$other</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>除了 <code class="docutils literal notranslate"><span class="pre">getTableMetaData()</span></code> 方法之外，这个接口是一目了然的。数据库扩展模块中的各种断言（将于下一章中介绍）用到了所有这些方法，因此它们全部都是必需的。<code class="docutils literal notranslate"><span class="pre">getTableMetaData()</span></code> 方法需要返回一个实现了 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Extensions_Database_DataSet_ITableMetaData</span></code> 接口的描述表结构的对象。这个对象包含如下信息：</p>
<ul class="simple">
<li>表的名称</li>
<li>表的列名数组，按照列在结果集中出现的顺序排列。</li>
<li>构成主键的列的数组。</li>
</ul>
<p>这个接口还包含有检验两个表的元数据实例是否彼此相等的断言，供数据集相等断言使用。</p>
</div>
</div>
<div class="section" id="api">
<span id="database-the-connection-api"></span><h3>数据库连接 API</h3>
<p>由数据库 TestCase 中的 <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> 方法所返回的连接接口有三个很有意思的方法：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">interface</span> <span class="nx">PHPUnit_Extensions_Database_DB_IDatabaseConnection</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createDataSet</span><span class="p">(</span><span class="k">Array</span> <span class="nv">$tableNames</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createQueryTable</span><span class="p">(</span><span class="nv">$resultName</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRowCount</span><span class="p">(</span><span class="nv">$tableName</span><span class="p">,</span> <span class="nv">$whereClause</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<ol class="arabic">
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">createDataSet()</span></code> 方法创建一个在数据集实现一节描述过的 Database (DB) DataSet（数据库数据集）。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ConnectionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateDataSet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$tableNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;guestbook&#39;</span><span class="p">];</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">createQueryTable()</span></code> 方法用于创建 QueryTable 的实例，需要为其指定结果名称和所使用的 SQL 查询。当涉及到结果/表的断言（如后面关于数据库断言 API 那一节所示）时，这个方法会很方便。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ConnectionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateQueryTable</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$tableNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;guestbook&#39;</span><span class="p">];</span>
        <span class="nv">$queryTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT * FROM guestbook&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">getRowCount()</span></code> 方法提供了一种方便的方式来取得表中的行数，并且还可以选择附加一个 WHERE 子句来在计数前对数据行进行过滤。它可以和一个简单的相等断言合用：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ConnectionTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetRowCount</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRowCount</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="database-database-assertions-api">
<span id="id18"></span><h3>数据库断言 API</h3>
<p>作为测试工具，数据库扩展模块理所当然会提供一些断言，可以用来验证数据库的当前状态、表的当前状态、表中数据行的数量。本节将详细描述这部分功能：</p>
<div class="section" id="database-asserting-the-row-count-of-a-table">
<span id="id19"></span><h4>对表中数据行的数量作出断言</h4>
<p>很多时候，确认表中是否包含特定数量的数据行是非常有帮助的。可以轻松做到这一点，不需要任何额外的使用连接 API 的粘合剂代码。比如说，在往留言本中插入一个新行之后，想要确认在表中除了之前的例子中一直都有的两行之外还有第三行：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAddEntry</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRowCount</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">),</span> <span class="s2">&quot;Pre-Condition&quot;</span><span class="p">);</span>

        <span class="nv">$guestbook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Guestbook</span><span class="p">();</span>
        <span class="nv">$guestbook</span><span class="o">-&gt;</span><span class="na">addEntry</span><span class="p">(</span><span class="s2">&quot;suzy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello world!&quot;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRowCount</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">),</span> <span class="s2">&quot;Inserting failed&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="database-asserting-the-state-of-a-table">
<span id="id20"></span><h4>对表的状态作出断言</h4>
<p>前面的这个断言很有帮助，但是肯定还想要检验表的实际内容，好核实是否所有值都写到了正确的列中。可以通过表断言来做到这一点。</p>
<p>为此，先定义一个 QueryTable 实例，从表名称和 SQL 查询派生出其内容，随后将其与一个基于文件/数组的数据集进行比较：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GuestbookTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAddEntry</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$guestbook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Guestbook</span><span class="p">();</span>
        <span class="nv">$guestbook</span><span class="o">-&gt;</span><span class="na">addEntry</span><span class="p">(</span><span class="s2">&quot;suzy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello world!&quot;</span><span class="p">);</span>

        <span class="nv">$queryTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryTable</span><span class="p">(</span>
            <span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT * FROM guestbook&#39;</span>
        <span class="p">);</span>
        <span class="nv">$expectedTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s2">&quot;expectedBook.xml&quot;</span><span class="p">)</span>
                              <span class="o">-&gt;</span><span class="na">getTable</span><span class="p">(</span><span class="s2">&quot;guestbook&quot;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTablesEqual</span><span class="p">(</span><span class="nv">$expectedTable</span><span class="p">,</span> <span class="nv">$queryTable</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>现在需要为这个断言编写Flat XML 文件 <em>expectedBook.xml</em>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello buddy!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;joe&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-24 17:15:23&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;I like it!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;nancy&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-04-26 12:14:20&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello world!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;suzy&quot;</span> <span class="nv">created</span><span class="o">=</span><span class="s2">&quot;2010-05-01 21:47:08&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>在整个时间长河中，只有特定的一秒钟内这个断言可以通过评定，在 <em>2010–05–01 21:47:08</em>。在数据库测试中，日期构成了一个特殊的问题。可以从这个断言中省略 “created“ 列来规避失败。</p>
<p>为了让断言能得以通过， Flat XML 文件 <em>expectedBook.xml</em> 需要调整成大致类似这样：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> ?&gt;
&lt;dataset&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello buddy!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;joe&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;I like it!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;nancy&quot;</span> /&gt;
    &lt;guestbook <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="nv">content</span><span class="o">=</span><span class="s2">&quot;Hello world!&quot;</span> <span class="nv">user</span><span class="o">=</span><span class="s2">&quot;suzy&quot;</span> /&gt;
&lt;/dataset&gt;
</pre></div>
</div>
<p>还得修正一下 QueryTable 的调用：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$queryTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryTable</span><span class="p">(</span>
    <span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT id, content, user FROM guestbook&#39;</span>
<span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="database-asserting-the-result-of-a-query">
<span id="id21"></span><h4>对查询的结果作出断言</h4>
<p>利用 QueryTable，也可以对复杂查询的结果作出断言，只需要指定查询以及结果名称，并随后将其与某个数据集进行比较：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ComplexQueryTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testComplexQuery</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$queryTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryTable</span><span class="p">(</span>
            <span class="s1">&#39;myComplexQuery&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT complexQuery...&#39;</span>
        <span class="p">);</span>
        <span class="nv">$expectedTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s2">&quot;complexQueryAssertion.xml&quot;</span><span class="p">)</span>
                              <span class="o">-&gt;</span><span class="na">getTable</span><span class="p">(</span><span class="s2">&quot;myComplexQuery&quot;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTablesEqual</span><span class="p">(</span><span class="nv">$expectedTable</span><span class="p">,</span> <span class="nv">$queryTable</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="database-asserting-the-state-of-multiple-tables">
<span id="id22"></span><h4>对多个表的状态作出断言</h4>
<p>当然可以一次性对多个表的状态作出断言，并将查询数据集与基于文件的数据集进行比较。有两种不同的方式来进行数据集断言。</p>
<ol class="arabic">
<li><p class="first">可以从自数据库连接建立数据库数据集，并将其与基于文件的数据集进行比较。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataSetAssertionsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreateDataSetAssertion</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">([</span><span class="s1">&#39;guestbook&#39;</span><span class="p">]);</span>
        <span class="nv">$expectedDataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s1">&#39;guestbook.xml&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDataSetsEqual</span><span class="p">(</span><span class="nv">$expectedDataSet</span><span class="p">,</span> <span class="nv">$dataSet</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</li>
<li><p class="first">也可以自行构造数据集：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\DbUnit\TestCaseTrait</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataSetAssertionsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">TestCaseTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testManualDataSetAssertion</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$dataSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Extensions_Database_DataSet_QueryDataSet</span><span class="p">();</span>
        <span class="nv">$dataSet</span><span class="o">-&gt;</span><span class="na">addTable</span><span class="p">(</span><span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT id, content, user FROM guestbook&#39;</span><span class="p">);</span> <span class="c1">// 额外的表</span>
        <span class="nv">$expectedDataSet</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s1">&#39;guestbook.xml&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDataSetsEqual</span><span class="p">(</span><span class="nv">$expectedDataSet</span><span class="p">,</span> <span class="nv">$dataSet</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="faq">
<span id="database-frequently-asked-questions"></span><h3>常见问题（FAQ）</h3>
<div class="section" id="database-will-phpunit-re-create-the-database-schema-for-each-test">
<span id="id23"></span><h4>PHPUnit 会为每个测试（重新）创建数据库吗？</h4>
<p>不，PHPUnit 要求在测试套件开始时所有数据库对象必须全部可用。数据库、表、序列、触发器还有视图，必须全部在运行测试套件之前创建好。</p>
<p><a class="reference external" href="http://www.doctrine-project.org">Doctrine 2</a> 或 <a class="reference external" href="http://www.ezcomponents.org">eZ Components</a> 拥有强力的工具，可以按预定义的数据结构创建数据库，但是这些都必须和 PHPUnit 扩展模块对接之后才能自动在整个测试套件运行之前重新创建数据库。</p>
<p>由于每个测试都会彻底清空数据库，因此无须为每个测试重新创建数据库。持久可用的数据库同样能够完美工作。</p>
</div>
<div class="section" id="pdo">
<span id="database-am-i-required-to-use-pdo-in-my-application-for-the-database-extension-to-work"></span><h4>为了让数据库扩展模块正常工作，需要在应用程序中使用 PDO 吗？</h4>
<p>不，只在基境的清理与建立阶段还有断言检定时用到PDO。在你的自有代码中，可以使用任意数据库抽象。</p>
</div>
<div class="section" id="too-much-connections">
<span id="database-what-can-i-do-when-i-get-a-too-much-connections-error"></span><h4>如果看到 “Too much Connections“ 错误该怎么办？</h4>
<p>如果没有对 TestCase 中 <code class="docutils literal notranslate"><span class="pre">getConnection()</span></code> 方法所创建 PDO 实例进行缓存，那么每个数据库测试都会增加一个或多个数据库连接。MySQL的默认配置只允许100个并发连接，其他供应商的数据库也都有各自的最大连接限制。</p>
<p>子章节 “使用你自己的抽象数据库 TestCase 类“展示了如何通过在所有测试中使用单个PDO实例缓存来防止发生此错误。</p>
</div>
<div class="section" id="flat-xml-csv-null">
<span id="database-how-to-handle-null-with-flat-xml-csv-datasets"></span><h4>Flat XML / CSV 数据集中如何处理 NULL？</h4>
<p>别这么干。应当改用 XML 或者 YAML 数据集。</p>
</div>
</div>
</div>
<span id="document-test-doubles"></span><div class="section" id="test-doubles">
<span id="id1"></span><h2>测试替身</h2>
<p>Gerard Meszaros 在 <span class="xref std std-ref">Meszaros2007</span> 中介绍了测试替身的概念：</p>
<blockquote>
<div><p><em>Gerard Meszaros</em>:</p>
<p>有时候对被测系统(SUT)进行测试是很困难的，因为它依赖于其他无法在测试环境中使用的组件。这有可能是因为这些组件不可用，它们不会返回测试所需要的结果，或者执行它们会有不良副作用。在其他情况下，我们的测试策略要求对被测系统的内部行为有更多控制或更多可见性。</p>
<p>如果在编写测试时无法使用（或选择不使用）实际的依赖组件(DOC)，可以用测试替身来代替。测试替身不需要和真正的依赖组件有完全一样的的行为方式；他只需要提供和真正的组件同样的 API 即可，这样被测系统就会以为它是真正的组件！</p>
</div></blockquote>
<p>PHPUnit 提供的 <code class="docutils literal notranslate"><span class="pre">createMock($type)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">getMockBuilder($type)</span></code> 方法可以在测试中用来自动生成对象，此对象可以充当任意指定原版类型（接口或类名）的测试替身。在任何预期或要求使用原版类的实例对象的上下文中都可以使用这个测试替身对象来代替。</p>
<p><code class="docutils literal notranslate"><span class="pre">createMock($type)</span></code> 方法直接返回指定类型（接口或类）的测试替身对象实例。此测试替身的创建使用了最佳实践的默认值（不执行原始类的 <code class="docutils literal notranslate"><span class="pre">__construct()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__clone()</span></code> 方法，且不对传递给测试替身的方法的参数进行克隆）。如果这些默认值非你所需，可以用 <code class="docutils literal notranslate"><span class="pre">getMockBuilder($type)</span></code> 方法并使用流畅式接口来定制测试替身的生成过程。</p>
<p>在默认情况下，原版类的所有方法都会被替换为只会返回 <code class="docutils literal notranslate"><span class="pre">null</span></code> 的伪实现（其中不会调用原版方法）。使用诸如 <code class="docutils literal notranslate"><span class="pre">will($this-&gt;returnValue())</span></code> 之类的方法可以对这些伪实现在被调用时应当返回什么值做出配置。</p>
<div class="admonition-finalprivate-static admonition">
<p class="first admonition-title">局限性：final、private、与 static 方法</p>
<p class="last">请注意，<code class="docutils literal notranslate"><span class="pre">final</span></code>、<code class="docutils literal notranslate"><span class="pre">private</span></code> 和 <code class="docutils literal notranslate"><span class="pre">static</span></code> 方法无法对其进行上桩(stub)或模仿(mock)。PHPUnit 的测试替身功能将会忽略它们，并维持它们的原始行为。</p>
</div>
<div class="section" id="stubs">
<span id="test-doubles-stubs"></span><h3>Stubs （桩件）</h3>
<p>将对象替换为（可选地）返回配置好的返回值的测试替身的实践方法称为*上桩(stubbing)*。可以用*桩件(stub)*来“替换掉被测系统所依赖的实际组件，这样测试就有了对被测系统的间接输入的控制点。这使得测试能强制安排被测系统的执行路径，否则被测系统可能无法执行”。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.stubs.examples.StubTest.php`展示了如何对方法的调用上桩以及如何设定返回值。首先用</span> <span class="pre">``PHPUnitFrameworkTestCase`</span></code> 类提供的 <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> 方法来建立一个桩件对象，它表面看起来像是 <a href="#id2"><span class="problematic" id="id3">``</span></a>SomeClass``类（<a class="reference internal" href="#test-doubles-stubs-examples-someclass-php"><span class="std std-numref">Example 9.1</span></a>）的实例。随后用 PHPUnit 提供的 <a href="#id4"><span class="problematic" id="id5">`</span></a>流畅式接口 &lt;<a class="reference external" href="http://martinfowler.com/bliki/FluentInterface.html">http://martinfowler.com/bliki/FluentInterface.html</a>&gt;`_来指定桩件的行为。本质上，这意味着不需要建立多个临时对象然后再把它们捆到一起。取而代之的是范例中所示的链式方法调用。这使得代码更加易读并更加“流畅”。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-someclass-php">
<div class="code-block-caption"><span class="caption-text">需要对其上桩的类</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 随便做点什么。</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest-php">
<div class="code-block-caption"><span class="caption-text">对某个方法的调用上桩，返回固定值</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

        <span class="c1">// 现在调用 $stub-&gt;doSomething() 将返回 &#39;foo&#39;。</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="admonition-method admonition">
<p class="first admonition-title">局限性：名字为“method”的方法</p>
<p>仅当原始类中不包含名字为“method”的方法时，以上范例才能正常运行。</p>
<p class="last">如果原始类包含名为“method”的方法，就必须用 <code class="docutils literal notranslate"><span class="pre">$stub-&gt;expects($this-&gt;any())-&gt;method('doSomething')-&gt;willReturn('foo');</span></code>。</p>
</div>
<p>“在幕后”，当使用了 <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> 方法时， PHPUnit 自动生成了一个新的 PHP 类来实现想要的行为。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.stubs.examples.StubTest2.php`这个例子展示了如何用仿件生成器的流畅式接口来配置测试替身的生成。这个测试替身的默认配置用的是和</span> <span class="pre">``createMock()`</span></code> 相同的最佳实践。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest2-php">
<div class="code-block-caption"><span class="caption-text">使用可用于配置生成的测试替身类的仿件生成器 API</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类建立桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="nv">$originalClassName</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="na">disableOriginalConstructor</span><span class="p">()</span>
                     <span class="o">-&gt;</span><span class="na">disableOriginalClone</span><span class="p">()</span>
                     <span class="o">-&gt;</span><span class="na">disableArgumentCloning</span><span class="p">()</span>
                     <span class="o">-&gt;</span><span class="na">disallowMockingUnknownTypes</span><span class="p">()</span>
                     <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">willReturn</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

        <span class="c1">// 现在调用 $stub-&gt;doSomething() 将返回 &#39;foo&#39;。</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在之前的例子中，用 <code class="docutils literal notranslate"><span class="pre">willReturn($value)</span></code> 返回简单值。这个简短的语法相当于 <code class="docutils literal notranslate"><span class="pre">will($this-&gt;returnValue($value))</span></code>。而在这个长点的语法中，可以使用变量，从而实现更复杂的上桩行为。</p>
<p>有时想要将（未改变的）方法调用时所使用的参数之一作为桩件的方法的调用结果来返回。 <code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.stubs.examples.StubTest3.php`展示了如何用</span> <span class="pre">``returnArgument()`</span></code> 代替 <code class="docutils literal notranslate"><span class="pre">returnValue()</span></code> 来做到这点。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest3-php">
<div class="code-block-caption"><span class="caption-text">对某个方法的调用上桩，返回参数之一</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnArgumentStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnArgument</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething(&#39;foo&#39;) 返回 &#39;foo&#39;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething(&#39;bar&#39;) 返回 &#39;bar&#39;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在用流畅式接口进行测试时，让某个已上桩的方法返回对桩件对象的引用有时会很有用。<code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.stubs.examples.StubTest4.php`展示了如何用</span> <span class="pre">``returnSelf()`</span></code> 来做到这点。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest4-php">
<div class="code-block-caption"><span class="caption-text">对方法的调用上桩，返回对桩件对象的引用</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnSelf</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnSelf</span><span class="p">());</span>

        <span class="c1">// $stub-&gt;doSomething() 返回 $stub</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$stub</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>有时候，上桩的方法需要根据预定义的参数清单来返回不同的值。可以用 <code class="docutils literal notranslate"><span class="pre">returnValueMap()</span></code> 方法将参数和相应的返回值关联起来建立映射。范例参见:numref:<cite>test-doubles.stubs.examples.StubTest5.php</cite>。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest5-php">
<div class="code-block-caption"><span class="caption-text">对方法的调用上桩，按照映射确定返回值</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnValueMapStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 创建从参数到返回值的映射。</span>
        <span class="nv">$map</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
        <span class="p">];</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValueMap</span><span class="p">(</span><span class="nv">$map</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething() 根据提供的参数返回不同的值。</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>如果上桩的方法需要返回计算得到的值而不是固定值（参见 <code class="docutils literal notranslate"><span class="pre">returnValue()</span></code>）或某个（未改变的）参数（参见 <code class="docutils literal notranslate"><span class="pre">returnArgument()</span></code>），可以用 <code class="docutils literal notranslate"><span class="pre">returnCallback()</span></code> 来让上桩的方法返回回调函数或方法的结果。范例参见:numref:<cite>test-doubles.stubs.examples.StubTest6.php</cite>。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest6-php">
<div class="code-block-caption"><span class="caption-text">对方法的调用上桩，由回调生成返回值</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testReturnCallbackStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnCallback</span><span class="p">(</span><span class="s1">&#39;str_rot13&#39;</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething($argument) 返回 str_rot13($argument)</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;fbzrguvat&#39;</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>相比于建立回调方法，有一个更简单的选择是直接给出期望返回值的列表。可以用 <code class="docutils literal notranslate"><span class="pre">onConsecutiveCalls()</span></code> 方法来做到这个。范例参见 <a class="reference internal" href="#test-doubles-stubs-examples-stubtest7-php"><span class="std std-numref">Example 9.8</span></a>。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest7-php">
<div class="code-block-caption"><span class="caption-text">对方法的调用上桩，按照指定顺序返回列表中的值</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOnConsecutiveCallsStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件。</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">onConsecutiveCalls</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething() 每次返回值都不同</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>除了返回一个值之外，上桩的方法还能抛出一个异常。<code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.stubs.examples.StubTest8.php`展示了如何用</span> <span class="pre">``throwException()`</span></code> 做到这点。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubs-examples-stubtest8-php">
<div class="code-block-caption"><span class="caption-text">对方法的调用上桩，抛出异常</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StubTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThrowExceptionStub</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 SomeClass 类创建桩件</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">SomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 配置桩件。</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">throwException</span><span class="p">(</span><span class="k">new</span> <span class="nx">Exception</span><span class="p">));</span>

        <span class="c1">// $stub-&gt;doSomething() 抛出异常</span>
        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>另外，也可以自行编写桩件，并在此过程中改善设计。在系统中被广泛使用的资源是通过单个外观(facade)来访问的，因此很容易就能用桩件替换掉资源。例如，将散落在代码各处的对数据库的直接调用替换为单个 <code class="docutils literal notranslate"><span class="pre">Database</span></code> 对象，这个对象实现了 <code class="docutils literal notranslate"><span class="pre">IDatabase</span></code> 接口。接下来，就可以创建实现了 <code class="docutils literal notranslate"><span class="pre">IDatabase</span></code> 的桩件并在测试中使用之。甚至可以创建一个选项来控制是用桩件还是用真实数据库来运行测试，这样测试就既能在开发过程中用作本地测试，又能在实际数据库环境中进行集成测试。</p>
<p>需要上桩的功能往往集中在同一个对象中，这就改善了内聚度。将功能通过单一且一致的接口呈现出来，就降低了这部分与系统其他部分之间的耦合度。</p>
</div>
<div class="section" id="mock-object">
<span id="test-doubles-mock-objects"></span><h3>仿件对象(Mock Object)</h3>
<p>将对象替换为能验证预期行为（例如断言某个方法必会被调用）的测试替身的实践方法称为*模仿(mocking)*。</p>
<p>可以用 <em>仿件对象(mock object)</em>“作为观察点来核实被测试系统在测试中的间接输出。通常，仿件对象还需要包括桩件的功能，因为如果测试尚未失败则仿件对象需要向被测系统返回一些值，但是其重点还是在对间接输出的核实上。因此，仿件对象远不止是桩件加断言，它是以一种从根本上完全不同的方式来使用的”(Gerard Meszaros)。</p>
<div class="admonition- admonition">
<p class="first admonition-title">局限性：对预期的自动校验</p>
<p class="last">PHPUnit只会对在某个测试的作用域内生成的仿件对象进行自动校验。诸如在数据供给器内生成或用``&#64;depends`` 标注注入测试的仿件对象，PHPUnit并不会自动对其进行校验。</p>
</div>
<p>这有个例子：假设需要测试的当前方法，在例子中是 <code class="docutils literal notranslate"><span class="pre">update()</span></code>，确实在一个观察着另外一个对象的对象中上被调用了。<code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.mock-objects.examples.SUT.php`展示了被测系统(SUT)中</span> <span class="pre">``Subject`</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Observer</span></code> 两个类的代码。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-sut-php">
<div class="code-block-caption"><span class="caption-text">被测系统(SUT)中 Subject 与 Observer 类的代码</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Subject</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$observers</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">Observer</span> <span class="nv">$observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$observer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 做点什么</span>
        <span class="c1">// ...</span>

        <span class="c1">// 通知观察者发生了些什么</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomethingBad</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="k">as</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">reportError</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;Something bad happened&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nv">$argument</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="k">as</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$argument</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 其他方法。</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Observer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$argument</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 做点什么。</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">reportError</span><span class="p">(</span><span class="nv">$errorCode</span><span class="p">,</span> <span class="nv">$errorMessage</span><span class="p">,</span> <span class="nx">Subject</span> <span class="nv">$subject</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 做点什么。</span>
    <span class="p">}</span>

    <span class="c1">// 其他方法。</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.mock-objects.examples.SubjectTest.php`展示了如何用仿件对象来测试</span> <span class="pre">``Subject`</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Observer</span></code> 对象之间的互动。</p>
<p>首先用 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code> 类提供的 <code class="docutils literal notranslate"><span class="pre">getMockBuilder()</span></code> 方法建立 <code class="docutils literal notranslate"><span class="pre">Observer</span></code> 的仿件对象。由于给出了一个数组做为 <code class="docutils literal notranslate"><span class="pre">getMock()</span></code> 方法的第二（可选）参数，<code class="docutils literal notranslate"><span class="pre">Observer</span></code> 类只有 <code class="docutils literal notranslate"><span class="pre">update()</span></code> 方法会被替换为仿实现。</p>
<p>由于关注的是检验某个方法是否被调用，以及调用时具体所使用的参数，因此引入 <code class="docutils literal notranslate"><span class="pre">expects()</span></code> 与 <code class="docutils literal notranslate"><span class="pre">with()</span></code> 方法来指明此交互应该是什么样的。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-subjecttest-php">
<div class="code-block-caption"><span class="caption-text">测试某个方法会以特定参数被调用一次</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SubjectTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testObserversAreUpdated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 Observer 类建立仿件对象，只模仿 update() 方法。</span>
        <span class="nv">$observer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="nx">Observer</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">([</span><span class="s1">&#39;update&#39;</span><span class="p">])</span>
                         <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="c1">// 建立预期状况：update() 方法将会被调用一次，</span>
        <span class="c1">// 并且将以字符串 &#39;something&#39; 为参数。</span>
        <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
                 <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">equalTo</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">));</span>

        <span class="c1">// 创建 Subject 对象，并将模仿的 Observer 对象连接其上。</span>
        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">(</span><span class="s1">&#39;My subject&#39;</span><span class="p">);</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>

        <span class="c1">// 在 $subject 对象上调用 doSomething() 方法，</span>
        <span class="c1">// 预期将以字符串 &#39;something&#39; 为参数调用</span>
        <span class="c1">// Observer 仿件对象的 update() 方法。</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">with()</span></code> 方法可以携带任何数量的参数，对应于被模仿的方法的参数数量。可以对方法的参数指定更加高等的约束而不仅是简单的匹配。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-subjecttest2-php">
<div class="code-block-caption"><span class="caption-text">测试某个方法将会以特定数量的参数进行调用，并且对各个参数以多种方式进行约束</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SubjectTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testErrorReported</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 Observer 类建立仿件，对 reportError() 方法进行模仿</span>
        <span class="nv">$observer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="nx">Observer</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">([</span><span class="s1">&#39;reportError&#39;</span><span class="p">])</span>
                         <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
                 <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;reportError&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span>
                       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">greaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stringContains</span><span class="p">(</span><span class="s1">&#39;Something&#39;</span><span class="p">),</span>
                       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">anything</span><span class="p">()</span>
                   <span class="p">);</span>

        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">(</span><span class="s1">&#39;My subject&#39;</span><span class="p">);</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>

        <span class="c1">// doSomethingBad() 方法应当会通过（observer的）reportError()方法</span>
        <span class="c1">// 向 observer 报告错误。</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">doSomethingBad</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">withConsecutive()</span></code> 方法可以接受任意多个数组作为参数，具体数量取决于欲测试的调用。每个数组都都是对被仿方法的相应参数的一组约束，就像 <code class="docutils literal notranslate"><span class="pre">with()</span></code> 中那样。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-with-consecutive-php">
<div class="code-block-caption"><span class="caption-text">测试某个方法将会以特定参数被调用二次</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFunctionCalledTwoTimesWithSpecificArguments</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="k">stdClass</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">([</span><span class="s1">&#39;set&#39;</span><span class="p">])</span>
                     <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exactly</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
             <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">withConsecutive</span><span class="p">(</span>
                 <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">equalTo</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">greaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
                 <span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">equalTo</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">greaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
             <span class="p">);</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">callback()</span></code> 约束用来进行更加复杂的参数校验。此约束的唯一参数是一个 PHP 回调项(callback)。此 PHP 回调项接受需要校验的参数作为其唯一参数，并应当在参数通过校验时返回 <code class="docutils literal notranslate"><span class="pre">true</span></code>，否则返回 <code class="docutils literal notranslate"><span class="pre">false</span></code>。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-subjecttest3-php">
<div class="code-block-caption"><span class="caption-text">更加复杂的参数校验</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SubjectTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testErrorReported</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 为 Observer 类建立仿件，模仿 reportError() 方法</span>
        <span class="nv">$observer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="nx">Observer</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">([</span><span class="s1">&#39;reportError&#39;</span><span class="p">])</span>
                         <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
                 <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;reportError&#39;</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">greaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">stringContains</span><span class="p">(</span><span class="s1">&#39;Something&#39;</span><span class="p">),</span>
                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">callback</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$subject</span><span class="p">){</span>
                          <span class="k">return</span> <span class="nb">is_callable</span><span class="p">([</span><span class="nv">$subject</span><span class="p">,</span> <span class="s1">&#39;getName&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
                                 <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;My subject&#39;</span><span class="p">;</span>
                        <span class="p">}));</span>

        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">(</span><span class="s1">&#39;My subject&#39;</span><span class="p">);</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>

        <span class="c1">// doSomethingBad() 方法应当会通过（observer的）reportError()方法</span>
        <span class="c1">// 向 observer 报告错误。</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">doSomethingBad</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-clone-object-parameters-usecase-php">
<div class="code-block-caption"><span class="caption-text">测试某个方法将会被调用一次，并且以某个特定对象作为参数。</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIdenticalObjectPassed</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expectedObject</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>

        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="k">stdClass</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">])</span>
                     <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
             <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">identicalTo</span><span class="p">(</span><span class="nv">$expectedObject</span><span class="p">));</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">(</span><span class="nv">$expectedObject</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-enable-clone-object-parameters-php">
<div class="code-block-caption"><span class="caption-text">创建仿件对象时启用参数克隆</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIdenticalObjectPassed</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$cloneArguments</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="k">stdClass</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="na">enableArgumentCloning</span><span class="p">()</span>
                     <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>

        <span class="c1">// 现在仿件将对参数进行克隆，因此 identicalTo 约束将会失败。</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>:ref:<a href="#id6"><span class="problematic" id="id7">`</span></a>appendixes.assertions.assertThat.tables.constraints`列出了可以应用于方法参数的各种约束，:numref:<a href="#id8"><span class="problematic" id="id9">`</span></a>test-doubles.mock-objects.tables.matchers`列出了可以用于指定调用次数的各种匹配器。</p>
<table border="1" class="table docutils" id="test-doubles-mock-objects-tables-matchers">
<caption><span class="caption-text">匹配器</span></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">匹配器</th>
<th class="head">含义</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_MockObject_Matcher_AnyInvokedCount</span> <span class="pre">any()</span></code></td>
<td>返回一个匹配器，当被评定的方法执行0次或更多次（即任意次数）时匹配成功。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_MockObject_Matcher_InvokedCount</span> <span class="pre">never()</span></code></td>
<td>返回一个匹配器，当被评定的方法从未执行时匹配成功。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_MockObject_Matcher_InvokedAtLeastOnce</span> <span class="pre">atLeastOnce()</span></code></td>
<td>返回一个匹配器，当被评定的方法执行至少一次时匹配成功。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_MockObject_Matcher_InvokedCount</span> <span class="pre">once()</span></code></td>
<td>返回一个匹配器，当被评定的方法执行恰好一次时匹配成功。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_MockObject_Matcher_InvokedCount</span> <span class="pre">exactly(int</span> <span class="pre">$count)</span></code></td>
<td>返回一个匹配器，当被评定的方法执行恰好 <code class="docutils literal notranslate"><span class="pre">$count</span></code> 次时匹配成功。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_MockObject_Matcher_InvokedAtIndex</span> <span class="pre">at(int</span> <span class="pre">$index)</span></code></td>
<td>返回一个匹配器，当被评定的方法是第 <code class="docutils literal notranslate"><span class="pre">$index</span></code> 个执行的方法时匹配成功。</td>
</tr>
</tbody>
</table>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">at()</span></code> 匹配器的 <code class="docutils literal notranslate"><span class="pre">$index</span></code> 参数指的是对给定仿件对象的*所有方法的调用*的索引，从零开始。使用这个匹配器要谨慎，因为它可能导致测试由于与具体的实现细节过分紧密绑定而变得脆弱。</p>
</div>
<p>如一开始提到的，如果 <code class="docutils literal notranslate"><span class="pre">createMock()</span></code> 方法在生成测试替身时所使用的默认值不符合你的要求，则可以通过 <code class="docutils literal notranslate"><span class="pre">getMockBuilder($type)</span></code> 方法来用流畅式接口定制测试替身的生成过程。以下是仿件生成器所提供的方法列表：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">setMethods(array</span> <span class="pre">$methods)</span></code> 可以在仿件生成器对象上调用，来指定哪些方法将被替换为可配置的测试替身。其他方法的行为不会有所改变。如果调用 <code class="docutils literal notranslate"><span class="pre">setMethods(null)</span></code>，那么没有方法会被替换。</li>
<li><code class="docutils literal notranslate"><span class="pre">setConstructorArgs(array</span> <span class="pre">$args)</span></code> 可用于向原版类的构造函数（默认情况下不会被替换为伪实现）提供参数数组。</li>
<li><code class="docutils literal notranslate"><span class="pre">setMockClassName($name)</span></code> 可用于指定生成的测试替身类的类名。</li>
<li><code class="docutils literal notranslate"><span class="pre">disableOriginalConstructor()</span></code> 参数可用于禁用对原版类的构造方法的调用。</li>
<li><code class="docutils literal notranslate"><span class="pre">disableOriginalClone()</span></code> 可用于禁用对原版类的克隆方法的调用。</li>
<li><code class="docutils literal notranslate"><span class="pre">disableAutoload()``可用于在测试替身类的生成期间禁用</span> <span class="pre">``__autoload()</span></code>。</li>
</ul>
</div>
<div class="section" id="prophecy">
<span id="test-doubles-prophecy"></span><h3>Prophecy</h3>
<p><a class="reference external" href="https://github.com/phpspec/prophecy">Prophecy</a> 是个“极为自我却又非常强大且灵活的 PHP 对象模仿框架。虽然一开始是为了满足 phpspec2 的需要而建立的，但它足够灵活，可以用最小代价用于任何测试框架内。”</p>
<p>PHPUnit 对用 Prophecy 建立测试替身提供了内建支持。:numref:<a href="#id11"><span class="problematic" id="id12">`</span></a>test-doubles.prophecy.examples.SubjectTest.php`展示了:numref:<a href="#id13"><span class="problematic" id="id14">`</span></a>test-doubles.mock-objects.examples.SubjectTest.php`中展示的测试应该如何用 Prophecy 的的预言式理念方式来达到同样的效果：</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-prophecy-examples-subjecttest-php">
<div class="code-block-caption"><span class="caption-text">测试某个方法会以特定参数被调用一次</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SubjectTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testObserversAreUpdated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">(</span><span class="s1">&#39;My subject&#39;</span><span class="p">);</span>

        <span class="c1">// 为 Observer 类建立预言(prophecy)。</span>
        <span class="nv">$observer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">prophesize</span><span class="p">(</span><span class="nx">Observer</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// 建立预期状况：update() 方法将会被调用一次，</span>
        <span class="c1">// 并且将以字符串 &#39;something&#39; 为参数。</span>
        <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">shouldBeCalled</span><span class="p">();</span>

        <span class="c1">// 揭示预言，并将仿件对象链接到主体上。</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">reveal</span><span class="p">());</span>

        <span class="c1">// 在 $subject 对象上调用 doSomething() 方法，</span>
        <span class="c1">// 预期将以字符串 &#39;something&#39; 为参数调用</span>
        <span class="c1">// Observer 仿件对象的 update() 方法。</span>
        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>更多关于如何用这个测试替身框架来创建、配置及使用桩件、谍件、仿件的细节，请参考 Prophecy 的 <a class="reference external" href="https://github.com/phpspec/prophecy#how-to-use-it">文档</a>。</p>
</div>
<div class="section" id="trait">
<span id="test-doubles-mocking-traits-and-abstract-classes"></span><h3>对特质(Trait)与抽象类进行模仿</h3>
<p><code class="docutils literal notranslate"><span class="pre">getMockForTrait()</span></code> 方法返回一个使用了特定特质(trait)的仿件对象。给定特质的所有抽象方法将都被模仿。这样就能对特质的具体方法进行测试。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-traitclasstest-php">
<div class="code-block-caption"><span class="caption-text">对特质的具体方法进行测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">trait</span> <span class="nx">AbstractTrait</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">concreteMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">abstractMethod</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">abstractMethod</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">TraitClassTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConcreteMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForTrait</span><span class="p">(</span><span class="nx">AbstractTrait</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">any</span><span class="p">())</span>
             <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;abstractMethod&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">concreteMethod</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">getMockForAbstractClass()</span></code> 方法返回一个抽象类的仿件对象。给定抽象类的所有抽象方法将都被模仿。这样就能对抽象类的具体方法进行测试。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mock-objects-examples-abstractclasstest-php">
<div class="code-block-caption"><span class="caption-text">对抽象类的具体方法进行测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">concreteMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">abstractMethod</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">abstractMethod</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">AbstractClassTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConcreteMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$stub</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForAbstractClass</span><span class="p">(</span><span class="nx">AbstractClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">any</span><span class="p">())</span>
             <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;abstractMethod&#39;</span><span class="p">)</span>
             <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$stub</span><span class="o">-&gt;</span><span class="na">concreteMethod</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="web-web-services">
<span id="test-doubles-stubbing-and-mocking-web-services"></span><h3>对 Web 服务(Web Services)进行上桩或模仿</h3>
<p>当应用程序需要和 web 服务进行交互时，会想要在不与 web 服务进行实际交互的情况下对其进行测试。为了简单地对 web 服务进行上桩或模仿，可以像使用 <code class="docutils literal notranslate"><span class="pre">getMock()</span></code> （见上文）那样使用 <code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code>。唯一的区别是 <code class="docutils literal notranslate"><span class="pre">getMockFromWsdl()</span></code> 所返回的桩件或者仿件是基于以 WSDL 描述的 web 服务，而 <code class="docutils literal notranslate"><span class="pre">getMock()</span></code> 返回的桩件或者仿件是基于 PHP 类或接口的。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">test-doubles.stubbing-and-mocking-web-services.examples.GoogleTest.php`展示了如何用</span> <span class="pre">``getMockFromWsdl()`</span></code> 来对（例如）:file:<cite>GoogleSearch.wsdl</cite> 中描述的 web 服务上桩。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-stubbing-and-mocking-web-services-examples-googletest-php">
<div class="code-block-caption"><span class="caption-text">对 web 服务上桩</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GoogleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSearch</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$googleSearch</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockFromWsdl</span><span class="p">(</span>
          <span class="s1">&#39;GoogleSearch.wsdl&#39;</span><span class="p">,</span> <span class="s1">&#39;GoogleSearch&#39;</span>
        <span class="p">);</span>

        <span class="nv">$directoryCategory</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
        <span class="nv">$directoryCategory</span><span class="o">-&gt;</span><span class="na">fullViewableName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$directoryCategory</span><span class="o">-&gt;</span><span class="na">specialEncoding</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

        <span class="nv">$element</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">summary</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">URL</span> <span class="o">=</span> <span class="s1">&#39;https://phpunit.de/&#39;</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">snippet</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;PHPUnit&lt;/b&gt;&#39;</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">cachedSize</span> <span class="o">=</span> <span class="s1">&#39;11k&#39;</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">relatedInformationPresent</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">hostName</span> <span class="o">=</span> <span class="s1">&#39;phpunit.de&#39;</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">directoryCategory</span> <span class="o">=</span> <span class="nv">$directoryCategory</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">directoryTitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">documentFiltering</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">searchComments</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">estimatedTotalResultsCount</span> <span class="o">=</span> <span class="mf">3.9000</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">estimateIsExact</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">resultElements</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$element</span><span class="p">];</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">searchQuery</span> <span class="o">=</span> <span class="s1">&#39;PHPUnit&#39;</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">startIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">endIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">searchTips</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">directoryCategories</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">searchTime</span> <span class="o">=</span> <span class="mf">0.248822</span><span class="p">;</span>

        <span class="nv">$googleSearch</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">any</span><span class="p">())</span>
                     <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;doGoogleSearch&#39;</span><span class="p">)</span>
                     <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="nv">$result</span><span class="p">));</span>

        <span class="sd">/**</span>
<span class="sd">         * $googleSearch-&gt;doGoogleSearch() 将会返回上桩的结果，</span>
<span class="sd">         * web 服务的 doGoogleSearch() 方法不会被调用。</span>
<span class="sd">         */</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
          <span class="nv">$result</span><span class="p">,</span>
          <span class="nv">$googleSearch</span><span class="o">-&gt;</span><span class="na">doGoogleSearch</span><span class="p">(</span>
            <span class="s1">&#39;00000000000000000000000000000000&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PHPUnit&#39;</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="k">false</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="k">false</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span>
          <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-doubles-mocking-the-filesystem">
<span id="id16"></span><h3>对文件系统进行模仿</h3>
<p><a class="reference external" href="https://github.com/mikey179/vfsStream">vfsStream</a> 是对`虚拟文件系统 &lt;<a class="reference external" href="http://en.wikipedia.org/wiki/Virtual_file_system">http://en.wikipedia.org/wiki/Virtual_file_system</a>&gt;`_ 的 <a class="reference external" href="http://www.php.net/streams">流包覆器(stream wrapper)</a>，可以用于模仿真实文件系统，在单元测试中可能会有所助益。</p>
<p>如果使用 <a class="reference external" href="https://getcomposer.org/">Composer</a> 来管理项目的依赖关系，那么只需简单的在项目的 <code class="docutils literal notranslate"><span class="pre">composer.json</span></code> 文件中加一条对 <code class="docutils literal notranslate"><span class="pre">mikey179/vfsStream</span></code> 的依赖关系即可。以下是一个最小化的 <a href="#id17"><span class="problematic" id="id18">``</span></a>composer.json``文件例子，只定义了一条对 PHPUnit 4.6 与 vfsStream 的开发时(development-time)依赖：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;require-dev&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;phpunit/phpunit&quot;</span><span class="o">:</span> <span class="s2">&quot;~4.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mikey179/vfsStream&quot;</span><span class="o">:</span> <span class="s2">&quot;~1&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>:numref:<a href="#id19"><span class="problematic" id="id20">`</span></a>test-doubles.mocking-the-filesystem.examples.Example.php`展示了一个与文件系统交互的类。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mocking-the-filesystem-examples-example-php">
<div class="code-block-caption"><span class="caption-text">一个与文件系统交互的类</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$directory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDirectory</span><span class="p">(</span><span class="nv">$directory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">directory</span> <span class="o">=</span> <span class="nv">$directory</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">directory</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">directory</span><span class="p">,</span> <span class="mo">0700</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>如果不使用诸如 vfsStream 这样的虚拟文件系统，就无法在隔离外部影响的情况下对 <code class="docutils literal notranslate"><span class="pre">setDirectory()</span></code> 方法进行测试（参见 <a class="reference internal" href="#test-doubles-mocking-the-filesystem-examples-exampletest-php"><span class="std std-numref">Example 9.22</span></a>）。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mocking-the-filesystem-examples-exampletest-php">
<div class="code-block-caption"><span class="caption-text">对一个与文件系统交互的类进行测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/id&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">rmdir</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/id&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDirectoryIsCreated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$example</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Example</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/id&#39;</span><span class="p">));</span>

        <span class="nv">$example</span><span class="o">-&gt;</span><span class="na">setDirectory</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/id&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/id&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">rmdir</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;/id&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>上面的方法有几个缺点：</p>
<ul class="simple">
<li>和任何其他外部资源一样，文件系统可能会间歇性的出现一些问题，这使得和它交互的测试变得不可靠。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 方法中，必须确保这个目录在测试前和测试后均不存在。</li>
<li>如果测试在 <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 方法被调用之前就终止了，这个目录就会遗留在文件系统中。</li>
</ul>
<p>:numref:<a href="#id21"><span class="problematic" id="id22">`</span></a>test-doubles.mocking-the-filesystem.examples.ExampleTest2.php`展示了如何在对与文件系统交互的类进行的测试中使用 vfsStream 来模仿文件系统。</p>
<div class="literal-block-wrapper docutils container" id="test-doubles-mocking-the-filesystem-examples-exampletest2-php">
<div class="code-block-caption"><span class="caption-text">在对与文件系统交互的类进行的测试中模仿文件系统</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">vfsStreamWrapper</span><span class="o">::</span><span class="na">register</span><span class="p">();</span>
        <span class="nx">vfsStreamWrapper</span><span class="o">::</span><span class="na">setRoot</span><span class="p">(</span><span class="k">new</span> <span class="nx">vfsStreamDirectory</span><span class="p">(</span><span class="s1">&#39;exampleDir&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDirectoryIsCreated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$example</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Example</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nx">vfsStreamWrapper</span><span class="o">::</span><span class="na">getRoot</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasChild</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>

        <span class="nv">$example</span><span class="o">-&gt;</span><span class="na">setDirectory</span><span class="p">(</span><span class="nx">vfsStream</span><span class="o">::</span><span class="na">url</span><span class="p">(</span><span class="s1">&#39;exampleDir&#39;</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nx">vfsStreamWrapper</span><span class="o">::</span><span class="na">getRoot</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasChild</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>这有几个优点：</p>
<ul class="simple">
<li>测试本身更加简洁。</li>
<li>vfsStream 让开发者能够完全控制被测代码所处的文件系统环境。</li>
<li>由于文件系统操作不再对真实文件系统进行操作，<code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> 方法中的清理操作不再需要了。</li>
</ul>
</div>
</div>
<span id="document-testing-practices"></span><div class="section" id="testing-practices">
<span id="id1"></span><h2>测试实践</h2>
<blockquote>
<div><p><em>Erich Gamma</em>:</p>
<p>你总能编写更多测试。但是很快就会发现，在所有想得出来的测试中只有很小一部分是真正有用的。需要编写的是那些觉得能运作但却失败或觉得必将失败但却成功的测试。另外一种思考方式是从成本/收益的关系上去考量。需要编写的是能够给出反馈信息的测试。</p>
</div></blockquote>
<div class="section" id="testing-practices-during-development">
<span id="id2"></span><h3>在开发过程中</h3>
<p>当需要对软件的内部结构进行更改时，你实际上是要在不影响其可见行为的情况下让它更加容易理解、更加易于修改，测试套件对于安全地进行这些所谓的`重构 &lt;<a class="reference external" href="http://martinfowler.com/bliki/DefinitionOfRefactoring.html">http://martinfowler.com/bliki/DefinitionOfRefactoring.html</a>&gt;`_而言是非常宝贵的。否则，你可能在重组过程中将系统搞坏而不自知。</p>
<p>在使用单元测试来确认重构的转换步骤中确实保持原有行为并且没有引入错误时，以下情况有助于改进项目的编码与设计：</p>
<ol class="arabic simple">
<li>所有单元测试均正确运行。</li>
<li>代码传达其设计原则。</li>
<li>代码没有冗余。</li>
<li>代码所包含的类和方法的数量降至最低。</li>
</ol>
<p>当需要向系统内添加新的功能时，首先为其编写测试。然后，当测试能够正常运行就标志着开发完成了。下一章将详细讨论这种做法。</p>
</div>
<div class="section" id="testing-practices-during-debugging">
<span id="id3"></span><h3>在调试过程中</h3>
<p>当看到缺陷报告时，你可能会有尽快修复错误的冲动。经验表明，这种冲动不是好事，因为修复一个缺陷时很可能导致另外一个缺陷。</p>
<p>下列操作可以帮你压住冲动：</p>
<ol class="arabic simple">
<li>确认能够重现此缺陷。</li>
<li>在代码中寻找此缺陷的最小规模表达。例如，如果在输出中有一个数字看起来不对，那么就寻找算出此数字的那个对象。</li>
<li>编写一个目前会失败而缺陷修复后将会成功的自动测试。</li>
<li>修复缺陷。</li>
</ol>
<p>寻找缺陷的最小可靠重现使你有机会去真正检查缺陷的原因。当修复了缺陷之后，所编写的测试则有助于提高缺陷真正被修复的几率，因为新加入的测试降低了未来修改代码时又破坏此修复的可能性。而之前所编写的所有测试则降低了在不经意间导致其他问题的可能性。</p>
<blockquote>
<div><p><em>Benjamin Smedberg</em>:</p>
<p>进行单元测试带来了很多好处：</p>
<ul class="simple">
<li>进行测试让代码的作者和评审者对补丁能够产生正确的结果有信心。</li>
<li>编写测试用例对开发者而言是一种很好的发现边缘情况的原动力。</li>
<li>进行测试提供了一种良好的方法来快速捕捉退步(Regression)，并且能用来保证退步不会重复出现。</li>
<li>单元测试就如何使用 API 提供了可正常工作的范例，能够大大帮助文档编制工作。</li>
</ul>
<p>总之，进行集成单元测试降低了任何修改的成本与风险。这使得项目能够更快并且更有信心地进行[…]重大架构改良[…]。</p>
</div></blockquote>
</div>
</div>
<span id="document-code-coverage-analysis"></span><div class="section" id="code-coverage-analysis">
<span id="id1"></span><h2>代码覆盖率分析</h2>
<blockquote>
<div><p><em>Wikipedia</em>:</p>
<p>计算机科学中所说的代码覆盖率是一种用于衡量特定测试套件对程序源代码测试程度的指标。拥有高代码覆盖率的程序相较于低代码低概率的程序而言测试的更加彻底、包含软件 bug 的可能性更低。</p>
</div></blockquote>
<p>在本章中，你将学到 PHPUnit 中与代码覆盖率相关的一切功能。通过这部分功能，能够了解在测试运行过程中执行了生产代码的哪些部分。它使用了 <a class="reference external" href="https://github.com/sebastianbergmann/php-code-coverage">PHP_CodeCoverage</a> 组件，而这个组件又使用了 PHP 的 <a class="reference external" href="http://xdebug.org/">Xdebug</a> 扩展所提供的代码覆盖率功能。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">Xdebug 不随 PHPUnit 分发。如果在运行测试时收到了 Xdebug 扩展未加载的提示，就意味着 Xdebug 未安装或者未正确配置。在使用 PHPUnit 的代码覆盖率分析功能之前，需要阅读下 <a class="reference external" href="http://xdebug.org/docs/install">Xdebug 安装指南</a>。</p>
</div>
<p>PHPUnit 可以生成基于 HTML 的代码覆盖率报告，同时也能生成好几种（Clover、Crap4J、PHPUnit）基于XML的代码覆盖率信息记录文件。代码覆盖率信息也能以文本格式提供（同时可以输出到STDOUT）或以PHP代码格式输出以供进一步处理。</p>
<p>:ref:<a href="#id3"><span class="problematic" id="id4">`</span></a>textui`中列出了各种控制代码覆盖率功能的命令行参数供参考，同时:ref:<a href="#id5"><span class="problematic" id="id6">`</span></a>appendixes.configuration.logging`中可以找到其他相关的配置信息。</p>
<div class="section" id="code-coverage-analysis-metrics">
<span id="id7"></span><h3>用于代码覆盖率的软件衡量标准</h3>
<p>目前存在多种软件衡量标准用于衡量代码覆盖率：</p>
<p><em>行覆盖率(Line Coverage)</em></p>
<blockquote>
<div><a href="#id8"><span class="problematic" id="id9">*</span></a>行覆盖率(Line Coverage)*按单个可执行行是否已执行到进行计量。</div></blockquote>
<p><em>函数与方法覆盖率(Function and Method Coverage)</em></p>
<blockquote>
<div><a href="#id10"><span class="problematic" id="id11">*</span></a>函数与方法覆盖率(Function and Method Coverage)*按单个函数或方法是否已调用到进行计量。仅当函数或方法的所有可执行行全部已覆盖时 PHP_CodeCoverage 才将其视为已覆盖。</div></blockquote>
<p><em>类与特质覆盖率(Class and Trait Coverage)</em></p>
<blockquote>
<div><a href="#id12"><span class="problematic" id="id13">*</span></a>类与特质覆盖率(Class and Trait Coverage)*按单个类或特质的所有方法是否全部已覆盖进行计量。仅当一个类或性状的所有方法全部已覆盖时 PHP_CodeCoverage 才将其视为已覆盖。</div></blockquote>
<p><em>Opcode 覆盖率(Opcode Coverage)</em></p>
<blockquote>
<div><a href="#id14"><span class="problematic" id="id15">*</span></a>Opcode 覆盖率*按函数或方法对应的每条 opcode 在运行测试套件时是否执行到进行计量。一行（PHP的）代码通常会编译得到多条 opcode。进行行覆盖率计量时，只要其中任何一条 opcode 被执行就视为此行已覆盖。</div></blockquote>
<p><em>分支覆盖率(Branch Coverage)</em></p>
<blockquote>
<div><a href="#id16"><span class="problematic" id="id17">*</span></a>分支覆盖率(Branch Coverage)*按控制结构的分支进行计量。测试套件运行时每个控制结构的布尔表达式求值为 <code class="docutils literal notranslate"><span class="pre">true</span></code> 和 <code class="docutils literal notranslate"><span class="pre">false</span></code> 各自计为一个分支。</div></blockquote>
<p><em>路径覆盖率(Path Coverage)</em></p>
<blockquote>
<div><a href="#id18"><span class="problematic" id="id19">*</span></a>路径覆盖率(Path Coverage)*按测试套件运行时函数或者方法内部所经历的执行路径进行计量。一个执行路径指的是从进入函数或方法一直到离开的过程中经过各个分支的特定序列。</div></blockquote>
<p><em>变更风险反模式(CRAP)指数(Change Risk Anti-Patterns (CRAP) Index)</em></p>
<blockquote>
<div><a href="#id20"><span class="problematic" id="id21">*</span></a>变更风险反模式(CRAP)指数(Change Risk Anti-Patterns (CRAP) Index)*是基于代码单元的圈复杂度(cyclomatic complexity)与代码覆盖率计算得出的。不太复杂并具有恰当测试覆盖率的代码将得出较低的CRAP指数。可以通过编写测试或重构代码来降低其复杂性的方式来降低CRAP指数。</div></blockquote>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">目前 PHP_CodeCoverage 尚不支持 <em>Opcode覆盖率</em>、<em>分支覆盖率</em> 及 <em>路径覆盖率</em>。</p>
</div>
</div>
<div class="section" id="code-coverage-analysis-whitelisting-files">
<span id="id22"></span><h3>将文件列入白名单</h3>
<p>为了告诉 PHPUnit 哪些源代码文件要包含在代码覆盖率报告中，必须配置*白名单*。可以用命令行选项 <code class="docutils literal notranslate"><span class="pre">--whitelist</span></code> 或通过配置文件（参见 <a class="reference internal" href="index.html#appendixes-configuration-whitelisting-files"><span class="std std-ref">Whitelisting Files for Code Coverage</span></a>）来完成。</p>
<p>可以在 PHPUnit 的配置信息中设置 <code class="docutils literal notranslate"><span class="pre">addUncoveredFilesFromWhitelist=&quot;true&quot;</span></code> 来将白名单中包含的所有文件全部加入到代码覆盖率报告中（参见:ref:<cite>appendixes.configuration.whitelisting-files</cite>）。这样可以把完全没有测试到的文件也一并包含到报告中。如果需要知道这些未被覆盖文件中有哪些行是可执行的，需要同时在 PHPUnit 的配置信息中设置 <a href="#id23"><span class="problematic" id="id24">``</span></a>processUncoveredFilesFromWhitelist=”true”<a href="#id25"><span class="problematic" id="id26">``</span></a>（参见:ref:<cite>appendixes.configuration.whitelisting-files</cite>）。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">请注意，当设置了 <code class="docutils literal notranslate"><span class="pre">processUncoveredFilesFromWhitelist=&quot;true&quot;</span></code> 时将对源代码文件进行载入，这在某些情况下可能导致问题，比如，源代码文件包含有处于类或者函数作用域之外的代码。</p>
</div>
</div>
<div class="section" id="code-coverage-analysis-ignoring-code-blocks">
<span id="id27"></span><h3>略过代码块</h3>
<p>有时，一些代码块是无法对其进行测试的，因此希望在代码覆盖率分析中忽略它们。在 PHPUnit 中可以用 <code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnore</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnoreStart</span></code> 与 <code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnoreEnd</span></code> 标注来做到这点，如:numref:<a href="#id28"><span class="problematic" id="id29">`</span></a>code-coverage-analysis.ignoring-code-blocks.examples.Sample.php`中所示。</p>
<div class="literal-block-wrapper docutils container" id="code-coverage-analysis-ignoring-code-blocks-examples-sample-php">
<div class="code-block-caption"><span class="caption-text">使用 <code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnore</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnoreStart</span></code> 与 <code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnoreEnd</span></code> 标注</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @codeCoverageIgnore</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Bar</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @codeCoverageIgnore</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// @codeCoverageIgnoreStart</span>
    <span class="k">print</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>
    <span class="c1">// @codeCoverageIgnoreEnd</span>
<span class="p">}</span>

<span class="k">exit</span><span class="p">;</span> <span class="c1">// @codeCoverageIgnore</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>代码中被忽略掉的行（用标注标记为忽略）将会计为已执行（如果它们是可执行的），并且不会在代码覆盖情况中被高亮标记。</p>
</div>
<div class="section" id="code-coverage-analysis-specifying-covered-methods">
<span id="id30"></span><h3>指明要覆盖的方法</h3>
<p><code class="docutils literal notranslate"><span class="pre">&#64;covers</span></code> 标注（参见 <a class="reference internal" href="index.html#appendixes-annotations-covers-tables-annotations"><span class="std std-ref">用于指明测试覆盖哪些方法的标注</span></a>）可以用在测试代码中来指明测试方法想要对哪些方法进行测试。如果提供了这个信息，则只有指定方法的代码覆盖率信息会被统计。 :numref:<a href="#id31"><span class="problematic" id="id32">`</span></a>code-coverage-analysis.specifying-covered-methods.examples.BankAccountTest.php`展示了一个例子。</p>
<div class="literal-block-wrapper docutils container" id="code-coverage-analysis-specifying-covered-methods-examples-bankaccounttest-php">
<div class="code-block-caption"><span class="caption-text">在测试中指明欲覆盖哪些方法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BankAccountTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$ba</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BankAccount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @covers BankAccount::getBalance</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBalanceIsInitiallyZero</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @covers BankAccount::withdrawMoney</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBalanceCannotBecomeNegative</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">withdrawMoney</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">catch</span> <span class="p">(</span><span class="nx">BankAccountException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @covers BankAccount::depositMoney</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBalanceCannotBecomeNegative2</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">depositMoney</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">catch</span> <span class="p">(</span><span class="nx">BankAccountException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @covers BankAccount::getBalance</span>
<span class="sd">     * @covers BankAccount::depositMoney</span>
<span class="sd">     * @covers BankAccount::withdrawMoney</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDepositWithdrawMoney</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">depositMoney</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">withdrawMoney</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>同时，可以用 <code class="docutils literal notranslate"><span class="pre">&#64;coversNothing</span></code> 标注来指明一个测试不覆盖*任何*方法（参见:ref:<cite>appendixes.annotations.coversNothing</cite>）。这可以在编写集成测试时用于确保代码覆盖全部来自单元测试。</p>
<div class="literal-block-wrapper docutils container" id="code-coverage-analysis-specifying-covered-methods-examples-guestbookintegrationtest-php">
<div class="code-block-caption"><span class="caption-text">指明测试不欲覆盖任何方法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GuestbookIntegrationTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Extensions_Database_TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @coversNothing</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAddEntry</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$guestbook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Guestbook</span><span class="p">();</span>
        <span class="nv">$guestbook</span><span class="o">-&gt;</span><span class="na">addEntry</span><span class="p">(</span><span class="s2">&quot;suzy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello world!&quot;</span><span class="p">);</span>

        <span class="nv">$queryTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryTable</span><span class="p">(</span>
            <span class="s1">&#39;guestbook&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT * FROM guestbook&#39;</span>
        <span class="p">);</span>

        <span class="nv">$expectedTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFlatXmlDataSet</span><span class="p">(</span><span class="s2">&quot;expectedBook.xml&quot;</span><span class="p">)</span>
                              <span class="o">-&gt;</span><span class="na">getTable</span><span class="p">(</span><span class="s2">&quot;guestbook&quot;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTablesEqual</span><span class="p">(</span><span class="nv">$expectedTable</span><span class="p">,</span> <span class="nv">$queryTable</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="code-coverage-analysis-edge-cases">
<span id="id33"></span><h3>边缘情况</h3>
<p>本节中展示了一些值得注意的边缘情况，在这些边缘情况中可能出现令人迷惑的代码覆盖率信息。</p>
<div class="highlight-php notranslate" id="code-coverage-analysis-edge-cases-examples-sample-php"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="c1">// 因为覆盖率是“基于行”而不是基于语句的，</span>
<span class="c1">// 每行只会有一种覆盖状态</span>
<span class="k">if</span> <span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="nx">this_function_call_shows_up_as_covered</span><span class="p">();</span>

<span class="c1">// 由于代码覆盖率的内部工作方式，这两行显得很特殊。</span>
<span class="c1">// 这一行会显示为非可执行</span>
<span class="k">if</span> <span class="p">(</span><span class="k">false</span><span class="p">)</span>
    <span class="c1">// 这一行会显示为已覆盖，</span>
    <span class="c1">// 实际上是上一行的 if 语句的覆盖信息显示在这了！</span>
    <span class="nx">will_also_show_up_as_covered</span><span class="p">();</span>

<span class="c1">// 要避免这种情况，必须使用大括号</span>
<span class="k">if</span> <span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">this_call_will_never_show_up_as_covered</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<span id="document-other-uses-for-tests"></span><div class="section" id="other-uses-for-tests">
<span id="id1"></span><h2>测试的其他用途</h2>
<p>一旦习惯了编写自动测试，就可能会发现测试的更多用途。这有一些例子。</p>
<div class="section" id="other-uses-for-tests-agile-documentation">
<span id="id2"></span><h3>敏捷文档</h3>
<p>通常，在使用了诸如极限编程之类的敏捷流程的项目中，文档往往无法跟上项目设计与代码的频繁变更。极限编程要求*群体代码所有权(collective code ownership)*，因此所有开发者都需要知道整个系统是如何工作的。如果你足够训练有素，为测试使用了“能说明问题的名称(speaking names)”来描述各个类应当干什么，那么就可以用 PHPUnit 的 TestDox 功能来基于项目的测试生成项目的自动文档。这个文档能够就项目中的各个类应当起什么作用给开发者一份概述。</p>
<p>PHPUnit 的 TestDox 功能着眼于测试类及其所有测试方法的名称，将它们驼峰式大小写（camel case）拼写的 PHP 名称转换为句子：<code class="docutils literal notranslate"><span class="pre">testBalanceIsInitiallyZero()</span></code> 转化为 “Balance is initially zero（初始结余为零）”。如果有多个测试方法的名字互相之间的差异只是一个或多个数字的后缀，例如 <code class="docutils literal notranslate"><span class="pre">testBalanceCannotBecomeNegative()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">testBalanceCannotBecomeNegative2()</span></code>，假如所有这些测试都成功，句子”Balance cannot become negative（结余不能变为负数）”只会出现一次。</p>
<p>来看一下从 <code class="docutils literal notranslate"><span class="pre">BankAccount</span></code> 类生成的敏捷文档：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit --testdox BankAccountTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

BankAccount
 <span class="o">[</span>x<span class="o">]</span> Balance is initially zero
 <span class="o">[</span>x<span class="o">]</span> Balance cannot become negative
</pre></div>
</div>
<p>另外，敏捷文档也可以以 HTML 或纯文本格式生成，并写入文件中，用 <code class="docutils literal notranslate"><span class="pre">--testdox-html</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--testdox-text</span></code> 参数即可。</p>
<p>敏捷文档可以用于将对项目所使用的外部包所做出的假设文档化。使用外部包，你就暴露于这个包的行为与你所预期的不同的风险中，并且包的未来版本可能在你所不知道的情况下有微妙的改变并破坏你的代码。每次做出假设时就编写一个对应的测试可以处理这些风险。如果测试成功，那么假设就有效。如果所有的假设都通过测试来文档化，外部包在未来发布新版本就不会引起忧虑：如果测试成功，那么系统就应当能继续正常运作。</p>
</div>
<div class="section" id="other-uses-for-tests-cross-team-tests">
<span id="id3"></span><h3>跨团队测试</h3>
<p>一旦用测试将假设文档化，你就拥有了测试。包的提供者——你做假设的对象——对你的测试一无所知。如果打算与包的提供者有更亲密的关系，可以用测试来沟通与协调你的活动。</p>
<p>当你愿意和包的提供着协调你的活动时，你们可以共同编写测试。通过这样的方式，测试能够展现出尽可能多的假设。隐藏的假设是在给合作判死刑。利用测试，你精确的将对所提供的包的预期文档化。提供者在所有测试顺利运行时就知道包已经完整了。</p>
<p>通过使用桩件（参见本书前面关于“仿件对象”的那一章），你可以更好的与供应商解耦：供应商的工作就是让测试能够运行于包的实际实现上；你的工作则是让测试能够运行于你自己的代码上。在你拿到包的实际实现前，使用桩件对象。通过这种方式，两个团队可以互相独立的进行开发。</p>
</div>
</div>
<span id="document-logging"></span><div class="section" id="logging">
<span id="id1"></span><h2>Logging （日志记录）</h2>
<p>PHPUnit 可以生成几种类型的日志文件。</p>
<div class="section" id="xml">
<span id="logging-xml"></span><h3>测试结果 (XML)</h3>
<p>PHPUnit 所生成的测试结果 XML 日志文件是基于 <a class="reference external" href="http://ant.apache.org/manual/Tasks/junit.html">JUnit task for Apache Ant</a> 所使用的 XML 日志的。下面的例子展示了 <code class="docutils literal notranslate"><span class="pre">ArrayTest</span></code> 中的测试所生成的 XML 日志文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>?&gt;
&lt;testsuites&gt;
  &lt;testsuite <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ArrayTest&quot;</span>
             <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/home/sb/ArrayTest.php&quot;</span>
             <span class="nv">tests</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>
             <span class="nv">assertions</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>
             <span class="nv">failures</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
             <span class="nv">errors</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
             <span class="nv">time</span><span class="o">=</span><span class="s2">&quot;0.016030&quot;</span>&gt;
    &lt;testcase <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;testNewArrayIsEmpty&quot;</span>
              <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;ArrayTest&quot;</span>
              <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/home/sb/ArrayTest.php&quot;</span>
              <span class="nv">line</span><span class="o">=</span><span class="s2">&quot;6&quot;</span>
              <span class="nv">assertions</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
              <span class="nv">time</span><span class="o">=</span><span class="s2">&quot;0.008044&quot;</span>/&gt;
    &lt;testcase <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;testArrayContainsAnElement&quot;</span>
              <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;ArrayTest&quot;</span>
              <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/home/sb/ArrayTest.php&quot;</span>
              <span class="nv">line</span><span class="o">=</span><span class="s2">&quot;15&quot;</span>
              <span class="nv">assertions</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
              <span class="nv">time</span><span class="o">=</span><span class="s2">&quot;0.007986&quot;</span>/&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></div>
</div>
<p>以下 XML 日志文件是由名为 <code class="docutils literal notranslate"><span class="pre">FailureErrorTest</span></code> 的测试用例类中的两个测试 <code class="docutils literal notranslate"><span class="pre">testFailure</span></code> 和 <code class="docutils literal notranslate"><span class="pre">testError</span></code> 所生成的，展示了失败和错误是如何表示的：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>?&gt;
&lt;testsuites&gt;
  &lt;testsuite <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;FailureErrorTest&quot;</span>
             <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/home/sb/FailureErrorTest.php&quot;</span>
             <span class="nv">tests</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>
             <span class="nv">assertions</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
             <span class="nv">failures</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
             <span class="nv">errors</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
             <span class="nv">time</span><span class="o">=</span><span class="s2">&quot;0.019744&quot;</span>&gt;
    &lt;testcase <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;testFailure&quot;</span>
              <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;FailureErrorTest&quot;</span>
              <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/home/sb/FailureErrorTest.php&quot;</span>
              <span class="nv">line</span><span class="o">=</span><span class="s2">&quot;6&quot;</span>
              <span class="nv">assertions</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
              <span class="nv">time</span><span class="o">=</span><span class="s2">&quot;0.011456&quot;</span>&gt;
      &lt;failure <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;PHPUnit_Framework_ExpectationFailedException&quot;</span>&gt;
testFailure<span class="o">(</span>FailureErrorTest<span class="o">)</span>
Failed asserting that <span class="p">&amp;</span>lt<span class="p">;</span>integer:2<span class="p">&amp;</span>gt<span class="p">;</span> matches expected value <span class="p">&amp;</span>lt<span class="p">;</span>integer:1<span class="p">&amp;</span>gt<span class="p">;</span>.

/home/sb/FailureErrorTest.php:8
&lt;/failure&gt;
    &lt;/testcase&gt;
    &lt;testcase <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;testError&quot;</span>
              <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;FailureErrorTest&quot;</span>
              <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/home/sb/FailureErrorTest.php&quot;</span>
              <span class="nv">line</span><span class="o">=</span><span class="s2">&quot;11&quot;</span>
              <span class="nv">assertions</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
              <span class="nv">time</span><span class="o">=</span><span class="s2">&quot;0.008288&quot;</span>&gt;
      &lt;error <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;Exception&quot;</span>&gt;testError<span class="o">(</span>FailureErrorTest<span class="o">)</span>
Exception:

/home/sb/FailureErrorTest.php:13
&lt;/error&gt;
    &lt;/testcase&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></div>
</div>
</div>
<div class="section" id="logging-codecoverage-xml">
<span id="id2"></span><h3>代码覆盖率 (XML)</h3>
<p>PHPUnit 所生成的 XML 格式代码覆盖率信息日志记录不严格地基于 <a class="reference external" href="http://www.atlassian.com/software/clover/">Clover</a>.  所使用的 XML 日志的。下面的例子展示了 <code class="docutils literal notranslate"><span class="pre">BankAccountTest</span></code> 中的测试所生成的 XML 日志文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>?&gt;
&lt;coverage <span class="nv">generated</span><span class="o">=</span><span class="s2">&quot;1184835473&quot;</span> <span class="nv">phpunit</span><span class="o">=</span><span class="s2">&quot;3.6.0&quot;</span>&gt;
  &lt;project <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;BankAccountTest&quot;</span> <span class="nv">timestamp</span><span class="o">=</span><span class="s2">&quot;1184835473&quot;</span>&gt;
    &lt;file <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;/home/sb/BankAccount.php&quot;</span>&gt;
      &lt;class <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;BankAccountException&quot;</span>&gt;
        &lt;metrics <span class="nv">methods</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">coveredmethods</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">statements</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
                 <span class="nv">coveredstatements</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">elements</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="nv">coveredelements</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
      &lt;/class&gt;
      &lt;class <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;BankAccount&quot;</span>&gt;
        &lt;metrics <span class="nv">methods</span><span class="o">=</span><span class="s2">&quot;4&quot;</span> <span class="nv">coveredmethods</span><span class="o">=</span><span class="s2">&quot;4&quot;</span> <span class="nv">statements</span><span class="o">=</span><span class="s2">&quot;13&quot;</span>
                 <span class="nv">coveredstatements</span><span class="o">=</span><span class="s2">&quot;5&quot;</span> <span class="nv">elements</span><span class="o">=</span><span class="s2">&quot;17&quot;</span> <span class="nv">coveredelements</span><span class="o">=</span><span class="s2">&quot;9&quot;</span>/&gt;
      &lt;/class&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;77&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;method&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;3&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;79&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;3&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;89&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;method&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;91&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;92&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;93&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;94&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;96&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;105&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;method&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;107&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;109&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;119&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;method&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;121&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>/&gt;
      &lt;line <span class="nv">num</span><span class="o">=</span><span class="s2">&quot;123&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;stmt&quot;</span> <span class="nv">count</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>/&gt;
      &lt;metrics <span class="nv">loc</span><span class="o">=</span><span class="s2">&quot;126&quot;</span> <span class="nv">ncloc</span><span class="o">=</span><span class="s2">&quot;37&quot;</span> <span class="nv">classes</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">methods</span><span class="o">=</span><span class="s2">&quot;4&quot;</span> <span class="nv">coveredmethods</span><span class="o">=</span><span class="s2">&quot;4&quot;</span>
               <span class="nv">statements</span><span class="o">=</span><span class="s2">&quot;13&quot;</span> <span class="nv">coveredstatements</span><span class="o">=</span><span class="s2">&quot;5&quot;</span> <span class="nv">elements</span><span class="o">=</span><span class="s2">&quot;17&quot;</span>
               <span class="nv">coveredelements</span><span class="o">=</span><span class="s2">&quot;9&quot;</span>/&gt;
    &lt;/file&gt;
    &lt;metrics <span class="nv">files</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">loc</span><span class="o">=</span><span class="s2">&quot;126&quot;</span> <span class="nv">ncloc</span><span class="o">=</span><span class="s2">&quot;37&quot;</span> <span class="nv">classes</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="nv">methods</span><span class="o">=</span><span class="s2">&quot;4&quot;</span>
             <span class="nv">coveredmethods</span><span class="o">=</span><span class="s2">&quot;4&quot;</span> <span class="nv">statements</span><span class="o">=</span><span class="s2">&quot;13&quot;</span> <span class="nv">coveredstatements</span><span class="o">=</span><span class="s2">&quot;5&quot;</span>
             <span class="nv">elements</span><span class="o">=</span><span class="s2">&quot;17&quot;</span> <span class="nv">coveredelements</span><span class="o">=</span><span class="s2">&quot;9&quot;</span>/&gt;
  &lt;/project&gt;
&lt;/coverage&gt;
</pre></div>
</div>
</div>
<div class="section" id="text">
<span id="logging-codecoverage-text"></span><h3>代码覆盖率 (TEXT)</h3>
<p>以易于常人了解(human-readable)的格式生成代码覆盖率，输出到命令行或保存成文本文件。这个输出格式旨在为工作于少量类时提供快捷的覆盖情况概览。对于更大的项目，这个输出有助于对项目的覆盖情况有一个快速的概览，或者配合 <code class="docutils literal notranslate"><span class="pre">--filter</span></code> 功能使用也会很有用。若从命令行调用并且写入到 <code class="docutils literal notranslate"><span class="pre">php://stdout</span></code>，<code class="docutils literal notranslate"><span class="pre">--colors</span></code> 设置会非常好用。从命令行调用时，写入到标准输出是默认选项。默认情况下，只会显示至少有一行被覆盖的文件。这只能通过 XML 配置选项 <code class="docutils literal notranslate"><span class="pre">showUncoveredFiles</span></code> 来改变。参见 <a class="reference internal" href="index.html#appendixes-configuration-logging"><span class="std std-ref">Logging （日志记录）</span></a>。默认情况下，在详细报告中会显示所有文件以及它们的覆盖情况。这可以通过 XML 配置选项 <code class="docutils literal notranslate"><span class="pre">showOnlySummary</span></code> 来改变。.</p>
</div>
</div>
<span id="document-extending-phpunit"></span><div class="section" id="phpunit">
<span id="extending-phpunit"></span><h2>扩展 PHPUnit</h2>
<p>可以用多种方式对 PHPUnit 进行扩展，使编写测试更容易，以及对运行测试所得到的反馈进行定制。扩展 PHPUnit 时，一般从这些点入手：</p>
<div class="section" id="phpunit-framework-testcase">
<span id="extending-phpunit-phpunit-framework-testcase"></span><h3>PHPUnit\Framework\TestCase 的子类</h3>
<p>将自定义的断言和工具方法写在 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code> 的一个抽象子类中，然后从这个抽象子类派生你的测试用例类。这是扩展 PHPUnit 的最容易的方法。</p>
</div>
<div class="section" id="extending-phpunit-custom-assertions">
<span id="id1"></span><h3>编写自定义断言</h3>
<p>编写自定义断言时，最佳实践是遵循 PHPUnit 自有断言的实现方式。正如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">extending-phpunit.examples.Assert.php`中所示，``assertTrue()`</span></code> 方法只是对 <code class="docutils literal notranslate"><span class="pre">isTrue()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertThat()</span></code> 方法的外包覆：<code class="docutils literal notranslate"><span class="pre">isTrue()</span></code> 创建了一个匹配器对象，将其传递给 <code class="docutils literal notranslate"><span class="pre">assertThat()</span></code> 进行评定。</p>
<div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-assert-php">
<div class="code-block-caption"><span class="caption-text">PHPUnit_Framework_Assert 类的 assertTrue() 与 isTrue() 方法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">PHPUnit_Framework_Assert</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * 断言某个条件为真。</span>
<span class="sd">     *</span>
<span class="sd">     * @param  boolean $condition</span>
<span class="sd">     * @param  string  $message</span>
<span class="sd">     * @throws PHPUnit_Framework_AssertionFailedError</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">assertTrue</span><span class="p">(</span><span class="nv">$condition</span><span class="p">,</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">assertThat</span><span class="p">(</span><span class="nv">$condition</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="na">isTrue</span><span class="p">(),</span> <span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * 返回一个 PHPUnit_Framework_Constraint_IsTrue 匹配器对象</span>
<span class="sd">     *</span>
<span class="sd">     * @return PHPUnit_Framework_Constraint_IsTrue</span>
<span class="sd">     * @since  Method available since Release 3.3.0</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">isTrue</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">PHPUnit_Framework_Constraint_IsTrue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span><span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">extending-phpunit.examples.IsTrue.php`展示了</span> <span class="pre">``PHPUnit_Framework_Constraint_IsTrue`</span></code> 是如何扩展针对匹配器对象（或约束）的抽象基类 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint</span></code> 的。</p>
<div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-istrue-php">
<div class="code-block-caption"><span class="caption-text">PHPUnit_Framework_Constraint_IsTrue  类</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PHPUnit_Framework_Constraint_IsTrue</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_Constraint</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 对参数 $other 进行约束评定。如果符合约束，</span>
<span class="sd">     * 返回 TRUE，否则返回 FALSE。</span>
<span class="sd">     *</span>
<span class="sd">     * @param mixed $other Value or object to evaluate.</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">matches</span><span class="p">(</span><span class="nv">$other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$other</span> <span class="o">===</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 返回代表此约束的字符串。</span>
<span class="sd">     *</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">toString</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;is true&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span><span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在实现 <code class="docutils literal notranslate"><span class="pre">assertTrue()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">isTrue()</span></code> 方法及 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsTrue</span></code> 类时所付出的努力带来了一些好处，<code class="docutils literal notranslate"><span class="pre">assertThat()</span></code> 能够自动负责起断言的评定与任务簿记（例如为了统计目的而对其进行计数）工作。此外， <code class="docutils literal notranslate"><span class="pre">isTrue()</span></code> 方法还可以在配置仿件对象时用来作为匹配器。</p>
</div>
<div class="section" id="phpunit-framework-testlistener">
<span id="extending-phpunit-phpunit-framework-testlistener"></span><h3>实现 PHPUnit\Framework\TestListener</h3>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">extending-phpunit.examples.SimpleTestListener.php`展示了</span> <span class="pre">``PHPUnitFrameworkTestListener`</span></code> 接口的一个简单实现。</p>
<div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-simpletestlistener-php">
<div class="code-block-caption"><span class="caption-text">简单的测试监听器</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestListener</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SimpleTestListener</span> <span class="k">implements</span> <span class="nx">TestListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addError</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Error while running test &#39;%s&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addFailure</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nx">PHPUnit_Framework_AssertionFailedError</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; failed.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addIncompleteTest</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; is incomplete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addRiskyTest</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; is deemed risky.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addSkippedTest</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nx">Exception</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; has been skipped.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">startTest</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; started.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">endTest</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; ended.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">startTestSuite</span><span class="p">(</span><span class="nx">PHPUnit_Framework_TestSuite</span> <span class="nv">$suite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;TestSuite &#39;%s&#39; started.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$suite</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">endTestSuite</span><span class="p">(</span><span class="nx">PHPUnit_Framework_TestSuite</span> <span class="nv">$suite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;TestSuite &#39;%s&#39; ended.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$suite</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">extending-phpunit.examples.BaseTestListener.php`展示了如何从抽象类</span> <span class="pre">``PHPUnit_Framework_BaseTestListener`</span></code> 派生子类，这个抽象类为所有接口方法提供了空白实现，这样你就只需要指定那些在你的使用情境下有意义的接口方法。</p>
<div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-basetestlistener-php">
<div class="code-block-caption"><span class="caption-text">使用测试监听器基类</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShortTestListener</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_BaseTestListener</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">endTest</span><span class="p">(</span><span class="nx">PHPUnit_Framework_Test</span> <span class="nv">$test</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Test &#39;%s&#39; ended.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p>在:ref:<a href="#id2"><span class="problematic" id="id3">`</span></a>appendixes.configuration.test-listeners`中可以看到如何配置 PHPUnit 来将测试监听器附加到测试执行过程上。</p>
</div>
<div class="section" id="phpunit-framework-test">
<span id="extending-phpunit-phpunit-framework-test"></span><h3>实现 PHPUnit_Framework_Test</h3>
<p><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Test</span></code> 接口是比较狭义的，十分容易实现。举例来说，你可以自行为 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Test</span></code> 编写一个类似于 <code class="docutils literal notranslate"><span class="pre">PHPUnit\Framework\TestCase</span></code> 的实现来运行*数据驱动测试*。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">extending-phpunit.examples.DataDrivenTest.php`展示了一个数据驱动的测试用例类，对来自</span> <span class="pre">CSV</span> <span class="pre">文件内的值进行比较。这个文件内的每个行看起来类似于</span> <span class="pre">``foo;bar`</span></code>，第一个值是期望值，第二个值则是实际值。</p>
<div class="literal-block-wrapper docutils container" id="extending-phpunit-examples-datadriventest-php">
<div class="code-block-caption"><span class="caption-text">一个数据驱动的测试</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DataDrivenTest</span> <span class="k">implements</span> <span class="nx">PHPUnit_Framework_Test</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$lines</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$dataFile</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="nv">$dataFile</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span><span class="nx">PHPUnit_Framework_TestResult</span> <span class="nv">$result</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPUnit_Framework_TestResult</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lines</span> <span class="k">as</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">startTest</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
            <span class="nx">PHP_Timer</span><span class="o">::</span><span class="na">start</span><span class="p">();</span>
            <span class="nv">$stopTime</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

            <span class="k">list</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>

            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">PHPUnit_Framework_Assert</span><span class="o">::</span><span class="na">assertEquals</span><span class="p">(</span>
                  <span class="nb">trim</span><span class="p">(</span><span class="nv">$expected</span><span class="p">),</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$actual</span><span class="p">)</span>
                <span class="p">);</span>
            <span class="p">}</span>

            <span class="k">catch</span> <span class="p">(</span><span class="nx">PHPUnit_Framework_AssertionFailedError</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$stopTime</span> <span class="o">=</span> <span class="nx">PHP_Timer</span><span class="o">::</span><span class="na">stop</span><span class="p">();</span>
                <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">addFailure</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$stopTime</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$stopTime</span> <span class="o">=</span> <span class="nx">PHP_Timer</span><span class="o">::</span><span class="na">stop</span><span class="p">();</span>
                <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">addError</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$stopTime</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nv">$stopTime</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$stopTime</span> <span class="o">=</span> <span class="nx">PHP_Timer</span><span class="o">::</span><span class="na">stop</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">endTest</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$stopTime</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataDrivenTest</span><span class="p">(</span><span class="s1">&#39;data_file.csv&#39;</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">PHPUnit_TextUI_TestRunner</span><span class="o">::</span><span class="na">run</span><span class="p">(</span><span class="nv">$test</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

.F

Time: <span class="m">0</span> seconds

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DataDrivenTest
Failed asserting that two strings are equal.
expected string &lt;bar&gt;
difference      &lt;  x&gt;
got string      &lt;baz&gt;
/home/sb/DataDrivenTest.php:32
/home/sb/DataDrivenTest.php:53

FAILURES!
Tests: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-assertions"></span><p>==
断言
==</p>
<p>本附录列举可用的各种断言方法。</p>
<div class="section" id="vs">
<span id="appendixes-assertions-static-vs-non-static-usage-of-assertion-methods"></span><h2>断言方法的用法：静态 vs. 非静态</h2>
<p>PHPUnit 的各个断言是在 PHPUnit\Framework\Assert 中实现的。PHPUnit\Framework\TestCase 则继承于 PHPUnit\Framework\Assert。</p>
<p>各个断言方法均声明为 static，可以从任何上下文以类似于 PHPUnit\Framework\Assert::assertTrue() 的方式调用，或者也可以用类似于 $this-&gt;assertTrue() 或 self::assertTrue() 的方式在扩展自 PHPUnit\Framework\TestCase 的类内调用。</p>
<p>实际上，只要（手工）包含了 PHPUnit 中的 <code class="file docutils literal notranslate"><span class="pre">src/Framework/Assert/Functions.php</span></code> 源码文件，甚至可以在任何上下文中（甚至包括扩展自 PHPUnit\Framework\TestCase 的类中）以诸如 assertTrue() 这样的方式来调用全局函数封装。</p>
<p>有个常见的疑问——对于那些 PHPUnit 的新手尤甚——是究竟应该用诸如 $this-&gt;assertTrue() 还是诸如 self::assertTrue() 这样的形式来调用断言才是“正确的方式”？简而言之：没有正确方式。同时，也没有错误方式。这基本上是个人喜好问题。</p>
<p>对于大多数人而言，由于测试方法是在测试对象上调用，因此用 $this-&gt;assertTrue() 会“觉的更正确”。然而请记住断言方法是声明为 static 的，这使其可以（重）用于测试对象的作用域之外。最后，全局函数封装让开发者能再少打一些字（用 assertTrue() 代替 $this-&gt;assertTrue() 或者 self::assertTrue()）。</p>
</div>
<div class="section" id="assertarrayhaskey">
<span id="appendixes-assertions-assertarrayhaskey"></span><h2>assertArrayHasKey()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertArrayHasKey(mixed</span> <span class="pre">$key,</span> <span class="pre">array</span> <span class="pre">$array[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$array</span></code> 不包含 <code class="docutils literal notranslate"><span class="pre">$key</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertArrayNotHasKey()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertarrayhaskey-example">
<div class="code-block-caption"><span class="caption-text">assertArrayHasKey() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArrayHasKeyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertArrayHasKey</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ArrayHasKeyTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ArrayHasKeyTest::testFailure
Failed asserting that an array has the key <span class="s1">&#39;foo&#39;</span>.

/home/sb/ArrayHasKeyTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertclasshasattribute">
<span id="appendixes-assertions-assertclasshasattribute"></span><h2>assertClassHasAttribute()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertClassHasAttribute(string</span> <span class="pre">$attributeName,</span> <span class="pre">string</span> <span class="pre">$className[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$className::attributeName</span></code> 不存在时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertClassNotHasAttribute()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertclasshasattribute-example">
<div class="code-block-caption"><span class="caption-text">assertClassHasAttribute() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ClassHasAttributeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertClassHasAttribute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">stdClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ClassHasAttributeTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ClassHasAttributeTest::testFailure
Failed asserting that class <span class="s2">&quot;stdClass&quot;</span> has attribute <span class="s2">&quot;foo&quot;</span>.

/home/sb/ClassHasAttributeTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertarraysubset">
<span id="appendixes-assertions-assertarraysubset"></span><h2>assertArraySubset()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertArraySubset(array</span> <span class="pre">$subset,</span> <span class="pre">array</span> <span class="pre">$array[,</span> <span class="pre">bool</span> <span class="pre">$strict</span> <span class="pre">=</span> <span class="pre">'',</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$array</span></code> 不包含 <code class="docutils literal notranslate"><span class="pre">$subset</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">$strict</span></code> 是一个标志，用于表明是否需要对数组中的对象进行全等判定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertarraysubset-example">
<div class="code-block-caption"><span class="caption-text">assertArraySubset() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArraySubsetTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertArraySubset</span><span class="p">([</span><span class="s1">&#39;config&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;key-a&#39;</span><span class="p">,</span> <span class="s1">&#39;key-b&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;config&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;key-a&#39;</span><span class="p">]]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ArrayHasKeyTest
PHPUnit <span class="m">4</span>.4.0 by Sebastian Bergmann.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> Epilog<span class="se">\E</span>pilogTest::testNoFollowOption
Failed asserting that an array has the subset Array <span class="p">&amp;</span><span class="m">0</span> <span class="o">(</span>
    <span class="s1">&#39;config&#39;</span> <span class="o">=</span>&gt; Array <span class="p">&amp;</span><span class="m">1</span> <span class="o">(</span>
        <span class="nv">0</span> <span class="o">=</span>&gt; <span class="s1">&#39;key-a&#39;</span>
        <span class="nv">1</span> <span class="o">=</span>&gt; <span class="s1">&#39;key-b&#39;</span>
    <span class="o">)</span>
<span class="o">)</span>.

/home/sb/ArraySubsetTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertclasshasstaticattribute">
<span id="appendixes-assertions-assertclasshasstaticattribute"></span><h2>assertClassHasStaticAttribute()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertClassHasStaticAttribute(string</span> <span class="pre">$attributeName,</span> <span class="pre">string</span> <span class="pre">$className[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$className::attributeName</span></code> 不存在时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertClassNotHasStaticAttribute()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertclasshasstaticattribute-example">
<div class="code-block-caption"><span class="caption-text">assertClassHasStaticAttribute() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ClassHasStaticAttributeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertClassHasStaticAttribute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">stdClass</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ClassHasStaticAttributeTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ClassHasStaticAttributeTest::testFailure
Failed asserting that class <span class="s2">&quot;stdClass&quot;</span> has static attribute <span class="s2">&quot;foo&quot;</span>.

/home/sb/ClassHasStaticAttributeTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertcontains">
<span id="appendixes-assertions-assertcontains"></span><h2>assertContains()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertContains(mixed</span> <span class="pre">$needle,</span> <span class="pre">Iterator|array</span> <span class="pre">$haystack[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$needle</span></code> 不是 <code class="docutils literal notranslate"><span class="pre">$haystack</span></code> 的元素时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotContains()</span></code> 是与之相反的断言，接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeContains()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotContains()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性为搜索范围。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertcontains-example">
<div class="code-block-caption"><span class="caption-text">assertContains() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ContainsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ContainsTest::testFailure
Failed asserting that an array contains <span class="m">4</span>.

/home/sb/ContainsTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assertContains(string</span> <span class="pre">$needle,</span> <span class="pre">string</span> <span class="pre">$haystack[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">'',</span> <span class="pre">boolean</span> <span class="pre">$ignoreCase</span> <span class="pre">=</span> <span class="pre">false])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$needle</span></code> 不是 <code class="docutils literal notranslate"><span class="pre">$haystack</span></code> 的子字符串时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">$ignoreCase</span></code> 为 <code class="docutils literal notranslate"><span class="pre">true</span></code>，测试将按大小写不敏感的方式进行。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertcontains-example2">
<div class="code-block-caption"><span class="caption-text">assertContains() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ContainsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ContainsTest::testFailure
Failed asserting that <span class="s1">&#39;foobar&#39;</span> contains <span class="s2">&quot;baz&quot;</span>.

/home/sb/ContainsTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertcontains-example3">
<div class="code-block-caption"><span class="caption-text">带有 $ignoreCase 参数的 assertContains() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooBar&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testOK</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;FooBar&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ContainsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F.

Time: <span class="m">0</span> seconds, Memory: <span class="m">2</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ContainsTest::testFailure
Failed asserting that <span class="s1">&#39;FooBar&#39;</span> contains <span class="s2">&quot;foo&quot;</span>.

/home/sb/ContainsTest.php:6

FAILURES!
Tests: <span class="m">2</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertcontainsonly">
<span id="appendixes-assertions-assertcontainsonly"></span><h2>assertContainsOnly()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertContainsOnly(string</span> <span class="pre">$type,</span> <span class="pre">Iterator|array</span> <span class="pre">$haystack[,</span> <span class="pre">boolean</span> <span class="pre">$isNativeType</span> <span class="pre">=</span> <span class="pre">null,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$haystack</span></code> 并非仅包含类型为 <code class="docutils literal notranslate"><span class="pre">$type</span></code> 的变量时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">$isNativeType</span></code> 是一个标志，用来表明 <code class="docutils literal notranslate"><span class="pre">$type</span></code> 是否是原生 PHP 类型。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotContainsOnly()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeContainsOnly()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotContainsOnly()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性为搜索范围。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertcontainsonly-example">
<div class="code-block-caption"><span class="caption-text">assertContainsOnly() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainsOnlyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContainsOnly</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ContainsOnlyTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ContainsOnlyTest::testFailure
Failed asserting that Array <span class="o">(</span>
    <span class="nv">0</span> <span class="o">=</span>&gt; <span class="s1">&#39;1&#39;</span>
    <span class="nv">1</span> <span class="o">=</span>&gt; <span class="s1">&#39;2&#39;</span>
    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="m">3</span>
<span class="o">)</span> contains only values of <span class="nb">type</span> <span class="s2">&quot;string&quot;</span>.

/home/sb/ContainsOnlyTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertcontainsonlyinstancesof">
<span id="appendixes-assertions-assertcontainsonlyinstancesof"></span><h2>assertContainsOnlyInstancesOf()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertContainsOnlyInstancesOf(string</span> <span class="pre">$classname,</span> <span class="pre">Traversable|array</span> <span class="pre">$haystack[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$haystack</span></code> 并非仅包含类 <code class="docutils literal notranslate"><span class="pre">$classname</span></code> 的实例时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertcontainsonlyinstancesof-example">
<div class="code-block-caption"><span class="caption-text">assertContainsOnlyInstancesOf() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainsOnlyInstancesOfTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContainsOnlyInstancesOf</span><span class="p">(</span>
            <span class="nx">Foo</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="p">[</span><span class="k">new</span> <span class="nx">Foo</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ContainsOnlyInstancesOfTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ContainsOnlyInstancesOfTest::testFailure
Failed asserting that Array <span class="o">([</span><span class="m">0</span><span class="o">]=</span>&gt; Bar Object<span class="o">(</span>...<span class="o">))</span> is an instance of class <span class="s2">&quot;Foo&quot;</span>.

/home/sb/ContainsOnlyInstancesOfTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertcount">
<span id="appendixes-assertions-assertcount"></span><h2>assertCount()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertCount($expectedCount,</span> <span class="pre">$haystack[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$haystack</span></code> 中的元素数量不是 <code class="docutils literal notranslate"><span class="pre">$expectedCount</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotCount()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertcount-example">
<div class="code-block-caption"><span class="caption-text">assertCount() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CountTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit CountTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> CountTest::testFailure
Failed asserting that actual size <span class="m">1</span> matches expected size <span class="m">0</span>.

/home/sb/CountTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertdirectoryexists">
<span id="appendixes-assertions-assertdirectoryexists"></span><h2>assertDirectoryExists()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertDirectoryExists(string</span> <span class="pre">$directory[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$directory</span></code> 所指定的目录不存在时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertDirectoryNotExists()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertdirectoryexists-example">
<div class="code-block-caption"><span class="caption-text">assertDirectoryExists() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DirectoryExistsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDirectoryExists</span><span class="p">(</span><span class="s1">&#39;/path/to/directory&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit DirectoryExistsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DirectoryExistsTest::testFailure
Failed asserting that directory <span class="s2">&quot;/path/to/directory&quot;</span> exists.

/home/sb/DirectoryExistsTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertdirectoryisreadable">
<span id="appendixes-assertions-assertdirectoryisreadable"></span><h2>assertDirectoryIsReadable()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertDirectoryIsReadable(string</span> <span class="pre">$directory[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$directory</span></code> 所指定的目录不是个目录或不可读时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertDirectoryNotIsReadable()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertdirectoryisreadable-example">
<div class="code-block-caption"><span class="caption-text">assertDirectoryIsReadable() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DirectoryIsReadableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDirectoryIsReadable</span><span class="p">(</span><span class="s1">&#39;/path/to/directory&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit DirectoryIsReadableTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DirectoryIsReadableTest::testFailure
Failed asserting that <span class="s2">&quot;/path/to/directory&quot;</span> is readable.

/home/sb/DirectoryIsReadableTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertdirectoryiswritable">
<span id="appendixes-assertions-assertdirectoryiswritable"></span><h2>assertDirectoryIsWritable()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertDirectoryIsWritable(string</span> <span class="pre">$directory[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$directory</span></code> 所指定的目录不是个目录或不可写时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertDirectoryNotIsWritable()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertdirectoryiswritable-example">
<div class="code-block-caption"><span class="caption-text">assertDirectoryIsWritable() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DirectoryIsWritableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDirectoryIsWritable</span><span class="p">(</span><span class="s1">&#39;/path/to/directory&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit DirectoryIsWritableTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> DirectoryIsWritableTest::testFailure
Failed asserting that <span class="s2">&quot;/path/to/directory&quot;</span> is writable.

/home/sb/DirectoryIsWritableTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertempty">
<span id="appendixes-assertions-assertempty"></span><h2>assertEmpty()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertEmpty(mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 非空时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotEmpty()</span></code> 是与之相反的断言，接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeEmpty()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotEmpty()</span></code> 是便捷包装(convenience wrapper)，可以应用于某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertempty-example">
<div class="code-block-caption"><span class="caption-text">assertEmpty() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EmptyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEmpty</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EmptyTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> EmptyTest::testFailure
Failed asserting that an array is empty.

/home/sb/EmptyTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertequalxmlstructure">
<span id="appendixes-assertions-assertequalxmlstructure"></span><h2>assertEqualXMLStructure()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertEqualXMLStructure(DOMElement</span> <span class="pre">$expectedElement,</span> <span class="pre">DOMElement</span> <span class="pre">$actualElement[,</span> <span class="pre">boolean</span> <span class="pre">$checkAttributes</span> <span class="pre">=</span> <span class="pre">false,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualElement</span></code> 中 DOMElement 的 XML 结构与 <code class="docutils literal notranslate"><span class="pre">$expectedElement</span></code> 中 DOMElement的 XML 结构不相同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertequalxmlstructure-example">
<div class="code-block-caption"><span class="caption-text">assertEqualXMLStructure() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EqualXMLStructureTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailureWithDifferentNodeNames</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMElement</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMElement</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEqualXMLStructure</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailureWithDifferentNodeAttributes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo bar=&quot;true&quot; /&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$actual</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo/&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEqualXMLStructure</span><span class="p">(</span>
          <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">firstChild</span><span class="p">,</span> <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">firstChild</span><span class="p">,</span> <span class="k">true</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailureWithDifferentChildrenCount</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$actual</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo&gt;&lt;bar/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEqualXMLStructure</span><span class="p">(</span>
          <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">firstChild</span><span class="p">,</span> <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">firstChild</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailureWithDifferentChildren</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;bar/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$actual</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo&gt;&lt;baz/&gt;&lt;baz/&gt;&lt;baz/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEqualXMLStructure</span><span class="p">(</span>
          <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">firstChild</span><span class="p">,</span> <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">firstChild</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EqualXMLStructureTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

FFFF

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.75Mb

There were <span class="m">4</span> failures:

<span class="m">1</span><span class="o">)</span> EqualXMLStructureTest::testFailureWithDifferentNodeNames
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-<span class="s1">&#39;foo&#39;</span>
+<span class="s1">&#39;bar&#39;</span>

/home/sb/EqualXMLStructureTest.php:9

<span class="m">2</span><span class="o">)</span> EqualXMLStructureTest::testFailureWithDifferentNodeAttributes
Number of attributes on node <span class="s2">&quot;foo&quot;</span> does not match
Failed asserting that <span class="m">0</span> matches expected <span class="m">1</span>.

/home/sb/EqualXMLStructureTest.php:22

<span class="m">3</span><span class="o">)</span> EqualXMLStructureTest::testFailureWithDifferentChildrenCount
Number of child nodes of <span class="s2">&quot;foo&quot;</span> differs
Failed asserting that <span class="m">1</span> matches expected <span class="m">3</span>.

/home/sb/EqualXMLStructureTest.php:35

<span class="m">4</span><span class="o">)</span> EqualXMLStructureTest::testFailureWithDifferentChildren
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-<span class="s1">&#39;bar&#39;</span>
+<span class="s1">&#39;baz&#39;</span>

/home/sb/EqualXMLStructureTest.php:48

FAILURES!
Tests: <span class="m">4</span>, Assertions: <span class="m">8</span>, Failures: <span class="m">4</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertequals">
<span id="appendixes-assertions-assertequals"></span><h2>assertEquals()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertEquals(mixed</span> <span class="pre">$expected,</span> <span class="pre">mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当两个变量 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 不相等时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotEquals()</span></code> 是与之相反的断言，接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeEquals()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotEquals()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性作为实际值来进行比较。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertequals-example">
<div class="code-block-caption"><span class="caption-text">assertEquals() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EqualsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure2</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure3</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s2">&quot;foo</span><span class="se">\n</span><span class="s2">bar</span><span class="se">\n</span><span class="s2">baz</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;foo</span><span class="se">\n</span><span class="s2">bah</span><span class="se">\n</span><span class="s2">baz</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EqualsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

FFF

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There were <span class="m">3</span> failures:

<span class="m">1</span><span class="o">)</span> EqualsTest::testFailure
Failed asserting that <span class="m">0</span> matches expected <span class="m">1</span>.

/home/sb/EqualsTest.php:6

<span class="m">2</span><span class="o">)</span> EqualsTest::testFailure2
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-<span class="s1">&#39;bar&#39;</span>
+<span class="s1">&#39;baz&#39;</span>

/home/sb/EqualsTest.php:11

<span class="m">3</span><span class="o">)</span> EqualsTest::testFailure3
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
 <span class="s1">&#39;foo</span>
<span class="s1">-bar</span>
<span class="s1">+bah</span>
<span class="s1"> baz</span>
<span class="s1"> &#39;</span>

/home/sb/EqualsTest.php:16

FAILURES!
Tests: <span class="m">3</span>, Assertions: <span class="m">3</span>, Failures: <span class="m">3</span>.
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 是某些特定的类型，将使用更加专门的比较方式，参阅下文。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertEquals(float</span> <span class="pre">$expected,</span> <span class="pre">float</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">'',</span> <span class="pre">float</span> <span class="pre">$delta</span> <span class="pre">=</span> <span class="pre">0])</span></code></p>
<p>当两个浮点数 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 之间的差值（的绝对值）大于 <code class="docutils literal notranslate"><span class="pre">$delta</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p>关于为什么 <code class="docutils literal notranslate"><span class="pre">$delta</span></code> 参数是必须的，请阅读《<a class="reference external" href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">关于浮点运算，每一位计算机科学从业人员都应该知道的事实</a>》。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertequals-example2">
<div class="code-block-caption"><span class="caption-text">将assertEquals()用于浮点数时的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EqualsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSuccess</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EqualsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

.F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> EqualsTest::testFailure
Failed asserting that <span class="m">1</span>.1 matches expected <span class="m">1</span>.0.

/home/sb/EqualsTest.php:11

FAILURES!
Tests: <span class="m">2</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assertEquals(DOMDocument</span> <span class="pre">$expected,</span> <span class="pre">DOMDocument</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 这两个 DOMDocument 对象所表示的 XML 文档对应的无注释规范形式不相同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertequals-example3">
<div class="code-block-caption"><span class="caption-text">assertEquals()应用于 DOMDocument 对象时的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EqualsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;foo&gt;&lt;bar/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$actual</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">;</span>
        <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="s1">&#39;&lt;bar&gt;&lt;foo/&gt;&lt;/bar&gt;&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EqualsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> EqualsTest::testFailure
Failed asserting that two DOM documents are equal.
--- Expected
+++ Actual
@@ @@
 &lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>?&gt;
-&lt;foo&gt;
-  &lt;bar/&gt;
-&lt;/foo&gt;
+&lt;bar&gt;
+  &lt;foo/&gt;
+&lt;/bar&gt;

/home/sb/EqualsTest.php:12

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assertEquals(object</span> <span class="pre">$expected,</span> <span class="pre">object</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 这两个对象的属性值不相等时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertequals-example4">
<div class="code-block-caption"><span class="caption-text">assertEquals()应用于对象时的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EqualsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
        <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">foo</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
        <span class="nv">$expected</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>

        <span class="nv">$actual</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
        <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
        <span class="nv">$actual</span><span class="o">-&gt;</span><span class="na">baz</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EqualsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> EqualsTest::testFailure
Failed asserting that two objects are equal.
--- Expected
+++ Actual
@@ @@
 stdClass Object <span class="o">(</span>
-    <span class="s1">&#39;foo&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;foo&#39;</span>
-    <span class="s1">&#39;bar&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;bar&#39;</span>
+    <span class="s1">&#39;foo&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;bar&#39;</span>
+    <span class="s1">&#39;baz&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;bar&#39;</span>
 <span class="o">)</span>

/home/sb/EqualsTest.php:14

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assertEquals(array</span> <span class="pre">$expected,</span> <span class="pre">array</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 这两个数组不相等时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertequals-example5">
<div class="code-block-caption"><span class="caption-text">assertEquals() 应用于数组时的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EqualsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit EqualsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> EqualsTest::testFailure
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array <span class="o">(</span>
     <span class="nv">0</span> <span class="o">=</span>&gt; <span class="s1">&#39;a&#39;</span>
-    <span class="nv">1</span> <span class="o">=</span>&gt; <span class="s1">&#39;b&#39;</span>
-    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="s1">&#39;c&#39;</span>
+    <span class="nv">1</span> <span class="o">=</span>&gt; <span class="s1">&#39;c&#39;</span>
+    <span class="nv">2</span> <span class="o">=</span>&gt; <span class="s1">&#39;d&#39;</span>
 <span class="o">)</span>

/home/sb/EqualsTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertfalse">
<span id="appendixes-assertions-assertfalse"></span><h2>assertFalse()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertFalse(bool</span> <span class="pre">$condition[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$condition</span></code> 为 <code class="docutils literal notranslate"><span class="pre">true</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotFalse()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertfalse-example">
<div class="code-block-caption"><span class="caption-text">assertFalse() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FalseTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit FalseTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> FalseTest::testFailure
Failed asserting that <span class="nb">true</span> is false.

/home/sb/FalseTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertfileequals">
<span id="appendixes-assertions-assertfileequals"></span><h2>assertFileEquals()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertFileEquals(string</span> <span class="pre">$expected,</span> <span class="pre">string</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 所指定的文件与 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 所指定的文件内容不同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertFileNotEquals()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertfileequals-example">
<div class="code-block-caption"><span class="caption-text">assertFileEquals() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileEqualsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFileEquals</span><span class="p">(</span><span class="s1">&#39;/home/sb/expected&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/sb/actual&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit FileEqualsTest
PHPUnit 7.0.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) FileEqualsTest::testFailure
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-&#39;expected
+&#39;actual
 &#39;

/home/sb/FileEqualsTest.php:6

FAILURES!
Tests: 1, Assertions: 3, Failures: 1.
</pre></div>
</div>
</div>
<div class="section" id="assertfileexists">
<span id="appendixes-assertions-assertfileexists"></span><h2>assertFileExists()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertFileExists(string</span> <span class="pre">$filename[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$filename</span></code> 所指定的文件不存在时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertFileNotExists()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertfileexists-example">
<div class="code-block-caption"><span class="caption-text">assertFileExists() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileExistsTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFileExists</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit FileExistsTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> FileExistsTest::testFailure
Failed asserting that file <span class="s2">&quot;/path/to/file&quot;</span> exists.

/home/sb/FileExistsTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertfileisreadable">
<span id="appendixes-assertions-assertfileisreadable"></span><h2>assertFileIsReadable()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertFileIsReadable(string</span> <span class="pre">$filename[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$filename</span></code> 所指定的文件不是个文件或不可读时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertFileNotIsReadable()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertfileisreadable-example">
<div class="code-block-caption"><span class="caption-text">assertFileIsReadable() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileIsReadableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFileIsReadable</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit FileIsReadableTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> FileIsReadableTest::testFailure
Failed asserting that <span class="s2">&quot;/path/to/file&quot;</span> is readable.

/home/sb/FileIsReadableTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertfileiswritable">
<span id="appendixes-assertions-assertfileiswritable"></span><h2>assertFileIsWritable()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertFileIsWritable(string</span> <span class="pre">$filename[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$filename</span></code> 所指定的文件不是个文件或不可写时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertFileNotIsWritable()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertfileiswritable-example">
<div class="code-block-caption"><span class="caption-text">assertFileIsWritable() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">FileIsWritableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFileIsWritable</span><span class="p">(</span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit FileIsWritableTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> FileIsWritableTest::testFailure
Failed asserting that <span class="s2">&quot;/path/to/file&quot;</span> is writable.

/home/sb/FileIsWritableTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertgreaterthan">
<span id="appendixes-assertions-assertgreaterthan"></span><h2>assertGreaterThan()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertGreaterThan(mixed</span> <span class="pre">$expected,</span> <span class="pre">mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 的值不大于 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 的值时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeGreaterThan()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性作为实际值来进行比较。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertgreaterthan-example">
<div class="code-block-caption"><span class="caption-text">assertGreaterThan() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GreaterThanTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit GreaterThanTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> GreaterThanTest::testFailure
Failed asserting that <span class="m">1</span> is greater than <span class="m">2</span>.

/home/sb/GreaterThanTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertgreaterthanorequal">
<span id="appendixes-assertions-assertgreaterthanorequal"></span><h2>assertGreaterThanOrEqual()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertGreaterThanOrEqual(mixed</span> <span class="pre">$expected,</span> <span class="pre">mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 的值不大于且不等于 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 的值时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeGreaterThanOrEqual()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性作为实际值来进行比较。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertgreaterthanorequal-example">
<div class="code-block-caption"><span class="caption-text">assertGreaterThanOrEqual() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">GreatThanOrEqualTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThanOrEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit GreaterThanOrEqualTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> GreatThanOrEqualTest::testFailure
Failed asserting that <span class="m">1</span> is equal to <span class="m">2</span> or is greater than <span class="m">2</span>.

/home/sb/GreaterThanOrEqualTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertinfinite">
<span id="appendixes-assertions-assertinfinite"></span><h2>assertInfinite()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertInfinite(mixed</span> <span class="pre">$variable[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 不是  <code class="docutils literal notranslate"><span class="pre">INF</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertFinite()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertinfinite-example">
<div class="code-block-caption"><span class="caption-text">assertInfinite() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InfiniteTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInfinite</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit InfiniteTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> InfiniteTest::testFailure
Failed asserting that <span class="m">1</span> is infinite.

/home/sb/InfiniteTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertinstanceof">
<span id="appendixes-assertions-assertinstanceof"></span><h2>assertInstanceOf()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertInstanceOf($expected,</span> <span class="pre">$actual[,</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 不是 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 的实例时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotInstanceOf()</span></code> 是与之相反的断言，接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeInstanceOf()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotInstanceOf()</span></code> 是便捷包装(convenience wrapper)，可以应用于某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertinstanceof-example">
<div class="code-block-caption"><span class="caption-text">assertInstanceOf() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InstanceOfTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">RuntimeException</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit InstanceOfTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> InstanceOfTest::testFailure
Failed asserting that Exception Object <span class="o">(</span>...<span class="o">)</span> is an instance of class <span class="s2">&quot;RuntimeException&quot;</span>.

/home/sb/InstanceOfTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertinternaltype">
<span id="appendixes-assertions-assertinternaltype"></span><h2>assertInternalType()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertInternalType($expected,</span> <span class="pre">$actual[,</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 不是 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 所指明的类型时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotInternalType()</span></code> 是与之相反的断言，接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeInternalType()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotInternalType()</span></code> 是便捷包装(convenience wrapper)，可以应用于某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertinternaltype-example">
<div class="code-block-caption"><span class="caption-text">assertInternalType() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">InternalTypeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInternalType</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit InternalTypeTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> InternalTypeTest::testFailure
Failed asserting that <span class="m">42</span> is of <span class="nb">type</span> <span class="s2">&quot;string&quot;</span>.

/home/sb/InternalTypeTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertisreadable">
<span id="appendixes-assertions-assertisreadable"></span><h2>assertIsReadable()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertIsReadable(string</span> <span class="pre">$filename[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$filename</span></code> 所指定的文件或目录不可读时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotIsReadable()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertisreadable-example">
<div class="code-block-caption"><span class="caption-text">assertIsReadable() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">IsReadableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertIsReadable</span><span class="p">(</span><span class="s1">&#39;/path/to/unreadable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit IsReadableTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> IsReadableTest::testFailure
Failed asserting that <span class="s2">&quot;/path/to/unreadable&quot;</span> is readable.

/home/sb/IsReadableTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertiswritable">
<span id="appendixes-assertions-assertiswritable"></span><h2>assertIsWritable()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertIsWritable(string</span> <span class="pre">$filename[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$filename</span></code> 所指定的文件或目录不可写时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotIsWritable()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertiswritable-example">
<div class="code-block-caption"><span class="caption-text">assertIsWritable() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">IsWritableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertIsWritable</span><span class="p">(</span><span class="s1">&#39;/path/to/unwritable&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit IsWritableTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> IsWritableTest::testFailure
Failed asserting that <span class="s2">&quot;/path/to/unwritable&quot;</span> is writable.

/home/sb/IsWritableTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertjsonfileequalsjsonfile">
<span id="appendixes-assertions-assertjsonfileequalsjsonfile"></span><h2>assertJsonFileEqualsJsonFile()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertJsonFileEqualsJsonFile(mixed</span> <span class="pre">$expectedFile,</span> <span class="pre">mixed</span> <span class="pre">$actualFile[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualFile</span></code> 对应的值与 <code class="docutils literal notranslate"><span class="pre">$expectedFile</span></code> 对应的值不匹配时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertjsonfileequalsjsonfile-example">
<div class="code-block-caption"><span class="caption-text">assertJsonFileEqualsJsonFile() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">JsonFileEqualsJsonFileTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertJsonFileEqualsJsonFile</span><span class="p">(</span>
          <span class="s1">&#39;path/to/fixture/file&#39;</span><span class="p">,</span> <span class="s1">&#39;path/to/actual/file&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit JsonFileEqualsJsonFileTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> JsonFileEqualsJsonFile::testFailure
Failed asserting that <span class="s1">&#39;{&quot;Mascot&quot;:&quot;Tux&quot;}&#39;</span> matches JSON string <span class="s2">&quot;[&quot;</span>Mascott<span class="s2">&quot;, &quot;</span>Tux<span class="s2">&quot;, &quot;</span>OS<span class="s2">&quot;, &quot;</span>Linux<span class="s2">&quot;]&quot;</span>.

/home/sb/JsonFileEqualsJsonFileTest.php:5

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">3</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertjsonstringequalsjsonfile">
<span id="appendixes-assertions-assertjsonstringequalsjsonfile"></span><h2>assertJsonStringEqualsJsonFile()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertJsonStringEqualsJsonFile(mixed</span> <span class="pre">$expectedFile,</span> <span class="pre">mixed</span> <span class="pre">$actualJson[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualJson</span></code> 对应的值与 <code class="docutils literal notranslate"><span class="pre">$expectedFile</span></code> 对应的值不匹配时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertjsonstringequalsjsonfile-example">
<div class="code-block-caption"><span class="caption-text">assertJsonStringEqualsJsonFile() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">JsonStringEqualsJsonFileTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertJsonStringEqualsJsonFile</span><span class="p">(</span>
            <span class="s1">&#39;path/to/fixture/file&#39;</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;Mascot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ux&#39;</span><span class="p">])</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit JsonStringEqualsJsonFileTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> JsonStringEqualsJsonFile::testFailure
Failed asserting that <span class="s1">&#39;{&quot;Mascot&quot;:&quot;ux&quot;}&#39;</span> matches JSON string <span class="s2">&quot;{&quot;</span>Mascott<span class="s2">&quot;:&quot;</span>Tux<span class="s2">&quot;}&quot;</span>.

/home/sb/JsonStringEqualsJsonFileTest.php:5

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">3</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertjsonstringequalsjsonstring">
<span id="appendixes-assertions-assertjsonstringequalsjsonstring"></span><h2>assertJsonStringEqualsJsonString()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertJsonStringEqualsJsonString(mixed</span> <span class="pre">$expectedJson,</span> <span class="pre">mixed</span> <span class="pre">$actualJson[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualJson</span></code> 对应的值与 <code class="docutils literal notranslate"><span class="pre">$expectedJson</span></code> 对应的值不匹配时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertjsonstringequalsjsonstring-example">
<div class="code-block-caption"><span class="caption-text">assertJsonStringEqualsJsonString() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">JsonStringEqualsJsonStringTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertJsonStringEqualsJsonString</span><span class="p">(</span>
            <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;Mascot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Tux&#39;</span><span class="p">]),</span>
            <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;Mascot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ux&#39;</span><span class="p">])</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit JsonStringEqualsJsonStringTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> JsonStringEqualsJsonStringTest::testFailure
Failed asserting that two objects are equal.
--- Expected
+++ Actual
@@ @@
 stdClass Object <span class="o">(</span>
 -    <span class="s1">&#39;Mascot&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;Tux&#39;</span>
 +    <span class="s1">&#39;Mascot&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;ux&#39;</span>
<span class="o">)</span>

/home/sb/JsonStringEqualsJsonStringTest.php:5

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">3</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertlessthan">
<span id="appendixes-assertions-assertlessthan"></span><h2>assertLessThan()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertLessThan(mixed</span> <span class="pre">$expected,</span> <span class="pre">mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 的值不小于 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 的值时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeLessThan()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性作为实际值来进行比较。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertlessthan-example">
<div class="code-block-caption"><span class="caption-text">assertLessThan() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LessThanTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertLessThan</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit LessThanTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> LessThanTest::testFailure
Failed asserting that <span class="m">2</span> is less than <span class="m">1</span>.

/home/sb/LessThanTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertlessthanorequal">
<span id="appendixes-assertions-assertlessthanorequal"></span><h2>assertLessThanOrEqual()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertLessThanOrEqual(mixed</span> <span class="pre">$expected,</span> <span class="pre">mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 的值不小于且不等于 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 的值时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeLessThanOrEqual()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性作为实际值来进行比较。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertlessthanorequal-example">
<div class="code-block-caption"><span class="caption-text">assertLessThanOrEqual() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LessThanOrEqualTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertLessThanOrEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit LessThanOrEqualTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> LessThanOrEqualTest::testFailure
Failed asserting that <span class="m">2</span> is equal to <span class="m">1</span> or is less than <span class="m">1</span>.

/home/sb/LessThanOrEqualTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertnan">
<span id="appendixes-assertions-assertnan"></span><h2>assertNan()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertNan(mixed</span> <span class="pre">$variable[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$variable</span></code> 不是  <code class="docutils literal notranslate"><span class="pre">NAN</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertnan-example">
<div class="code-block-caption"><span class="caption-text">assertNan() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NanTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNan</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit NanTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> NanTest::testFailure
Failed asserting that <span class="m">1</span> is nan.

/home/sb/NanTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertnull">
<span id="appendixes-assertions-assertnull"></span><h2>assertNull()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertNull(mixed</span> <span class="pre">$variable[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 不是  <code class="docutils literal notranslate"><span class="pre">null</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotNull()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertnull-example">
<div class="code-block-caption"><span class="caption-text">assertNull() 的使用</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NullTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNull</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit NotNullTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> NullTest::testFailure
Failed asserting that <span class="s1">&#39;foo&#39;</span> is null.

/home/sb/NotNullTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertobjecthasattribute">
<span id="appendixes-assertions-assertobjecthasattribute"></span><h2>assertObjectHasAttribute()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertObjectHasAttribute(string</span> <span class="pre">$attributeName,</span> <span class="pre">object</span> <span class="pre">$object[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$object-&gt;attributeName</span></code> 不存在时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertObjectNotHasAttribute()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertobjecthasattribute-example">
<div class="code-block-caption"><span class="caption-text">assertObjectHasAttribute() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ObjectHasAttributeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertObjectHasAttribute</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit ObjectHasAttributeTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> ObjectHasAttributeTest::testFailure
Failed asserting that object of class <span class="s2">&quot;stdClass&quot;</span> has attribute <span class="s2">&quot;foo&quot;</span>.

/home/sb/ObjectHasAttributeTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertregexp">
<span id="appendixes-assertions-assertregexp"></span><h2>assertRegExp()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertRegExp(string</span> <span class="pre">$pattern,</span> <span class="pre">string</span> <span class="pre">$string[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$string</span></code> 不匹配于正则表达式 <code class="docutils literal notranslate"><span class="pre">$pattern</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotRegExp()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertregexp-example">
<div class="code-block-caption"><span class="caption-text">assertRegExp() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegExpTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRegExp</span><span class="p">(</span><span class="s1">&#39;/foo/&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit RegExpTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> RegExpTest::testFailure
Failed asserting that <span class="s1">&#39;bar&#39;</span> matches PCRE pattern <span class="s2">&quot;/foo/&quot;</span>.

/home/sb/RegExpTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertstringmatchesformat">
<span id="appendixes-assertions-assertstringmatchesformat"></span><h2>assertStringMatchesFormat()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertStringMatchesFormat(string</span> <span class="pre">$format,</span> <span class="pre">string</span> <span class="pre">$string[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$string</span></code> 不匹配于 <code class="docutils literal notranslate"><span class="pre">$format</span></code> 定义的格式时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertStringNotMatchesFormat()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertstringmatchesformat-example">
<div class="code-block-caption"><span class="caption-text">assertStringMatchesFormat() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringMatchesFormatTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringMatchesFormat</span><span class="p">(</span><span class="s1">&#39;%i&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit StringMatchesFormatTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> StringMatchesFormatTest::testFailure
Failed asserting that <span class="s1">&#39;foo&#39;</span> matches PCRE pattern <span class="s2">&quot;/^[+-]?\d+</span>$<span class="s2">/s&quot;</span>.

/home/sb/StringMatchesFormatTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p>格式定义字符串中可以使用如下占位符：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">%e</span></code>：表示目录分隔符，例如在 Linux 系统中是 <code class="docutils literal notranslate"><span class="pre">/</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">%s</span></code>：一个或多个除了换行符以外的任意字符（非空白字符或者空白字符）。</li>
<li><code class="docutils literal notranslate"><span class="pre">%S</span></code>：零个或多个除了换行符以外的任意字符（非空白字符或者空白字符）。</li>
<li><code class="docutils literal notranslate"><span class="pre">%a</span></code>：一个或多个包括换行符在内的任意字符（非空白字符或者空白字符）。</li>
<li><code class="docutils literal notranslate"><span class="pre">%A</span></code>：零个或多个包括换行符在内的任意字符（非空白字符或者空白字符）。</li>
<li><code class="docutils literal notranslate"><span class="pre">%w</span></code>：零个或多个空白字符。</li>
<li><code class="docutils literal notranslate"><span class="pre">%i</span></code>：带符号整数值，例如 <code class="docutils literal notranslate"><span class="pre">+3142</span></code>、<code class="docutils literal notranslate"><span class="pre">-3142</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">%d</span></code>：无符号整数值，例如 <code class="docutils literal notranslate"><span class="pre">123456</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">%x</span></code>：一个或多个十六进制字符。所谓十六进制字符，指的是在以下范围内的字符：<code class="docutils literal notranslate"><span class="pre">0-9</span></code>、<code class="docutils literal notranslate"><span class="pre">a-f</span></code>、<code class="docutils literal notranslate"><span class="pre">A-F</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">%f</span></code>：浮点数，例如 <code class="docutils literal notranslate"><span class="pre">3.142</span></code>、<code class="docutils literal notranslate"><span class="pre">-3.142</span></code>、<code class="docutils literal notranslate"><span class="pre">3.142E-10</span></code>、<code class="docutils literal notranslate"><span class="pre">3.142e+10</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">%c</span></code>：单个任意字符。</li>
</ul>
</div>
<div class="section" id="assertstringmatchesformatfile">
<span id="appendixes-assertions-assertstringmatchesformatfile"></span><h2>assertStringMatchesFormatFile()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertStringMatchesFormatFile(string</span> <span class="pre">$formatFile,</span> <span class="pre">string</span> <span class="pre">$string[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$string</span></code> 不匹配于 <code class="docutils literal notranslate"><span class="pre">$formatFile</span></code> 的内容所定义的格式时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertStringNotMatchesFormatFile()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertstringmatchesformatfile-example">
<div class="code-block-caption"><span class="caption-text">assertStringMatchesFormatFile() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringMatchesFormatFileTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringMatchesFormatFile</span><span class="p">(</span><span class="s1">&#39;/path/to/expected.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit StringMatchesFormatFileTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> StringMatchesFormatFileTest::testFailure
Failed asserting that <span class="s1">&#39;foo&#39;</span> matches PCRE pattern <span class="s2">&quot;/^[+-]?\d+</span>
$<span class="s2">/s&quot;</span>.

/home/sb/StringMatchesFormatFileTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertsame">
<span id="appendixes-assertions-assertsame"></span><h2>assertSame()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertSame(mixed</span> <span class="pre">$expected,</span> <span class="pre">mixed</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当两个变量 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 的值与类型不完全相同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotSame()</span></code> 是与之相反的断言，接受相同的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertAttributeSame()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertAttributeNotSame()</span></code> 是便捷包装(convenience wrapper)，以某个类或对象的某个 <code class="docutils literal notranslate"><span class="pre">public</span></code>、<code class="docutils literal notranslate"><span class="pre">protected</span></code> 或 <code class="docutils literal notranslate"><span class="pre">private</span></code> 属性作为实际值来进行比较。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertsame-example">
<div class="code-block-caption"><span class="caption-text">assertSame() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SameTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;2204&#39;</span><span class="p">,</span> <span class="mi">2204</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit SameTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> SameTest::testFailure
Failed asserting that <span class="m">2204</span> is identical to <span class="s1">&#39;2204&#39;</span>.

/home/sb/SameTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">assertSame(object</span> <span class="pre">$expected,</span> <span class="pre">object</span> <span class="pre">$actual[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当两个变量 <code class="docutils literal notranslate"><span class="pre">$expected</span></code> 和 <code class="docutils literal notranslate"><span class="pre">$actual</span></code> 不是指向同一个对象的引用时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertsame-example2">
<div class="code-block-caption"><span class="caption-text">assertSame() 应用于对象时的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SameTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="k">new</span> <span class="k">stdClass</span><span class="p">,</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit SameTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">4</span>.75Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> SameTest::testFailure
Failed asserting that two variables reference the same object.

/home/sb/SameTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertstringendswith">
<span id="appendixes-assertions-assertstringendswith"></span><h2>assertStringEndsWith()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertStringEndsWith(string</span> <span class="pre">$suffix,</span> <span class="pre">string</span> <span class="pre">$string[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$string</span></code> 不以 <code class="docutils literal notranslate"><span class="pre">$suffix</span></code> 结尾时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertStringEndsNotWith()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertstringendswith-example">
<div class="code-block-caption"><span class="caption-text">assertStringEndsWith() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringEndsWithTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringEndsWith</span><span class="p">(</span><span class="s1">&#39;suffix&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit StringEndsWithTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">1</span> second, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> StringEndsWithTest::testFailure
Failed asserting that <span class="s1">&#39;foo&#39;</span> ends with <span class="s2">&quot;suffix&quot;</span>.

/home/sb/StringEndsWithTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertstringequalsfile">
<span id="appendixes-assertions-assertstringequalsfile"></span><h2>assertStringEqualsFile()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertStringEqualsFile(string</span> <span class="pre">$expectedFile,</span> <span class="pre">string</span> <span class="pre">$actualString[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$expectedFile</span></code> 所指定的文件其内容不是 <code class="docutils literal notranslate"><span class="pre">$actualString</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertStringNotEqualsFile()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertstringequalsfile-example">
<div class="code-block-caption"><span class="caption-text">assertStringEqualsFile() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringEqualsFileTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringEqualsFile</span><span class="p">(</span><span class="s1">&#39;/home/sb/expected&#39;</span><span class="p">,</span> <span class="s1">&#39;actual&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit StringEqualsFileTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> StringEqualsFileTest::testFailure
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-<span class="s1">&#39;expected</span>
<span class="s1">-&#39;</span>
+<span class="s1">&#39;actual&#39;</span>

/home/sb/StringEqualsFileTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertstringstartswith">
<span id="appendixes-assertions-assertstringstartswith"></span><h2>assertStringStartsWith()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertStringStartsWith(string</span> <span class="pre">$prefix,</span> <span class="pre">string</span> <span class="pre">$string[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$string</span></code> 不以 <code class="docutils literal notranslate"><span class="pre">$prefix</span></code> 开头时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertStringStartsNotWith()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertstringstartswith-example">
<div class="code-block-caption"><span class="caption-text">assertStringStartsWith() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StringStartsWithTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertStringStartsWith</span><span class="p">(</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit StringStartsWithTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> StringStartsWithTest::testFailure
Failed asserting that <span class="s1">&#39;foo&#39;</span> starts with <span class="s2">&quot;prefix&quot;</span>.

/home/sb/StringStartsWithTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertthat">
<span id="appendixes-assertions-assertthat"></span><h2>assertThat()</h2>
<p>可以用 <code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint</span></code> 类来订立更加复杂的断言。随后可以用 <code class="docutils literal notranslate"><span class="pre">assertThat()</span></code> 方法来评定这些断言。<a class="reference internal" href="#appendixes-assertions-assertthat-example"><span class="std std-numref">Example 43.1</span></a> 展示了如何用 <code class="docutils literal notranslate"><span class="pre">logicalNot()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">equalTo()</span></code> 约束条件来表达与 <code class="docutils literal notranslate"><span class="pre">assertNotEquals()</span></code> 等价的断言。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertThat(mixed</span> <span class="pre">$value,</span> <span class="pre">PHPUnit_Framework_Constraint</span> <span class="pre">$constraint[,</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$value</span></code> 不符合约束条件 <code class="docutils literal notranslate"><span class="pre">$constraint</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertthat-example">
<div class="code-block-caption"><span class="caption-text">assertThat() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BiscuitTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEquals</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$theBiscuit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Biscuit</span><span class="p">(</span><span class="s1">&#39;Ginger&#39;</span><span class="p">);</span>
        <span class="nv">$myBiscuit</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Biscuit</span><span class="p">(</span><span class="s1">&#39;Ginger&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertThat</span><span class="p">(</span>
          <span class="nv">$theBiscuit</span><span class="p">,</span>
          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logicalNot</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">equalTo</span><span class="p">(</span><span class="nv">$myBiscuit</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">appendixes.assertions.assertThat.tables.constraints`列举了所有可用的</span> <span class="pre">``PHPUnit_Framework_Constraint`</span></code> 类。</p>
<table border="1" class="table docutils" id="appendixes-assertions-assertthat-tables-constraints">
<caption><span class="caption-text">约束条件</span></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">约束条件</th>
<th class="head">含义</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_Attribute</span> <span class="pre">attribute(PHPUnit_Framework_Constraint</span> <span class="pre">$constraint,</span> <span class="pre">$attributeName)</span></code></td>
<td>此约束将另外一个约束应用于某个类或对象的某个属性。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsAnything</span> <span class="pre">anything()</span></code></td>
<td>此约束接受任意输入值。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_ArrayHasKey</span> <span class="pre">arrayHasKey(mixed</span> <span class="pre">$key)</span></code></td>
<td>此约束断言所评定的数组拥有指定键名。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_TraversableContains</span> <span class="pre">contains(mixed</span> <span class="pre">$value)</span></code></td>
<td>此约束断言所评定的 <code class="docutils literal notranslate"><span class="pre">array</span></code> 或实现了 <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> 接口的对象包含有给定值。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_TraversableContainsOnly</span> <span class="pre">containsOnly(string</span> <span class="pre">$type)</span></code></td>
<td>此约束断言所评定的 <code class="docutils literal notranslate"><span class="pre">array</span></code> 或实现了 <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> 接口的对象仅包含给定类型的值。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_TraversableContainsOnly</span> <span class="pre">containsOnlyInstancesOf(string</span> <span class="pre">$classname)</span></code></td>
<td>此约束断言所评定的 <code class="docutils literal notranslate"><span class="pre">array</span></code> 或实现了 <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> 接口的对象仅包含给定类名的类的实例。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsEqual</span> <span class="pre">equalTo($value,</span> <span class="pre">$delta</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">$maxDepth</span> <span class="pre">=</span> <span class="pre">10)</span></code></td>
<td>此约束检验一个值是否等于另外一个。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_Attribute</span> <span class="pre">attributeEqualTo($attributeName,</span> <span class="pre">$value,</span> <span class="pre">$delta</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">$maxDepth</span> <span class="pre">=</span> <span class="pre">10)</span></code></td>
<td>此约束检验一个值是否等于某个类或对象的某个属性。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_DirectoryExists</span> <span class="pre">directoryExists()</span></code></td>
<td>此约束检验所评定的目录是否存在。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_FileExists</span> <span class="pre">fileExists()</span></code></td>
<td>此约束检验所评定的文件名对应的文件是否存在。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsReadable</span> <span class="pre">isReadable()</span></code></td>
<td>此约束检验所评定的文件名对应的文件是否可读。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsWritable</span> <span class="pre">isWritable()</span></code></td>
<td>此约束检验所评定的文件名对应的文件是否可写。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_GreaterThan</span> <span class="pre">greaterThan(mixed</span> <span class="pre">$value)</span></code></td>
<td>此约束断言所评定的值大于给定值。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_Or</span> <span class="pre">greaterThanOrEqual(mixed</span> <span class="pre">$value)</span></code></td>
<td>此约束断言所评定的值大于或等于给定值。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_ClassHasAttribute</span> <span class="pre">classHasAttribute(string</span> <span class="pre">$attributeName)</span></code></td>
<td>此约束断言所评定的类具有给定属性。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_ClassHasStaticAttribute</span> <span class="pre">classHasStaticAttribute(string</span> <span class="pre">$attributeName)</span></code></td>
<td>此约束断言所评定的类具有给定静态属性。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_ObjectHasAttribute</span> <span class="pre">hasAttribute(string</span> <span class="pre">$attributeName)</span></code></td>
<td>此约束断言所评定的对象具有给定属性。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsIdentical</span> <span class="pre">identicalTo(mixed</span> <span class="pre">$value)</span></code></td>
<td>此约束断言所评定的值与另外一个值全等。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsFalse</span> <span class="pre">isFalse()</span></code></td>
<td>此约束断言所评定的值为 <code class="docutils literal notranslate"><span class="pre">false</span></code>。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsInstanceOf</span> <span class="pre">isInstanceOf(string</span> <span class="pre">$className)</span></code></td>
<td>此约束断言所评定的对象是给定类的实例。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsNull</span> <span class="pre">isNull()</span></code></td>
<td>此约束断言所评定的值为 <code class="docutils literal notranslate"><span class="pre">null</span></code>。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsTrue</span> <span class="pre">isTrue()</span></code></td>
<td>此约束断言所评定的值为 <code class="docutils literal notranslate"><span class="pre">true</span></code>。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_IsType</span> <span class="pre">isType(string</span> <span class="pre">$type)</span></code></td>
<td>此约束断言所评定的值是指定类型的。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_LessThan</span> <span class="pre">lessThan(mixed</span> <span class="pre">$value)</span></code></td>
<td>此约束断言所评定的值小于给定值。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_Or</span> <span class="pre">lessThanOrEqual(mixed</span> <span class="pre">$value)</span></code></td>
<td>此约束断言所评定的值小于或等于给定值。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">logicalAnd()</span></code></td>
<td>逻辑与(AND)。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">logicalNot(PHPUnit_Framework_Constraint</span> <span class="pre">$constraint)</span></code></td>
<td>逻辑非(NOT)。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">logicalOr()</span></code></td>
<td>逻辑或(OR)。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">logicalXor()</span></code></td>
<td>逻辑异或(XOR)。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_PCREMatch</span> <span class="pre">matchesRegularExpression(string</span> <span class="pre">$pattern)</span></code></td>
<td>此约束断言所评定的字符串匹配于正则表达式。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_StringContains</span> <span class="pre">stringContains(string</span> <span class="pre">$string,</span> <span class="pre">bool</span> <span class="pre">$case)</span></code></td>
<td>此约束断言所评定的字符串包含指定字符串。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_StringEndsWith</span> <span class="pre">stringEndsWith(string</span> <span class="pre">$suffix)</span></code></td>
<td>此约束断言所评定的字符串以给定后缀结尾。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PHPUnit_Framework_Constraint_StringStartsWith</span> <span class="pre">stringStartsWith(string</span> <span class="pre">$prefix)</span></code></td>
<td>此约束断言所评定的字符串以给定前缀开头。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="asserttrue">
<span id="appendixes-assertions-asserttrue"></span><h2>assertTrue()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertTrue(bool</span> <span class="pre">$condition[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$condition</span></code> 为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertNotTrue()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-asserttrue-example">
<div class="code-block-caption"><span class="caption-text">assertTrue() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TrueTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit TrueTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> TrueTest::testFailure
Failed asserting that <span class="nb">false</span> is true.

/home/sb/TrueTest.php:6

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertxmlfileequalsxmlfile">
<span id="appendixes-assertions-assertxmlfileequalsxmlfile"></span><h2>assertXmlFileEqualsXmlFile()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertXmlFileEqualsXmlFile(string</span> <span class="pre">$expectedFile,</span> <span class="pre">string</span> <span class="pre">$actualFile[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualFile</span></code> 对应的 XML 文档与 <code class="docutils literal notranslate"><span class="pre">$expectedFile</span></code> 对应的 XML 文档不相同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertXmlFileNotEqualsXmlFile()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertxmlfileequalsxmlfile-example">
<div class="code-block-caption"><span class="caption-text">assertXmlFileEqualsXmlFile() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">XmlFileEqualsXmlFileTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertXmlFileEqualsXmlFile</span><span class="p">(</span>
          <span class="s1">&#39;/home/sb/expected.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/sb/actual.xml&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit XmlFileEqualsXmlFileTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> XmlFileEqualsXmlFileTest::testFailure
Failed asserting that two DOM documents are equal.
--- Expected
+++ Actual
@@ @@
 &lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>?&gt;
 &lt;foo&gt;
-  &lt;bar/&gt;
+  &lt;baz/&gt;
 &lt;/foo&gt;

/home/sb/XmlFileEqualsXmlFileTest.php:7

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">3</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertxmlstringequalsxmlfile">
<span id="appendixes-assertions-assertxmlstringequalsxmlfile"></span><h2>assertXmlStringEqualsXmlFile()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertXmlStringEqualsXmlFile(string</span> <span class="pre">$expectedFile,</span> <span class="pre">string</span> <span class="pre">$actualXml[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualXml</span></code> 对应的 XML 文档与 <code class="docutils literal notranslate"><span class="pre">$expectedFile</span></code> 对应的 XML 文档不相同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertXmlStringNotEqualsXmlFile()</span></code> 是与之相反的断言，并接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertxmlstringequalsxmlfile-example">
<div class="code-block-caption"><span class="caption-text">assertXmlStringEqualsXmlFile() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">XmlStringEqualsXmlFileTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertXmlStringEqualsXmlFile</span><span class="p">(</span>
          <span class="s1">&#39;/home/sb/expected.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;foo&gt;&lt;baz/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit XmlStringEqualsXmlFileTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.25Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> XmlStringEqualsXmlFileTest::testFailure
Failed asserting that two DOM documents are equal.
--- Expected
+++ Actual
@@ @@
 &lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>?&gt;
 &lt;foo&gt;
-  &lt;bar/&gt;
+  &lt;baz/&gt;
 &lt;/foo&gt;

/home/sb/XmlStringEqualsXmlFileTest.php:7

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">2</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<div class="section" id="assertxmlstringequalsxmlstring">
<span id="appendixes-assertions-assertxmlstringequalsxmlstring"></span><h2>assertXmlStringEqualsXmlString()</h2>
<p><code class="docutils literal notranslate"><span class="pre">assertXmlStringEqualsXmlString(string</span> <span class="pre">$expectedXml,</span> <span class="pre">string</span> <span class="pre">$actualXml[,</span> <span class="pre">string</span> <span class="pre">$message</span> <span class="pre">=</span> <span class="pre">''])</span></code></p>
<p>当 <code class="docutils literal notranslate"><span class="pre">$actualXml</span></code> 对应的 XML 文档与 <code class="docutils literal notranslate"><span class="pre">$expectedXml</span></code> 对应的 XML 文档不相同时报告错误，错误讯息由 <code class="docutils literal notranslate"><span class="pre">$message</span></code> 指定。</p>
<p><code class="docutils literal notranslate"><span class="pre">assertXmlStringNotEqualsXmlString()</span></code> 是与之相反的断言，接受相同的参数。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-assertions-assertxmlstringequalsxmlstring-example">
<div class="code-block-caption"><span class="caption-text">assertXmlStringEqualsXmlString() 的用法</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">XmlStringEqualsXmlStringTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFailure</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertXmlStringEqualsXmlString</span><span class="p">(</span>
          <span class="s1">&#39;&lt;foo&gt;&lt;bar/&gt;&lt;/foo&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;foo&gt;&lt;baz/&gt;&lt;/foo&gt;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ phpunit XmlStringEqualsXmlStringTest
PHPUnit <span class="m">7</span>.0.0 by Sebastian Bergmann and contributors.

F

Time: <span class="m">0</span> seconds, Memory: <span class="m">5</span>.00Mb

There was <span class="m">1</span> failure:

<span class="m">1</span><span class="o">)</span> XmlStringEqualsXmlStringTest::testFailure
Failed asserting that two DOM documents are equal.
--- Expected
+++ Actual
@@ @@
 &lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>?&gt;
 &lt;foo&gt;
-  &lt;bar/&gt;
+  &lt;baz/&gt;
 &lt;/foo&gt;

/home/sb/XmlStringEqualsXmlStringTest.php:7

FAILURES!
Tests: <span class="m">1</span>, Assertions: <span class="m">1</span>, Failures: <span class="m">1</span>.
</pre></div>
</div>
</div>
<span id="document-annotations"></span><p>==
标注
==</p>
<p>所谓标注，是指某些编程语言中允许加在源代码中的一种特殊格式的语法元数据。PHP 并没有专门的语言特性来支持对源代码进行标注，然而 PHP 社区早已经形成惯例，通过在文档注释块中使用诸如 <code class="docutils literal notranslate"><span class="pre">&#64;annotation</span> <span class="pre">arguments</span></code> 这样的标签来为源代码加上标注。在 PHP 中，文档注释块是可反射的：可以对函数、方法、类以及属性调用相应级别的反射 API <code class="docutils literal notranslate"><span class="pre">getDocComment()</span></code> 方法来获取相应的文档注释块。诸如 PHPUnit 这样的应用程序在运行时用这些信息来配置其行为。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">PHP中的文档注释块必须以 <code class="docutils literal notranslate"><span class="pre">/**</span></code> 开头，以 <code class="docutils literal notranslate"><span class="pre">*/</span></code> 结尾。任何其他形式的注释中出现的标注都将被忽略。</p>
</div>
<p>本附录列出了 PHPUnit 所支持的所有标注种类。</p>
<div class="section" id="author">
<span id="appendixes-annotations-author"></span><h2>&#64;author</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;author</span></code> 标注是 <code class="docutils literal notranslate"><span class="pre">&#64;group</span></code> 标注（参见 <a class="reference internal" href="#appendixes-annotations-group"><span class="std std-ref">&#64;group</span></a>）的别名，允许基于作者对测试进行过滤。</p>
</div>
<div class="section" id="after">
<span id="appendixes-annotations-after"></span><h2>&#64;after</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;after</span></code> 标注用于指明此方法应当在测试用例类中的每个测试方法运行完成之后调用。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @after</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">tearDownSomeFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @after</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">tearDownSomeOtherFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="afterclass">
<span id="appendixes-annotations-afterclass"></span><h2>&#64;afterClass</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;afterClass</span></code> 标注用于指明此静态方法应该于测试类中的所有测试方法都运行完成之后调用，用于清理共享基境。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @afterClass</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">tearDownSomeSharedFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @afterClass</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">tearDownSomeOtherSharedFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="backupglobals">
<span id="appendixes-annotations-backupglobals"></span><h2>&#64;backupGlobals</h2>
<p>全局变量的备份与还原操作可以对某个测试用例类中的所有测试彻底禁用，像这样：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @backupGlobals disabled</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;backupGlobals</span></code> 标注也可以用在测试方法这一级别。这样可以对备份与还原操作进行更细粒度的配置：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @backupGlobals disabled</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @backupGlobals enabled</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThatInteractsWithGlobalVariables</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="backupstaticattributes">
<span id="appendixes-annotations-backupstaticattributes"></span><h2>&#64;backupStaticAttributes</h2>
<p>如果指定了 <code class="docutils literal notranslate"><span class="pre">&#64;backupStaticAttributes</span></code> 标注，那么将在每个测试之前备份所有已声明的类的静态属性的值，并在测试完成之后全部恢复。它可以用在测试用例类或测试方法级别：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @backupStaticAttributes enabled</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @backupStaticAttributes disabled</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testThatInteractsWithStaticAttributes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p>受限于 PHP 的内部实现，在某些情况下即使使用了 <code class="docutils literal notranslate"><span class="pre">&#64;backupStaticAttributes</span></code> 也可能有个别静态值出现意料外的延续，并污染后继测试。</p>
<p class="last">详细信息参见 <a class="reference internal" href="index.html#fixtures-global-state"><span class="std std-ref">全局状态</span></a>。</p>
</div>
</div>
<div class="section" id="before">
<span id="appendixes-annotations-before"></span><h2>&#64;before</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;before</span></code> 标注用于指明此方法应当在测试用例类中的每个测试方法开始运行之前调用。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @before</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setupSomeFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @before</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setupSomeOtherFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="beforeclass">
<span id="appendixes-annotations-beforeclass"></span><h2>&#64;beforeClass</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;beforeClass</span></code> 标注用于指明此静态方法应该于测试类中的所有测试方法都运行完成之后调用，用于建立共享基境。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @beforeClass</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setUpSomeSharedFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @beforeClass</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setUpSomeOtherSharedFixtures</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="codecoverageignore">
<span id="appendixes-annotations-codecoverageignore"></span><h2>&#64;codeCoverageIgnore*</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnore</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnoreStart</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;codeCoverageIgnoreEnd</span></code> 标注用于从覆盖率分析中排除掉某些代码行。</p>
<p>用法参见:ref:<cite>code-coverage-analysis.ignoring-code-blocks</cite>。</p>
</div>
<div class="section" id="covers">
<span id="appendixes-annotations-covers"></span><h2>&#64;covers</h2>
<p>在测试代码中用 <code class="docutils literal notranslate"><span class="pre">&#64;covers</span></code> 标注来指明测试方法想要对哪些方法进行测试：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * @covers BankAccount::getBalance</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">testBalanceIsInitiallyZero</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果提供了此标注，则代码覆盖率信息中只考虑指定的这些方法。</p>
<p><code class="xref std std-numref docutils literal notranslate"><span class="pre">appendixes.annotations.covers.tables.annotations`列出了</span> <span class="pre">``&#64;covers`</span></code> 标注的语法。</p>
<table border="1" class="table docutils" id="appendixes-annotations-covers-tables-annotations">
<caption><span class="caption-text">用于指明测试覆盖哪些方法的标注</span></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Annotation （标注）</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::methodName</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖指定的方法。</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的全部方法。</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName&lt;extended&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类以及其所有父类与接口的全部方法。</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::&lt;public&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的所有</span> <span class="pre">public</span> <span class="pre">方法。</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::&lt;protected&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的所有</span> <span class="pre">protected</span> <span class="pre">方法。</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::&lt;private&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的所有</span> <span class="pre">private</span> <span class="pre">方法。</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::&lt;!public&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的所有非</span> <span class="pre">public</span> <span class="pre">方法。</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::&lt;!protected&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的所有非</span> <span class="pre">protected</span> <span class="pre">方法。</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">ClassName::&lt;!private&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定类的所有非</span> <span class="pre">private</span> <span class="pre">方法。</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;covers</span> <span class="pre">::functionName</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">指明所标注的测试方法覆盖给定的全局函数。</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="coversdefaultclass">
<span id="appendixes-annotations-coversdefaultclass"></span><h2>&#64;coversDefaultClass</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;coversDefaultClass</span></code> 标注用于指定一个默认的命名空间或类名，这样就不用在每个 <code class="docutils literal notranslate"><span class="pre">&#64;covers</span></code> 标注中重复长名称。参见:numref:<cite>appendixes.annotations.examples.CoversDefaultClassTest.php</cite>。</p>
<div class="literal-block-wrapper docutils container" id="appendixes-annotations-examples-coversdefaultclasstest-php">
<div class="code-block-caption"><span class="caption-text">用 &#64;coversDefaultClass 缩短标注</span></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @coversDefaultClass \Foo\CoveredClass</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">CoversDefaultClassTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @covers ::publicMethod</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo\CoveredClass</span><span class="p">;</span>
        <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">publicMethod</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="coversnothing">
<span id="appendixes-annotations-coversnothing"></span><h2>&#64;coversNothing</h2>
<p>在测试代码中用 <code class="docutils literal notranslate"><span class="pre">&#64;coversNothing</span></code> 标注来指明所标注的测试用例不需要记录任何代码覆盖率信息。</p>
<p>这可以用于集成测试。例子可参见:ref:<cite>code-coverage-analysis.specifying-covered-methods.examples.GuestbookIntegrationTest.php</cite>。</p>
<p>这个标注可以用在类级别或者方法级别，并且会覆盖掉任何 <code class="docutils literal notranslate"><span class="pre">&#64;covers</span></code> 标注。</p>
</div>
<div class="section" id="dataprovider">
<span id="appendixes-annotations-dataprovider"></span><h2>&#64;dataProvider</h2>
<p>测试方法可以接受任意参数。这些参数可以由数据供给器方法（<span class="xref std std-ref">writing-tests-for-phpunit.data-providers.examples.DataTest.php`中的 ``provider()`</span>）提供。所要使用的数据供给器方法用 <code class="docutils literal notranslate"><span class="pre">&#64;dataProvider</span></code> 标注来指定。</p>
<p>更多细节参见:ref:<cite>writing-tests-for-phpunit.data-providers</cite>。</p>
</div>
<div class="section" id="depends">
<span id="appendixes-annotations-depends"></span><h2>&#64;depends</h2>
<p>PHPUnit支持对测试方法之间的显式依赖关系进行声明。这种依赖关系并不是定义在测试方法的执行顺序中，而是允许生产者(producer)返回一个测试基境(fixture)的实例，并将此实例传递给依赖于它的消费者(consumer)们。<span class="xref std std-ref">writing-tests-for-phpunit.examples.StackTest2.php`展示了如何用 ``&#64;depends`</span> 标注来表达测试方法之间的依赖关系。</p>
<p>更多细节参见:ref:<cite>writing-tests-for-phpunit.test-dependencies</cite>。</p>
</div>
<div class="section" id="expectedexception">
<span id="appendixes-annotations-expectedexception"></span><h2>&#64;expectedException</h2>
<p><span class="xref std std-ref">writing-tests-for-phpunit.exceptions.examples.ExceptionTest.php`展示了如何用 ``&#64;expectedException`</span> 标注来测试被测代码中是否抛出了异常。</p>
<p>更多细节参见:ref:<cite>writing-tests-for-phpunit.exceptions</cite>。</p>
</div>
<div class="section" id="expectedexceptioncode">
<span id="appendixes-annotations-expectedexceptioncode"></span><h2>&#64;expectedExceptionCode</h2>
<p>将 <code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionCode</span></code> 标注与 <code class="docutils literal notranslate"><span class="pre">&#64;expectedException</span></code> 联合使用，可以对抛出异常的代码作出断言，这样可以缩小具体异常的范围。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @expectedException     MyException</span>
<span class="sd">     * @expectedExceptionCode 20</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExceptionHasErrorcode20</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">MyException</span><span class="p">(</span><span class="s1">&#39;Some Message&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>为了方便测试并减少冗余，可以用”<code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionCode</span> <span class="pre">ClassName::CONST</span></code>”这样的语法将指定类常量作为 <code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionCode</span></code></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">      * @expectedException     MyException</span>
<span class="sd">      * @expectedExceptionCode MyClass::ERRORCODE</span>
<span class="sd">      */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExceptionHasErrorcode20</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">MyException</span><span class="p">(</span><span class="s1">&#39;Some Message&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">MyClass</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="no">ERRORCODE</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="expectedexceptionmessage">
<span id="appendixes-annotations-expectedexceptionmessage"></span><h2>&#64;expectedExceptionMessage</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionMessage</span></code> 标注的运作方式类似于 <code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionCode</span></code> ，用它可以对异常的错误讯息作出断言。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @expectedException        MyException</span>
<span class="sd">     * @expectedExceptionMessage Some Message</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExceptionHasRightMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">MyException</span><span class="p">(</span><span class="s1">&#39;Some Message&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>预期讯息可以是异常讯息的子串。在只需要断言传入的特定名称或参数确实出现于异常中时这个特性很有用，这样就无需在测试中关注完整的异常讯息。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
     <span class="sd">/**</span>
<span class="sd">      * @expectedException        MyException</span>
<span class="sd">      * @expectedExceptionMessage broken</span>
<span class="sd">      */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">testExceptionHasRightMessage</span><span class="p">()</span>
     <span class="p">{</span>
         <span class="nv">$param</span> <span class="o">=</span> <span class="s2">&quot;broken&quot;</span><span class="p">;</span>
         <span class="k">throw</span> <span class="k">new</span> <span class="nx">MyException</span><span class="p">(</span><span class="s1">&#39;Invalid parameter &quot;&#39;</span><span class="o">.</span><span class="nv">$param</span><span class="o">.</span><span class="s1">&#39;&quot;.&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>为了方便测试同时减少冗余，可以用”<code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionMessage</span> <span class="pre">ClassName::CONST</span></code>”这样的语法将指定类常量作为 <code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionMessage</span></code>。在:ref:<a href="#id1"><span class="problematic" id="id2">`</span></a>appendixes.annotations.expectedExceptionCode`中可以看到范例。</p>
</div>
<div class="section" id="expectedexceptionmessageregexp">
<span id="appendixes-annotations-expectedexceptionmessageregexp"></span><h2>&#64;expectedExceptionMessageRegExp</h2>
<p>预期讯息也可以通过 <code class="docutils literal notranslate"><span class="pre">&#64;expectedExceptionMessageRegExp</span></code> 标注以正则表达式来指定。当无法用子串来完成对给定讯息的匹配时，这种方式就非常有用了。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
     <span class="sd">/**</span>
<span class="sd">      * @expectedException              MyException</span>
<span class="sd">      * @expectedExceptionMessageRegExp /Argument \d+ can not be an? \w+/</span>
<span class="sd">      */</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">testExceptionHasRightMessage</span><span class="p">()</span>
     <span class="p">{</span>
         <span class="k">throw</span> <span class="k">new</span> <span class="nx">MyException</span><span class="p">(</span><span class="s1">&#39;Argument 2 can not be an integer&#39;</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="group">
<span id="appendixes-annotations-group"></span><h2>&#64;group</h2>
<p>测试可以用 <code class="docutils literal notranslate"><span class="pre">&#64;group</span></code> 标注来标记为属于一个或多个组，就像这样：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @group specification</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @group regresssion</span>
<span class="sd">     * @group bug2204</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomethingElse</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>测试可以基于组来选择性的执行，使用命令行测试执行器的 <code class="docutils literal notranslate"><span class="pre">--group</span></code> and <code class="docutils literal notranslate"><span class="pre">--exclude-group</span></code> 选项，或者使用对应的 XML 配置文件指令。</p>
</div>
<div class="section" id="large">
<span id="appendixes-annotations-large"></span><h2>&#64;large</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 标注是 <code class="docutils literal notranslate"><span class="pre">&#64;group</span> <span class="pre">large</span></code> 的别名。</p>
<p>如果安装了 <code class="docutils literal notranslate"><span class="pre">PHP_Invoker</span></code> 组件包并启用了严格模式，一个执行时间超过60秒的大型(large)测试将视为失败。这个超时限制可以通过 XML 配置文件的 <code class="docutils literal notranslate"><span class="pre">timeoutForLargeTests</span></code> 属性进行配置。</p>
</div>
<div class="section" id="medium">
<span id="appendixes-annotations-medium"></span><h2>&#64;medium</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 标注是 <code class="docutils literal notranslate"><span class="pre">&#64;group</span> <span class="pre">medium</span></code> 的别名。中型(medium)测试不能依赖于标记为 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 的测试。</p>
<p>如果安装了 <code class="docutils literal notranslate"><span class="pre">PHP_Invoker</span></code> 组件包并启用了严格模式，一个执行时间超过10秒的中型(medium)测试将视为失败。这个超时限制可以通过 XML 配置文件的 <code class="docutils literal notranslate"><span class="pre">timeoutForMediumTests</span></code> 属性进行配置。</p>
</div>
<div class="section" id="preserveglobalstate">
<span id="appendixes-annotations-preserveglobalstate"></span><h2>&#64;preserveGlobalState</h2>
<p>在单独的进程中运行测试时，PHPUnit 会尝试保持来自父进程的全局状态（通过在父进程序列化全局状态然后在子进程反序列化的方式）。这当父进程包含非可序列化的全局内容时可能会导致问题。为了修正这种问题，可以用 <code class="docutils literal notranslate"><span class="pre">&#64;preserveGlobalState</span></code> 标注来禁止 PHPUnit 保持全局状态。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     * @preserveGlobalState disabled</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testInSeparateProcess</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="requires">
<span id="appendixes-annotations-requires"></span><h2>&#64;requires</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;requires</span></code> 标注用于在常规前提条件（例如 PHP 版本或所安装的扩展）不满足时跳过测试。</p>
<p>完整的可能用法以及例子见:ref:<cite>incomplete-and-skipped-tests.requires.tables.api</cite></p>
</div>
<div class="section" id="runtestsinseparateprocesses">
<span id="appendixes-annotations-runtestsinseparateprocesses"></span><h2>&#64;runTestsInSeparateProcesses</h2>
<p>指明单个测试类内的所有测试要各自运行在独立的 PHP 进程中。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @runTestsInSeparateProcesses</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>注意：</em><a class="reference internal" href="#appendixes-annotations-preserveglobalstate"><span class="std std-ref">&#64;preserveGlobalState</span></a> 默认情况下，PHPUnit 会尝试通过在父进程序列化全局状态然后在子进程反序列化的方式在子进程中保持来自父进程的全局状态。这当父进程包含非可序列化的全局内容时可能会导致问题。关于如何修正此问题的信息参见:ref:<cite>appendixes.annotations.preserveGlobalState</cite>。</p>
</div>
<div class="section" id="runinseparateprocess">
<span id="appendixes-annotations-runinseparateprocess"></span><h2>&#64;runInSeparateProcess</h2>
<p>明某个测试要运行在独立的 PHP 进程中。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testInSeparateProcess</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>注意：</em><a class="reference internal" href="#appendixes-annotations-preserveglobalstate"><span class="std std-ref">&#64;preserveGlobalState</span></a> 默认情况下，PHPUnit 会尝试通过在父进程序列化全局状态然后在子进程反序列化的方式在子进程中保持来自父进程的全局状态。这当父进程包含非可序列化的全局内容时可能会导致问题。关于如何修正此问题的信息参见:ref:<cite>appendixes.annotations.preserveGlobalState</cite>。</p>
</div>
<div class="section" id="small">
<span id="appendixes-annotations-small"></span><h2>&#64;small</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;small</span></code> 标注是 <code class="docutils literal notranslate"><span class="pre">&#64;group</span> <span class="pre">small</span></code> 的别名。小型(small)测试不能依赖于标记为 <code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 的测试。</p>
<p>如果安装了 <code class="docutils literal notranslate"><span class="pre">PHP_Invoker</span></code> 组件包并启用了严格模式，一个执行时间超过1秒的小型(small)测试将会视为失败。这个超时限制可以通过 XML 配置文件的 <code class="docutils literal notranslate"><span class="pre">timeoutForSmallTests</span></code> 属性进行配置。</p>
<div class="admonition-note admonition">
<p class="first admonition-title">Note</p>
<p class="last">需要启用运行时间限制的测试必须显式地标注为 <code class="docutils literal notranslate"><span class="pre">&#64;small</span></code>、<code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code>。</p>
</div>
</div>
<div class="section" id="test">
<span id="appendixes-annotations-test"></span><h2>&#64;test</h2>
<p>除了用 <code class="docutils literal notranslate"><span class="pre">test</span></code> 作为测试方法名称的前缀外，还可以在方法的文档注释块中用 <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code> 标注来将其标记为测试方法。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * @test</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">initialBalanceShouldBe0</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ba</span><span class="o">-&gt;</span><span class="na">getBalance</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="testdox">
<span id="appendixes-annotations-testdox"></span><h2>&#64;testdox</h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="section" id="ticket">
<span id="appendixes-annotations-ticket"></span><h2>&#64;ticket</h2>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="section" id="uses">
<span id="appendixes-annotations-uses"></span><h2>&#64;uses</h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;uses</span></code> 标注用来指明那些将会在测试中执行到但同时又不打算让其被测试所覆盖的代码。在对代码单元进行测试时所必须的值对象就是个很好的例子。</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * @covers BankAccount::deposit</span>
<span class="sd"> * @uses   Money</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">testMoneyCanBeDepositedInAccount</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在严格覆盖模式中，意外覆盖的代码将导致测试判定为失败，这个标注就显得特别有用。关于严格覆盖模式的更多信息，参见:ref:<cite>risky-tests.unintentionally-covered-code</cite>。</p>
</div>
<span id="document-configuration"></span><div class="section" id="xml">
<span id="appendixes-configuration"></span><h2>XML 配置文件</h2>
<div class="section" id="phpunit">
<span id="appendixes-configuration-phpunit"></span><h3>PHPUnit</h3>
<p><code class="docutils literal notranslate"><span class="pre">&lt;phpunit&gt;</span></code> 元素的属性用于配置 PHPUnit 的核心功能。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;phpunit
         xmlns:xsi<span class="o">=</span><span class="s2">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         xsi:noNamespaceSchemaLocation<span class="o">=</span><span class="s2">&quot;https://schema.phpunit.de/6.3/phpunit.xsd&quot;</span>
         <span class="nv">backupGlobals</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
         <span class="nv">backupStaticAttributes</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         &lt;!--bootstrap<span class="o">=</span><span class="s2">&quot;/path/to/bootstrap.php&quot;</span>--&gt;
         <span class="nv">cacheTokens</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">colors</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">convertErrorsToExceptions</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
         <span class="nv">convertNoticesToExceptions</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
         <span class="nv">convertWarningsToExceptions</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
         <span class="nv">forceCoversAnnotation</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">mapTestClassNameToCoveredClassName</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">printerClass</span><span class="o">=</span><span class="s2">&quot;PHPUnit_TextUI_ResultPrinter&quot;</span>
         &lt;!--printerFile<span class="o">=</span><span class="s2">&quot;/path/to/ResultPrinter.php&quot;</span>--&gt;
         <span class="nv">processIsolation</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">stopOnError</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">stopOnFailure</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">stopOnIncomplete</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">stopOnSkipped</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">stopOnRisky</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
         <span class="nv">testSuiteLoaderClass</span><span class="o">=</span><span class="s2">&quot;PHPUnit_Runner_StandardTestSuiteLoader&quot;</span>
         &lt;!--testSuiteLoaderFile<span class="o">=</span><span class="s2">&quot;/path/to/StandardTestSuiteLoader.php&quot;</span>--&gt;
         <span class="nv">timeoutForSmallTests</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
         <span class="nv">timeoutForMediumTests</span><span class="o">=</span><span class="s2">&quot;10&quot;</span>
         <span class="nv">timeoutForLargeTests</span><span class="o">=</span><span class="s2">&quot;60&quot;</span>
         <span class="nv">verbose</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>&gt;
  &lt;!-- ... --&gt;
&lt;/phpunit&gt;
</pre></div>
</div>
<p>以上 XML 配置对应于在:ref:<a href="#id1"><span class="problematic" id="id2">`</span></a>textui.clioptions`描述过的 TextUI 测试执行器的默认行为。</p>
<p>其他那些不能用命令行选项来配置的选项有：</p>
<p><code class="docutils literal notranslate"><span class="pre">convertErrorsToExceptions</span></code></p>
<blockquote>
<div><p>默认情况下，PHPUnit 将会安插一个错误处理函数来将以下错误转换为异常：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">E_WARNING</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_NOTICE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_USER_ERROR</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_USER_WARNING</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_USER_NOTICE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_STRICT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_RECOVERABLE_ERROR</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_DEPRECATED</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">E_USER_DEPRECATED</span></code></li>
</ul>
<p>将 <code class="docutils literal notranslate"><span class="pre">convertErrorsToExceptions</span></code> 设为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 可以禁用此功能。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">convertNoticesToExceptions</span></code></p>
<blockquote>
<div>此选项设置为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 时，由 <code class="docutils literal notranslate"><span class="pre">convertErrorsToExceptions</span></code> 安插的错误处理函数不会将 <code class="docutils literal notranslate"><span class="pre">E_NOTICE</span></code>、<code class="docutils literal notranslate"><span class="pre">E_USER_NOTICE</span></code>、<code class="docutils literal notranslate"><span class="pre">E_STRICT</span></code> 错误转换为异常。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">convertWarningsToExceptions</span></code></p>
<blockquote>
<div>此选项设置为 <code class="docutils literal notranslate"><span class="pre">false</span></code> 时，由 <code class="docutils literal notranslate"><span class="pre">convertErrorsToExceptions</span></code> 安插的错误处理函数不会将 <code class="docutils literal notranslate"><span class="pre">E_WARNING</span></code> 或 <code class="docutils literal notranslate"><span class="pre">E_USER_WARNING</span></code> 错误转换为异常。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">forceCoversAnnotation</span></code></p>
<blockquote>
<div>只记录使用了 <code class="docutils literal notranslate"><span class="pre">&#64;covers</span></code> 标注（文档参见:ref:<cite>appendixes.annotations.covers</cite>）的测试的代码覆盖率。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">timeoutForLargeTests</span></code></p>
<blockquote>
<div>如果实行了基于测试规模的时间限制，那么此属性为所有标记为 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 的测试设定超时限制。在配置的时间限制内未执行完毕的测试将视为失败。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">timeoutForMediumTests</span></code></p>
<blockquote>
<div>如果实行了基于测试规模的时间限制，那么此属性为所有标记为 <code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 的测试设定超时限制。在配置的时间限制内未执行完毕的测试将视为失败。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">timeoutForSmallTests</span></code></p>
<blockquote>
<div>如果实行了基于测试规模的时间限制，那么此属性为所有未标记为 <code class="docutils literal notranslate"><span class="pre">&#64;medium</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&#64;large</span></code> 的测试设定超时限制。在配置的时间限制内未执行完毕的测试将视为失败。</div></blockquote>
</div>
<div class="section" id="appendixes-configuration-testsuites">
<span id="id3"></span><h3>测试套件</h3>
<p>带有一个或多个 <code class="docutils literal notranslate"><span class="pre">&lt;testsuite&gt;</span></code> 子元素的 <code class="docutils literal notranslate"><span class="pre">&lt;testsuites&gt;</span></code> 元素用于将测试套件及测试用例组合出新的测试套件。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;testsuites&gt;
  &lt;testsuite <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;My Test Suite&quot;</span>&gt;
    &lt;directory&gt;/path/to/*Test.php files&lt;/directory&gt;
    &lt;file&gt;/path/to/MyTest.php&lt;/file&gt;
    &lt;exclude&gt;/path/to/exclude&lt;/exclude&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></div>
</div>
<p>可以用 <code class="docutils literal notranslate"><span class="pre">phpVersion</span></code> 和 <code class="docutils literal notranslate"><span class="pre">phpVersionOperator</span></code> 属性来指定 PHP 版本需求。在以下例子中，仅当 PHP 版本至少为 5.3.0 时才会将 <code class="file docutils literal notranslate"><span class="pre">/path/to/*Test.php</span></code> 文件与 <code class="file docutils literal notranslate"><span class="pre">/path/to/MyTest.php</span></code> 文件添加到测试套件中。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;testsuites&gt;
  &lt;testsuite <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;My Test Suite&quot;</span>&gt;
    &lt;directory <span class="nv">suffix</span><span class="o">=</span><span class="s2">&quot;Test.php&quot;</span> <span class="nv">phpVersion</span><span class="o">=</span><span class="s2">&quot;5.3.0&quot;</span> <span class="nv">phpVersionOperator</span><span class="o">=</span><span class="s2">&quot;&gt;=&quot;</span>&gt;/path/to/files&lt;/directory&gt;
    &lt;file <span class="nv">phpVersion</span><span class="o">=</span><span class="s2">&quot;5.3.0&quot;</span> <span class="nv">phpVersionOperator</span><span class="o">=</span><span class="s2">&quot;&gt;=&quot;</span>&gt;/path/to/MyTest.php&lt;/file&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">phpVersionOperator</span></code> 属性是可选的，其默认值为 <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>。</p>
<p>分组
##</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;groups&gt;</span></code> 元素及其 <code class="docutils literal notranslate"><span class="pre">&lt;include&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;exclude&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;group&gt;</span></code> 子元素用于从带有 <code class="docutils literal notranslate"><span class="pre">&#64;group</span></code> 标注（相关文档参见 <a class="reference internal" href="index.html#appendixes-annotations-group"><span class="std std-ref">&#64;group</span></a>）的测试中选择需要运行（或不运行）的分组。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;groups&gt;
  &lt;include&gt;
    &lt;group&gt;name&lt;/group&gt;
  &lt;/include&gt;
  &lt;exclude&gt;
    &lt;group&gt;name&lt;/group&gt;
  &lt;/exclude&gt;
&lt;/groups&gt;
</pre></div>
</div>
<p>以上 XML 配置对应于以如下选项调用 TextUI 测试执行器：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--group</span> <span class="pre">name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--exclude-group</span> <span class="pre">name</span></code></li>
</ul>
</div>
<div class="section" id="whitelisting-files-for-code-coverage">
<span id="appendixes-configuration-whitelisting-files"></span><h3>Whitelisting Files for Code Coverage</h3>
<p><code class="docutils literal notranslate"><span class="pre">&lt;filter&gt;</span></code> 元素及其子元素用于配置代码覆盖率报告所使用的白名单。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;filter&gt;
  &lt;whitelist <span class="nv">processUncoveredFilesFromWhitelist</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>&gt;
    &lt;directory <span class="nv">suffix</span><span class="o">=</span><span class="s2">&quot;.php&quot;</span>&gt;/path/to/files&lt;/directory&gt;
    &lt;file&gt;/path/to/file&lt;/file&gt;
    &lt;exclude&gt;
      &lt;directory <span class="nv">suffix</span><span class="o">=</span><span class="s2">&quot;.php&quot;</span>&gt;/path/to/files&lt;/directory&gt;
      &lt;file&gt;/path/to/file&lt;/file&gt;
    &lt;/exclude&gt;
  &lt;/whitelist&gt;
&lt;/filter&gt;
</pre></div>
</div>
</div>
<div class="section" id="logging">
<span id="appendixes-configuration-logging"></span><h3>Logging （日志记录）</h3>
<p><code class="docutils literal notranslate"><span class="pre">&lt;logging&gt;</span></code> 元素及其 <code class="docutils literal notranslate"><span class="pre">&lt;log&gt;</span></code> 子元素用于配置测试执行期间的日志记录。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;logging&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;coverage-html&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/report&quot;</span> <span class="nv">lowUpperBound</span><span class="o">=</span><span class="s2">&quot;35&quot;</span>
       <span class="nv">highLowerBound</span><span class="o">=</span><span class="s2">&quot;70&quot;</span>/&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;coverage-clover&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/coverage.xml&quot;</span>/&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;coverage-php&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/coverage.serialized&quot;</span>/&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;coverage-text&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;php://stdout&quot;</span> <span class="nv">showUncoveredFiles</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>/&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;junit&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/logfile.xml&quot;</span> <span class="nv">logIncompleteSkipped</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>/&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;testdox-html&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/testdox.html&quot;</span>/&gt;
  &lt;log <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;testdox-text&quot;</span> <span class="nv">target</span><span class="o">=</span><span class="s2">&quot;/tmp/testdox.txt&quot;</span>/&gt;
&lt;/logging&gt;
</pre></div>
</div>
<p>以上 XML 配置对应于以如下选项调用 TextUI 测试执行器：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--coverage-html</span> <span class="pre">/tmp/report</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--coverage-clover</span> <span class="pre">/tmp/coverage.xml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--coverage-php</span> <span class="pre">/tmp/coverage.serialized</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--coverage-text</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">/tmp/logfile.txt</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--log-junit</span> <span class="pre">/tmp/logfile.xml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--testdox-html</span> <span class="pre">/tmp/testdox.html</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--testdox-text</span> <span class="pre">/tmp/testdox.txt</span></code></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">lowUpperBound</span></code>、<code class="docutils literal notranslate"><span class="pre">highLowerBound</span></code>、<code class="docutils literal notranslate"><span class="pre">logIncompleteSkipped</span></code> 及 <code class="docutils literal notranslate"><span class="pre">showUncoveredFiles</span></code> 属性没有等价的 TextUI 测试执行器选项。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">lowUpperBound</span></code>：视为“低”覆盖率的最大覆盖率百分比。</li>
<li><code class="docutils literal notranslate"><span class="pre">highLowerBound</span></code>：视为“高”覆盖率的最小覆盖率百分比。</li>
<li><code class="docutils literal notranslate"><span class="pre">showUncoveredFiles</span></code>：在 <code class="docutils literal notranslate"><span class="pre">--coverage-text</span></code> 输出中显示所有符合白名单的文件，不仅限于有覆盖率信息的那些。</li>
<li><code class="docutils literal notranslate"><span class="pre">showOnlySummary</span></code>：在 <code class="docutils literal notranslate"><span class="pre">--coverage-text</span></code> 输出中只显示摘要。</li>
</ul>
</div>
<div class="section" id="appendixes-configuration-test-listeners">
<span id="id4"></span><h3>测试监听器</h3>
<p><code class="docutils literal notranslate"><span class="pre">&lt;listeners&gt;</span></code> 元素及其 <code class="docutils literal notranslate"><span class="pre">&lt;listener&gt;</span></code> 子元素用于在测试执行期间附加额外的测试监听器。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;listeners&gt;
  &lt;listener <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;MyListener&quot;</span> <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;/optional/path/to/MyListener.php&quot;</span>&gt;
    &lt;arguments&gt;
      &lt;array&gt;
        &lt;element <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>&gt;
          &lt;string&gt;Sebastian&lt;/string&gt;
        &lt;/element&gt;
      &lt;/array&gt;
      &lt;integer&gt;22&lt;/integer&gt;
      &lt;string&gt;April&lt;/string&gt;
      &lt;double&gt;19.78&lt;/double&gt;
      &lt;null/&gt;
      &lt;object <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;stdClass&quot;</span>/&gt;
    &lt;/arguments&gt;
  &lt;/listener&gt;
&lt;/listeners&gt;
</pre></div>
</div>
<p>以上 XML 配置对应于将 <code class="docutils literal notranslate"><span class="pre">$listener</span></code> 对象（见下文）附到测试执行过程上。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$listener</span> <span class="o">=</span> new MyListener<span class="o">(</span>
    <span class="o">[</span><span class="s1">&#39;Sebastian&#39;</span><span class="o">]</span>,
    <span class="m">22</span>,
    <span class="s1">&#39;April&#39;</span>,
    <span class="m">19</span>.78,
    null,
    new stdClass
<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="php-ini">
<span id="appendixes-configuration-php-ini-constants-variables"></span><h3>设定 PHP INI 设置、常量、全局变量</h3>
<p><code class="docutils literal notranslate"><span class="pre">&lt;php&gt;</span></code> 元素及其子元素用于配置 PHP 设置、常量以及全局变量。同时也可用于向 <code class="docutils literal notranslate"><span class="pre">include_path</span></code> 前部置入内容。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;php&gt;
  &lt;includePath&gt;.&lt;/includePath&gt;
  &lt;ini <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;const <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;var <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;env <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;post <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;get <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;cookie <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;server <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;files <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
  &lt;request <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>/&gt;
&lt;/php&gt;
</pre></div>
</div>
<p>以上 XML 配置对应于如下 PHP 代码：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ini_set<span class="o">(</span><span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;bar&#39;</span><span class="o">)</span><span class="p">;</span>
define<span class="o">(</span><span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;bar&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="nv">$GLOBALS</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_ENV</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_COOKIE</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$_REQUEST</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-bibliography"></span><div class="section" id="appendixes-bibliography">
<span id="id1"></span><h2>参考书目</h2>
<p>[Astels2003] David Astels. <em>Test Driven Development</em>.</p>
<p>[Beck2002] Kent Beck. <em>Test Driven Development by Example</em>.</p>
<p>[Meszaros2007] Gerard Meszaros. <em>xUnit Test Patterns: Refactoring Test Code</em>.</p>
</div>
<span id="document-copyright"></span><p>==
版权
==</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="nx">Copyright</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="mi">2005</span><span class="o">-</span><span class="mi">2018</span> <span class="nx">Sebastian</span> <span class="nx">Bergmann</span><span class="o">.</span>

<span class="nx">此作品依照</span> <span class="nx">Creative</span> <span class="nx">Commons</span> <span class="nx">Attribution</span> <span class="mf">3.0</span>
<span class="nx">Unported</span> <span class="nx">License</span> <span class="nx">授权。</span>

<span class="nx">以下是此授权许可协议的摘要信息，完整的法律文件附在其后。</span>

<span class="o">--------------------------------------------------------------------</span>

<span class="nx">您可以自由地：</span>

    <span class="o">*</span> <span class="nx">分享</span> <span class="o">-</span> <span class="nx">复制、分发、传播此作品</span>
    <span class="o">*</span> <span class="nx">重组</span> <span class="o">-</span> <span class="nx">创作演绎此作品</span>

<span class="nx">惟须遵守下列条件：</span>

<span class="nx">姓名标示。弄必须按照作者或者版权人指定的方式表彰其姓名（但不得以任何方式暗示他们认可你或你使用本作品的方式）。</span>

    <span class="o">*</span> <span class="nx">在再使用或者发行本作品时，您必须向他人明示本作品使用的许可协议条款。明示的最佳方法是附上本网页的链接。</span>

    <span class="o">*</span> <span class="nx">若您获得著作权人准许，则上述所有条件都可予以免除。</span>

    <span class="o">*</span> <span class="nx">此协议对作者的人身权不构成任何损害与限制。</span>

<span class="nx">合理使用及其他权利不受许可协议影响。</span>

<span class="nx">以上是易于常人了解的法律条文（完整的授权许可协议）摘要。</span>

<span class="o">====================================================================</span>

<span class="nx">Creative</span> <span class="nx">Commons</span> <span class="nx">Legal</span> <span class="nx">Code</span>
<span class="nx">Attribution</span> <span class="mf">3.0</span> <span class="nx">Unported</span>

<span class="nx">CREATIVE</span> <span class="nx">COMMONS</span> <span class="nx">CORPORATION</span> <span class="nx">IS</span> <span class="k">NOT</span> <span class="nx">A</span> <span class="nx">LAW</span> <span class="nx">FIRM</span> <span class="k">AND</span> <span class="nx">DOES</span> <span class="k">NOT</span> <span class="nx">PROVIDE</span>
<span class="nx">LEGAL</span> <span class="nx">SERVICES</span><span class="o">.</span> <span class="nx">DISTRIBUTION</span> <span class="nx">OF</span> <span class="k">THIS</span> <span class="nx">LICENSE</span> <span class="nx">DOES</span> <span class="k">NOT</span> <span class="nx">CREATE</span> <span class="nx">AN</span>
<span class="nx">ATTORNEY</span><span class="o">-</span><span class="nx">CLIENT</span> <span class="nx">RELATIONSHIP</span><span class="o">.</span> <span class="nx">CREATIVE</span> <span class="nx">COMMONS</span> <span class="nx">PROVIDES</span> <span class="k">THIS</span>
<span class="nx">INFORMATION</span> <span class="nx">ON</span> <span class="nx">AN</span> <span class="s2">&quot;AS-IS&quot;</span> <span class="nx">BASIS</span><span class="o">.</span> <span class="nx">CREATIVE</span> <span class="nx">COMMONS</span> <span class="nx">MAKES</span> <span class="nx">NO</span>
<span class="nx">WARRANTIES</span> <span class="nx">REGARDING</span> <span class="nx">THE</span> <span class="nx">INFORMATION</span> <span class="nx">PROVIDED</span><span class="p">,</span> <span class="k">AND</span> <span class="nx">DISCLAIMS</span>
<span class="nx">LIABILITY</span> <span class="k">FOR</span> <span class="nx">DAMAGES</span> <span class="nx">RESULTING</span> <span class="nx">FROM</span> <span class="nx">ITS</span> <span class="k">USE</span><span class="o">.</span>

<span class="nx">License</span>

<span class="nx">THE</span> <span class="nx">WORK</span> <span class="p">(</span><span class="k">AS</span> <span class="nx">DEFINED</span> <span class="nx">BELOW</span><span class="p">)</span> <span class="nx">IS</span> <span class="nx">PROVIDED</span> <span class="nx">UNDER</span> <span class="nx">THE</span> <span class="nx">TERMS</span> <span class="nx">OF</span> <span class="k">THIS</span>
<span class="nx">CREATIVE</span> <span class="nx">COMMONS</span> <span class="k">PUBLIC</span> <span class="nx">LICENSE</span> <span class="p">(</span><span class="s2">&quot;CCPL&quot;</span> <span class="k">OR</span> <span class="s2">&quot;LICENSE&quot;</span><span class="p">)</span><span class="o">.</span> <span class="nx">THE</span> <span class="nx">WORK</span> <span class="nx">IS</span>
<span class="k">PROTECTED</span> <span class="nx">BY</span> <span class="nx">COPYRIGHT</span> <span class="k">AND</span><span class="o">/</span><span class="k">OR</span> <span class="nx">OTHER</span> <span class="nx">APPLICABLE</span> <span class="nx">LAW</span><span class="o">.</span> <span class="nx">ANY</span> <span class="k">USE</span> <span class="nx">OF</span> <span class="nx">THE</span>
<span class="nx">WORK</span> <span class="nx">OTHER</span> <span class="nx">THAN</span> <span class="k">AS</span> <span class="nx">AUTHORIZED</span> <span class="nx">UNDER</span> <span class="k">THIS</span> <span class="nx">LICENSE</span> <span class="k">OR</span> <span class="nx">COPYRIGHT</span> <span class="nx">LAW</span>
<span class="nx">IS</span> <span class="nx">PROHIBITED</span><span class="o">.</span>

<span class="nx">BY</span> <span class="nx">EXERCISING</span> <span class="nx">ANY</span> <span class="nx">RIGHTS</span> <span class="nx">TO</span> <span class="nx">THE</span> <span class="nx">WORK</span> <span class="nx">PROVIDED</span> <span class="nx">HERE</span><span class="p">,</span> <span class="nx">YOU</span> <span class="nx">ACCEPT</span> <span class="k">AND</span>
<span class="nx">AGREE</span> <span class="nx">TO</span> <span class="nx">BE</span> <span class="nx">BOUND</span> <span class="nx">BY</span> <span class="nx">THE</span> <span class="nx">TERMS</span> <span class="nx">OF</span> <span class="k">THIS</span> <span class="nx">LICENSE</span><span class="o">.</span> <span class="nx">TO</span> <span class="nx">THE</span> <span class="nx">EXTENT</span> <span class="k">THIS</span>
<span class="nx">LICENSE</span> <span class="nx">MAY</span> <span class="nx">BE</span> <span class="nx">CONSIDERED</span> <span class="nx">TO</span> <span class="nx">BE</span> <span class="nx">A</span> <span class="nx">CONTRACT</span><span class="p">,</span> <span class="nx">THE</span> <span class="nx">LICENSOR</span> <span class="nx">GRANTS</span> <span class="nx">YOU</span>
<span class="nx">THE</span> <span class="nx">RIGHTS</span> <span class="nx">CONTAINED</span> <span class="nx">HERE</span> <span class="nx">IN</span> <span class="nx">CONSIDERATION</span> <span class="nx">OF</span> <span class="nx">YOUR</span> <span class="nx">ACCEPTANCE</span> <span class="nx">OF</span>
<span class="nx">SUCH</span> <span class="nx">TERMS</span> <span class="k">AND</span> <span class="nx">CONDITIONS</span><span class="o">.</span>

<span class="mf">1.</span> <span class="nx">Definitions</span>

   <span class="nx">a</span><span class="o">.</span> <span class="s2">&quot;Adaptation&quot;</span> <span class="nx">means</span> <span class="nx">a</span> <span class="nx">work</span> <span class="nx">based</span> <span class="nx">upon</span> <span class="nx">the</span> <span class="nx">Work</span><span class="p">,</span> <span class="k">or</span> <span class="nx">upon</span> <span class="nx">the</span>
      <span class="nx">Work</span> <span class="k">and</span> <span class="nx">other</span> <span class="nx">pre</span><span class="o">-</span><span class="nx">existing</span> <span class="nx">works</span><span class="p">,</span> <span class="nx">such</span> <span class="k">as</span> <span class="nx">a</span> <span class="nx">translation</span><span class="p">,</span>
      <span class="nx">adaptation</span><span class="p">,</span> <span class="nx">derivative</span> <span class="nx">work</span><span class="p">,</span> <span class="nx">arrangement</span> <span class="nx">of</span> <span class="nx">music</span> <span class="k">or</span> <span class="nx">other</span>
      <span class="nx">alterations</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">literary</span> <span class="k">or</span> <span class="nx">artistic</span> <span class="nx">work</span><span class="p">,</span> <span class="k">or</span> <span class="nx">phonogram</span> <span class="k">or</span>
      <span class="nx">performance</span> <span class="k">and</span> <span class="nx">includes</span> <span class="nx">cinematographic</span> <span class="nx">adaptations</span> <span class="k">or</span> <span class="nx">any</span>
      <span class="nx">other</span> <span class="nx">form</span> <span class="nx">in</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">recast</span><span class="p">,</span> <span class="nx">transformed</span><span class="p">,</span> <span class="k">or</span>
      <span class="nx">adapted</span> <span class="nx">including</span> <span class="nx">in</span> <span class="nx">any</span> <span class="nx">form</span> <span class="nx">recognizably</span> <span class="nx">derived</span> <span class="nx">from</span> <span class="nx">the</span>
      <span class="nx">original</span><span class="p">,</span> <span class="nx">except</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">work</span> <span class="nx">that</span> <span class="nx">constitutes</span> <span class="nx">a</span> <span class="nx">Collection</span>
      <span class="nx">will</span> <span class="k">not</span> <span class="nx">be</span> <span class="nx">considered</span> <span class="nx">an</span> <span class="nx">Adaptation</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">purpose</span> <span class="nx">of</span> <span class="k">this</span>
      <span class="nx">License</span><span class="o">.</span> <span class="k">For</span> <span class="nx">the</span> <span class="nx">avoidance</span> <span class="nx">of</span> <span class="nx">doubt</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">is</span> <span class="nx">a</span>
      <span class="nx">musical</span> <span class="nx">work</span><span class="p">,</span> <span class="nx">performance</span> <span class="k">or</span> <span class="nx">phonogram</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">synchronization</span> <span class="nx">of</span>
      <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">in</span> <span class="nx">timed</span><span class="o">-</span><span class="nx">relation</span> <span class="nx">with</span> <span class="nx">a</span> <span class="nx">moving</span> <span class="nx">image</span> <span class="p">(</span><span class="s2">&quot;synching&quot;</span><span class="p">)</span>
      <span class="nx">will</span> <span class="nx">be</span> <span class="nx">considered</span> <span class="nx">an</span> <span class="nx">Adaptation</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">purpose</span> <span class="nx">of</span> <span class="k">this</span>
      <span class="nx">License</span><span class="o">.</span>

   <span class="nx">b</span><span class="o">.</span> <span class="s2">&quot;Collection&quot;</span> <span class="nx">means</span> <span class="nx">a</span> <span class="nx">collection</span> <span class="nx">of</span> <span class="nx">literary</span> <span class="k">or</span> <span class="nx">artistic</span> <span class="nx">works</span><span class="p">,</span>
      <span class="nx">such</span> <span class="k">as</span> <span class="nx">encyclopedias</span> <span class="k">and</span> <span class="nx">anthologies</span><span class="p">,</span> <span class="k">or</span> <span class="nx">performances</span><span class="p">,</span>
      <span class="nx">phonograms</span> <span class="k">or</span> <span class="nx">broadcasts</span><span class="p">,</span> <span class="k">or</span> <span class="nx">other</span> <span class="nx">works</span> <span class="k">or</span> <span class="nx">subject</span> <span class="nx">matter</span>
      <span class="nx">other</span> <span class="nx">than</span> <span class="nx">works</span> <span class="nx">listed</span> <span class="nx">in</span> <span class="nx">Section</span> <span class="mi">1</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="nx">below</span><span class="p">,</span> <span class="nx">which</span><span class="p">,</span> <span class="nx">by</span>
      <span class="nx">reason</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">selection</span> <span class="k">and</span> <span class="nx">arrangement</span> <span class="nx">of</span> <span class="nx">their</span> <span class="nx">contents</span><span class="p">,</span>
      <span class="nx">constitute</span> <span class="nx">intellectual</span> <span class="nx">creations</span><span class="p">,</span> <span class="nx">in</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">is</span>
      <span class="nx">included</span> <span class="nx">in</span> <span class="nx">its</span> <span class="nx">entirety</span> <span class="nx">in</span> <span class="nx">unmodified</span> <span class="nx">form</span> <span class="nx">along</span> <span class="nx">with</span> <span class="nx">one</span> <span class="k">or</span>
      <span class="nx">more</span> <span class="nx">other</span> <span class="nx">contributions</span><span class="p">,</span> <span class="nb">each</span> <span class="nx">constituting</span> <span class="nx">separate</span> <span class="k">and</span>
      <span class="nx">independent</span> <span class="nx">works</span> <span class="nx">in</span> <span class="nx">themselves</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">together</span> <span class="nx">are</span> <span class="nx">assembled</span>
      <span class="nx">into</span> <span class="nx">a</span> <span class="nx">collective</span> <span class="nx">whole</span><span class="o">.</span> <span class="nx">A</span> <span class="nx">work</span> <span class="nx">that</span> <span class="nx">constitutes</span> <span class="nx">a</span> <span class="nx">Collection</span>
      <span class="nx">will</span> <span class="k">not</span> <span class="nx">be</span> <span class="nx">considered</span> <span class="nx">an</span> <span class="nx">Adaptation</span> <span class="p">(</span><span class="k">as</span> <span class="nb">defined</span> <span class="nx">above</span><span class="p">)</span> <span class="k">for</span>
      <span class="nx">the</span> <span class="nx">purposes</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">License</span><span class="o">.</span>

   <span class="nx">c</span><span class="o">.</span> <span class="s2">&quot;Distribute&quot;</span> <span class="nx">means</span> <span class="nx">to</span> <span class="nx">make</span> <span class="nx">available</span> <span class="nx">to</span> <span class="nx">the</span> <span class="k">public</span> <span class="nx">the</span>
      <span class="nx">original</span> <span class="k">and</span> <span class="nx">copies</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">or</span> <span class="nx">Adaptation</span><span class="p">,</span> <span class="k">as</span> <span class="nx">appropriate</span><span class="p">,</span>
      <span class="nx">through</span> <span class="nx">sale</span> <span class="k">or</span> <span class="nx">other</span> <span class="nx">transfer</span> <span class="nx">of</span> <span class="nx">ownership</span><span class="o">.</span>

   <span class="nx">d</span><span class="o">.</span> <span class="s2">&quot;Licensor&quot;</span> <span class="nx">means</span> <span class="nx">the</span> <span class="nx">individual</span><span class="p">,</span> <span class="nx">individuals</span><span class="p">,</span> <span class="nx">entity</span> <span class="k">or</span>
      <span class="nx">entities</span> <span class="nx">that</span> <span class="nx">offer</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">License</span><span class="o">.</span>

   <span class="nx">e</span><span class="o">.</span> <span class="s2">&quot;Original Author&quot;</span> <span class="nx">means</span><span class="p">,</span> <span class="nx">in</span> <span class="nx">the</span> <span class="k">case</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">literary</span> <span class="k">or</span> <span class="nx">artistic</span>
      <span class="nx">work</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">individual</span><span class="p">,</span> <span class="nx">individuals</span><span class="p">,</span> <span class="nx">entity</span> <span class="k">or</span> <span class="nx">entities</span> <span class="nx">who</span>
      <span class="nx">created</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">or</span> <span class="k">if</span> <span class="nx">no</span> <span class="nx">individual</span> <span class="k">or</span> <span class="nx">entity</span> <span class="nx">can</span> <span class="nx">be</span>
      <span class="nx">identified</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">publisher</span><span class="p">;</span> <span class="k">and</span> <span class="nx">in</span> <span class="nx">addition</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">in</span> <span class="nx">the</span> <span class="k">case</span> <span class="nx">of</span>
      <span class="nx">a</span> <span class="nx">performance</span> <span class="nx">the</span> <span class="nx">actors</span><span class="p">,</span> <span class="nx">singers</span><span class="p">,</span> <span class="nx">musicians</span><span class="p">,</span> <span class="nx">dancers</span><span class="p">,</span> <span class="k">and</span>
      <span class="nx">other</span> <span class="nx">persons</span> <span class="nx">who</span> <span class="nx">act</span><span class="p">,</span> <span class="nx">sing</span><span class="p">,</span> <span class="nx">deliver</span><span class="p">,</span> <span class="nx">declaim</span><span class="p">,</span> <span class="nx">play</span> <span class="nx">in</span><span class="p">,</span>
      <span class="nx">interpret</span> <span class="k">or</span> <span class="nx">otherwise</span> <span class="nx">perform</span> <span class="nx">literary</span> <span class="k">or</span> <span class="nx">artistic</span> <span class="nx">works</span> <span class="k">or</span>
      <span class="nx">expressions</span> <span class="nx">of</span> <span class="nx">folklore</span><span class="p">;</span> <span class="p">(</span><span class="nx">ii</span><span class="p">)</span> <span class="nx">in</span> <span class="nx">the</span> <span class="k">case</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">phonogram</span> <span class="nx">the</span>
      <span class="nx">producer</span> <span class="nx">being</span> <span class="nx">the</span> <span class="nx">person</span> <span class="k">or</span> <span class="nx">legal</span> <span class="nx">entity</span> <span class="nx">who</span> <span class="nx">first</span> <span class="nx">fixes</span> <span class="nx">the</span>
      <span class="nx">sounds</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">performance</span> <span class="k">or</span> <span class="nx">other</span> <span class="nx">sounds</span><span class="p">;</span> <span class="k">and</span><span class="p">,</span> <span class="p">(</span><span class="nx">iii</span><span class="p">)</span> <span class="nx">in</span> <span class="nx">the</span>
      <span class="k">case</span> <span class="nx">of</span> <span class="nx">broadcasts</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">organization</span> <span class="nx">that</span> <span class="nx">transmits</span> <span class="nx">the</span>
      <span class="nx">broadcast</span><span class="o">.</span>

   <span class="nx">f</span><span class="o">.</span> <span class="s2">&quot;Work&quot;</span> <span class="nx">means</span> <span class="nx">the</span> <span class="nx">literary</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="nx">artistic</span> <span class="nx">work</span> <span class="nx">offered</span> <span class="nx">under</span>
      <span class="nx">the</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">License</span> <span class="nx">including</span> <span class="nx">without</span> <span class="nx">limitation</span> <span class="nx">any</span>
      <span class="nx">production</span> <span class="nx">in</span> <span class="nx">the</span> <span class="nx">literary</span><span class="p">,</span> <span class="nx">scientific</span> <span class="k">and</span> <span class="nx">artistic</span> <span class="nx">domain</span><span class="p">,</span>
      <span class="nx">whatever</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">the</span> <span class="nx">mode</span> <span class="k">or</span> <span class="nx">form</span> <span class="nx">of</span> <span class="nx">its</span> <span class="nx">expression</span> <span class="nx">including</span>
      <span class="nx">digital</span> <span class="nx">form</span><span class="p">,</span> <span class="nx">such</span> <span class="k">as</span> <span class="nx">a</span> <span class="nx">book</span><span class="p">,</span> <span class="nx">pamphlet</span> <span class="k">and</span> <span class="nx">other</span> <span class="nx">writing</span><span class="p">;</span> <span class="nx">a</span>
      <span class="nx">lecture</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">sermon</span> <span class="k">or</span> <span class="nx">other</span> <span class="nx">work</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">nature</span><span class="p">;</span> <span class="nx">a</span>
      <span class="nx">dramatic</span> <span class="k">or</span> <span class="nx">dramatico</span><span class="o">-</span><span class="nx">musical</span> <span class="nx">work</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">choreographic</span> <span class="nx">work</span> <span class="k">or</span>
      <span class="nx">entertainment</span> <span class="nx">in</span> <span class="nx">dumb</span> <span class="nx">show</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">musical</span> <span class="nx">composition</span> <span class="nx">with</span> <span class="k">or</span>
      <span class="nx">without</span> <span class="nx">words</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">cinematographic</span> <span class="nx">work</span> <span class="nx">to</span> <span class="nx">which</span> <span class="nx">are</span> <span class="nx">assimilated</span>
      <span class="nx">works</span> <span class="nx">expressed</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">process</span> <span class="nx">analogous</span> <span class="nx">to</span> <span class="nx">cinematography</span><span class="p">;</span> <span class="nx">a</span>
      <span class="nx">work</span> <span class="nx">of</span> <span class="nx">drawing</span><span class="p">,</span> <span class="nx">painting</span><span class="p">,</span> <span class="nx">architecture</span><span class="p">,</span> <span class="nx">sculpture</span><span class="p">,</span> <span class="nx">engraving</span>
      <span class="k">or</span> <span class="nx">lithography</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">photographic</span> <span class="nx">work</span> <span class="nx">to</span> <span class="nx">which</span> <span class="nx">are</span> <span class="nx">assimilated</span>
      <span class="nx">works</span> <span class="nx">expressed</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">process</span> <span class="nx">analogous</span> <span class="nx">to</span> <span class="nx">photography</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">work</span>
      <span class="nx">of</span> <span class="nx">applied</span> <span class="nx">art</span><span class="p">;</span> <span class="nx">an</span> <span class="nx">illustration</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">plan</span><span class="p">,</span> <span class="nx">sketch</span> <span class="k">or</span> <span class="nx">three</span><span class="o">-</span>
      <span class="nx">dimensional</span> <span class="nx">work</span> <span class="nx">relative</span> <span class="nx">to</span> <span class="nx">geography</span><span class="p">,</span> <span class="nx">topography</span><span class="p">,</span>
      <span class="nx">architecture</span> <span class="k">or</span> <span class="nx">science</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">performance</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">broadcast</span><span class="p">;</span> <span class="nx">a</span>
      <span class="nx">phonogram</span><span class="p">;</span> <span class="nx">a</span> <span class="nx">compilation</span> <span class="nx">of</span> <span class="nx">data</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">extent</span> <span class="nx">it</span> <span class="nx">is</span> <span class="k">protected</span>
      <span class="k">as</span> <span class="nx">a</span> <span class="nx">copyrightable</span> <span class="nx">work</span><span class="p">;</span> <span class="k">or</span> <span class="nx">a</span> <span class="nx">work</span> <span class="nx">performed</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">variety</span> <span class="k">or</span>
      <span class="nx">circus</span> <span class="nx">performer</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">extent</span> <span class="nx">it</span> <span class="nx">is</span> <span class="k">not</span> <span class="nx">otherwise</span> <span class="nx">considered</span>
      <span class="nx">a</span> <span class="nx">literary</span> <span class="k">or</span> <span class="nx">artistic</span> <span class="nx">work</span><span class="o">.</span>

   <span class="nx">g</span><span class="o">.</span> <span class="s2">&quot;You&quot;</span> <span class="nx">means</span> <span class="nx">an</span> <span class="nx">individual</span> <span class="k">or</span> <span class="nx">entity</span> <span class="nx">exercising</span> <span class="nx">rights</span> <span class="nx">under</span>
      <span class="k">this</span> <span class="nx">License</span> <span class="nx">who</span> <span class="nx">has</span> <span class="k">not</span> <span class="nx">previously</span> <span class="nx">violated</span> <span class="nx">the</span> <span class="nx">terms</span> <span class="nx">of</span>
      <span class="k">this</span> <span class="nx">License</span> <span class="nx">with</span> <span class="nx">respect</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">Work</span><span class="p">,</span> <span class="k">or</span> <span class="nx">who</span> <span class="nx">has</span> <span class="nx">received</span>
      <span class="nx">express</span> <span class="nx">permission</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">Licensor</span> <span class="nx">to</span> <span class="nx">exercise</span> <span class="nx">rights</span> <span class="nx">under</span>
      <span class="k">this</span> <span class="nx">License</span> <span class="nx">despite</span> <span class="nx">a</span> <span class="nx">previous</span> <span class="nx">violation</span><span class="o">.</span>

   <span class="nx">h</span><span class="o">.</span> <span class="s2">&quot;Publicly Perform&quot;</span> <span class="nx">means</span> <span class="nx">to</span> <span class="nx">perform</span> <span class="k">public</span> <span class="nx">recitations</span> <span class="nx">of</span> <span class="nx">the</span>
      <span class="nx">Work</span> <span class="k">and</span> <span class="nx">to</span> <span class="nx">communicate</span> <span class="nx">to</span> <span class="nx">the</span> <span class="k">public</span> <span class="nx">those</span> <span class="k">public</span>
      <span class="nx">recitations</span><span class="p">,</span> <span class="nx">by</span> <span class="nx">any</span> <span class="nx">means</span> <span class="k">or</span> <span class="nx">process</span><span class="p">,</span> <span class="nx">including</span> <span class="nx">by</span> <span class="nx">wire</span> <span class="k">or</span>
      <span class="nx">wireless</span> <span class="nx">means</span> <span class="k">or</span> <span class="k">public</span> <span class="nx">digital</span> <span class="nx">performances</span><span class="p">;</span> <span class="nx">to</span> <span class="nx">make</span>
      <span class="nx">available</span> <span class="nx">to</span> <span class="nx">the</span> <span class="k">public</span> <span class="nx">Works</span> <span class="nx">in</span> <span class="nx">such</span> <span class="nx">a</span> <span class="nx">way</span> <span class="nx">that</span> <span class="nx">members</span> <span class="nx">of</span>
      <span class="nx">the</span> <span class="k">public</span> <span class="nx">may</span> <span class="nx">access</span> <span class="nx">these</span> <span class="nx">Works</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">place</span> <span class="k">and</span> <span class="nx">at</span> <span class="nx">a</span> <span class="nx">place</span>
      <span class="nx">individually</span> <span class="nx">chosen</span> <span class="nx">by</span> <span class="nx">them</span><span class="p">;</span> <span class="nx">to</span> <span class="nx">perform</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">to</span> <span class="nx">the</span> <span class="k">public</span>
      <span class="nx">by</span> <span class="nx">any</span> <span class="nx">means</span> <span class="k">or</span> <span class="nx">process</span> <span class="k">and</span> <span class="nx">the</span> <span class="nx">communication</span> <span class="nx">to</span> <span class="nx">the</span> <span class="k">public</span> <span class="nx">of</span>
      <span class="nx">the</span> <span class="nx">performances</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span><span class="p">,</span> <span class="nx">including</span> <span class="nx">by</span> <span class="k">public</span> <span class="nx">digital</span>
      <span class="nx">performance</span><span class="p">;</span> <span class="nx">to</span> <span class="nx">broadcast</span> <span class="k">and</span> <span class="nx">rebroadcast</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">by</span> <span class="nx">any</span>
      <span class="nx">means</span> <span class="nx">including</span> <span class="nx">signs</span><span class="p">,</span> <span class="nx">sounds</span> <span class="k">or</span> <span class="nx">images</span><span class="o">.</span>

   <span class="nx">i</span><span class="o">.</span> <span class="s2">&quot;Reproduce&quot;</span> <span class="nx">means</span> <span class="nx">to</span> <span class="nx">make</span> <span class="nx">copies</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">by</span> <span class="nx">any</span> <span class="nx">means</span>
      <span class="nx">including</span> <span class="nx">without</span> <span class="nx">limitation</span> <span class="nx">by</span> <span class="nx">sound</span> <span class="k">or</span> <span class="nx">visual</span> <span class="nx">recordings</span> <span class="k">and</span>
      <span class="nx">the</span> <span class="nx">right</span> <span class="nx">of</span> <span class="nx">fixation</span> <span class="k">and</span> <span class="nx">reproducing</span> <span class="nx">fixations</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span><span class="p">,</span>
      <span class="nx">including</span> <span class="nx">storage</span> <span class="nx">of</span> <span class="nx">a</span> <span class="k">protected</span> <span class="nx">performance</span> <span class="k">or</span> <span class="nx">phonogram</span> <span class="nx">in</span>
      <span class="nx">digital</span> <span class="nx">form</span> <span class="k">or</span> <span class="nx">other</span> <span class="nx">electronic</span> <span class="nx">medium</span><span class="o">.</span>

<span class="mf">2.</span> <span class="nx">Fair</span> <span class="nx">Dealing</span> <span class="nx">Rights</span><span class="o">.</span> <span class="nx">Nothing</span> <span class="nx">in</span> <span class="k">this</span> <span class="nx">License</span> <span class="nx">is</span> <span class="nx">intended</span> <span class="nx">to</span>
   <span class="nx">reduce</span><span class="p">,</span> <span class="nx">limit</span><span class="p">,</span> <span class="k">or</span> <span class="nx">restrict</span> <span class="nx">any</span> <span class="nx">uses</span> <span class="nx">free</span> <span class="nx">from</span> <span class="nx">copyright</span> <span class="k">or</span> <span class="nx">rights</span>
   <span class="nx">arising</span> <span class="nx">from</span> <span class="nx">limitations</span> <span class="k">or</span> <span class="nx">exceptions</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">provided</span> <span class="k">for</span> <span class="nx">in</span>
   <span class="nx">connection</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">copyright</span> <span class="nx">protection</span> <span class="nx">under</span> <span class="nx">copyright</span> <span class="nx">law</span> <span class="k">or</span>
   <span class="nx">other</span> <span class="nx">applicable</span> <span class="nx">laws</span><span class="o">.</span>

<span class="mf">3.</span> <span class="nx">License</span> <span class="nx">Grant</span><span class="o">.</span> <span class="nx">Subject</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">terms</span> <span class="k">and</span> <span class="nx">conditions</span> <span class="nx">of</span> <span class="k">this</span>
   <span class="nx">License</span><span class="p">,</span> <span class="nx">Licensor</span> <span class="nx">hereby</span> <span class="nx">grants</span> <span class="nx">You</span> <span class="nx">a</span> <span class="nx">worldwide</span><span class="p">,</span> <span class="nx">royalty</span><span class="o">-</span><span class="nx">free</span><span class="p">,</span>
   <span class="nx">non</span><span class="o">-</span><span class="nx">exclusive</span><span class="p">,</span> <span class="nx">perpetual</span> <span class="p">(</span><span class="k">for</span> <span class="nx">the</span> <span class="nx">duration</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">applicable</span>
   <span class="nx">copyright</span><span class="p">)</span> <span class="nx">license</span> <span class="nx">to</span> <span class="nx">exercise</span> <span class="nx">the</span> <span class="nx">rights</span> <span class="nx">in</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">as</span> <span class="nx">stated</span>
   <span class="nx">below</span><span class="o">:</span>

   <span class="nx">a</span><span class="o">.</span> <span class="nx">to</span> <span class="nx">Reproduce</span> <span class="nx">the</span> <span class="nx">Work</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">incorporate</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">into</span> <span class="nx">one</span> <span class="k">or</span>
      <span class="nx">more</span> <span class="nx">Collections</span><span class="p">,</span> <span class="k">and</span> <span class="nx">to</span> <span class="nx">Reproduce</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">as</span> <span class="nx">incorporated</span>
      <span class="nx">in</span> <span class="nx">the</span> <span class="nx">Collections</span><span class="p">;</span>

   <span class="nx">b</span><span class="o">.</span> <span class="nx">to</span> <span class="nx">create</span> <span class="k">and</span> <span class="nx">Reproduce</span> <span class="nx">Adaptations</span> <span class="nx">provided</span> <span class="nx">that</span> <span class="nx">any</span> <span class="nx">such</span>
      <span class="nx">Adaptation</span><span class="p">,</span> <span class="nx">including</span> <span class="nx">any</span> <span class="nx">translation</span> <span class="nx">in</span> <span class="nx">any</span> <span class="nx">medium</span><span class="p">,</span> <span class="nx">takes</span>
      <span class="nx">reasonable</span> <span class="nx">steps</span> <span class="nx">to</span> <span class="nx">clearly</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">demarcate</span> <span class="k">or</span> <span class="nx">otherwise</span>
      <span class="nx">identify</span> <span class="nx">that</span> <span class="nx">changes</span> <span class="nx">were</span> <span class="nx">made</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">original</span> <span class="nx">Work</span><span class="o">.</span> <span class="k">For</span>
      <span class="nx">example</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">translation</span> <span class="nx">could</span> <span class="nx">be</span> <span class="nx">marked</span> <span class="s2">&quot;The original work was</span>
<span class="s2">      translated from English to Spanish,&quot;</span> <span class="k">or</span> <span class="nx">a</span> <span class="nx">modification</span> <span class="nx">could</span>
      <span class="nx">indicate</span> <span class="s2">&quot;The original work has been modified.&quot;</span><span class="p">;</span>

   <span class="nx">c</span><span class="o">.</span> <span class="nx">to</span> <span class="nx">Distribute</span> <span class="k">and</span> <span class="nx">Publicly</span> <span class="nx">Perform</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">including</span> <span class="k">as</span>
      <span class="nx">incorporated</span> <span class="nx">in</span> <span class="nx">Collections</span><span class="p">;</span> <span class="k">and</span><span class="p">,</span>

   <span class="nx">d</span><span class="o">.</span> <span class="nx">to</span> <span class="nx">Distribute</span> <span class="k">and</span> <span class="nx">Publicly</span> <span class="nx">Perform</span> <span class="nx">Adaptations</span><span class="o">.</span>

   <span class="nx">e</span><span class="o">.</span> <span class="k">For</span> <span class="nx">the</span> <span class="nx">avoidance</span> <span class="nx">of</span> <span class="nx">doubt</span><span class="o">:</span>

      <span class="nx">i</span><span class="o">.</span> <span class="nx">Non</span><span class="o">-</span><span class="nx">waivable</span> <span class="nx">Compulsory</span> <span class="nx">License</span> <span class="nx">Schemes</span><span class="o">.</span> <span class="nx">In</span> <span class="nx">those</span>
         <span class="nx">jurisdictions</span> <span class="nx">in</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">right</span> <span class="nx">to</span> <span class="nx">collect</span> <span class="nx">royalties</span>
         <span class="nx">through</span> <span class="nx">any</span> <span class="nx">statutory</span> <span class="k">or</span> <span class="nx">compulsory</span> <span class="nx">licensing</span> <span class="nx">scheme</span> <span class="nx">cannot</span>
         <span class="nx">be</span> <span class="nx">waived</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">Licensor</span> <span class="nx">reserves</span> <span class="nx">the</span> <span class="nx">exclusive</span> <span class="nx">right</span> <span class="nx">to</span>
         <span class="nx">collect</span> <span class="nx">such</span> <span class="nx">royalties</span> <span class="k">for</span> <span class="nx">any</span> <span class="nx">exercise</span> <span class="nx">by</span> <span class="nx">You</span> <span class="nx">of</span> <span class="nx">the</span>
         <span class="nx">rights</span> <span class="nx">granted</span> <span class="nx">under</span> <span class="k">this</span> <span class="nx">License</span><span class="p">;</span>

      <span class="nx">ii</span><span class="o">.</span> <span class="nx">Waivable</span> <span class="nx">Compulsory</span> <span class="nx">License</span> <span class="nx">Schemes</span><span class="o">.</span> <span class="nx">In</span> <span class="nx">those</span>
          <span class="nx">jurisdictions</span> <span class="nx">in</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">right</span> <span class="nx">to</span> <span class="nx">collect</span> <span class="nx">royalties</span>
          <span class="nx">through</span> <span class="nx">any</span> <span class="nx">statutory</span> <span class="k">or</span> <span class="nx">compulsory</span> <span class="nx">licensing</span> <span class="nx">scheme</span> <span class="nx">can</span>
          <span class="nx">be</span> <span class="nx">waived</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">Licensor</span> <span class="nx">waives</span> <span class="nx">the</span> <span class="nx">exclusive</span> <span class="nx">right</span> <span class="nx">to</span>
          <span class="nx">collect</span> <span class="nx">such</span> <span class="nx">royalties</span> <span class="k">for</span> <span class="nx">any</span> <span class="nx">exercise</span> <span class="nx">by</span> <span class="nx">You</span> <span class="nx">of</span> <span class="nx">the</span>
          <span class="nx">rights</span> <span class="nx">granted</span> <span class="nx">under</span> <span class="k">this</span> <span class="nx">License</span><span class="p">;</span> <span class="k">and</span><span class="p">,</span>

      <span class="nx">iii</span><span class="o">.</span> <span class="nx">Voluntary</span> <span class="nx">License</span> <span class="nx">Schemes</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">Licensor</span> <span class="nx">waives</span> <span class="nx">the</span> <span class="nx">right</span>
           <span class="nx">to</span> <span class="nx">collect</span> <span class="nx">royalties</span><span class="p">,</span> <span class="nx">whether</span> <span class="nx">individually</span> <span class="k">or</span><span class="p">,</span> <span class="nx">in</span> <span class="nx">the</span>
           <span class="nx">event</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">Licensor</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">member</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">collecting</span>
           <span class="nx">society</span> <span class="nx">that</span> <span class="nx">administers</span> <span class="nx">voluntary</span> <span class="nx">licensing</span> <span class="nx">schemes</span><span class="p">,</span> <span class="nx">via</span>
           <span class="nx">that</span> <span class="nx">society</span><span class="p">,</span> <span class="nx">from</span> <span class="nx">any</span> <span class="nx">exercise</span> <span class="nx">by</span> <span class="nx">You</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">rights</span>
           <span class="nx">granted</span> <span class="nx">under</span> <span class="k">this</span> <span class="nx">License</span><span class="o">.</span>

<span class="nx">The</span> <span class="nx">above</span> <span class="nx">rights</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">exercised</span> <span class="nx">in</span> <span class="nx">all</span> <span class="nx">media</span> <span class="k">and</span> <span class="nx">formats</span> <span class="nx">whether</span>
<span class="nx">now</span> <span class="nx">known</span> <span class="k">or</span> <span class="nx">hereafter</span> <span class="nx">devised</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">above</span> <span class="nx">rights</span> <span class="k">include</span> <span class="nx">the</span> <span class="nx">right</span>
<span class="nx">to</span> <span class="nx">make</span> <span class="nx">such</span> <span class="nx">modifications</span> <span class="k">as</span> <span class="nx">are</span> <span class="nx">technically</span> <span class="nx">necessary</span> <span class="nx">to</span> <span class="nx">exercise</span>
<span class="nx">the</span> <span class="nx">rights</span> <span class="nx">in</span> <span class="nx">other</span> <span class="nx">media</span> <span class="k">and</span> <span class="nx">formats</span><span class="o">.</span> <span class="nx">Subject</span> <span class="nx">to</span> <span class="nx">Section</span> <span class="mi">8</span><span class="p">(</span><span class="nx">f</span><span class="p">),</span> <span class="nx">all</span>
<span class="nx">rights</span> <span class="k">not</span> <span class="nx">expressly</span> <span class="nx">granted</span> <span class="nx">by</span> <span class="nx">Licensor</span> <span class="nx">are</span> <span class="nx">hereby</span> <span class="nx">reserved</span><span class="o">.</span>

<span class="mf">4.</span> <span class="nx">Restrictions</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">license</span> <span class="nx">granted</span> <span class="nx">in</span> <span class="nx">Section</span> <span class="mi">3</span> <span class="nx">above</span> <span class="nx">is</span> <span class="nx">expressly</span>
   <span class="nx">made</span> <span class="nx">subject</span> <span class="nx">to</span> <span class="k">and</span> <span class="nx">limited</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">restrictions</span><span class="o">:</span>

   <span class="nx">a</span><span class="o">.</span> <span class="nx">You</span> <span class="nx">may</span> <span class="nx">Distribute</span> <span class="k">or</span> <span class="nx">Publicly</span> <span class="nx">Perform</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">only</span> <span class="nx">under</span> <span class="nx">the</span>
      <span class="nx">terms</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">License</span><span class="o">.</span> <span class="nx">You</span> <span class="nx">must</span> <span class="k">include</span> <span class="nx">a</span> <span class="nb">copy</span> <span class="nx">of</span><span class="p">,</span> <span class="k">or</span> <span class="nx">the</span>
      <span class="nx">Uniform</span> <span class="nx">Resource</span> <span class="nx">Identifier</span> <span class="p">(</span><span class="nx">URI</span><span class="p">)</span> <span class="k">for</span><span class="p">,</span> <span class="k">this</span> <span class="nx">License</span> <span class="nx">with</span> <span class="nx">every</span>
      <span class="nb">copy</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">You</span> <span class="nx">Distribute</span> <span class="k">or</span> <span class="nx">Publicly</span> <span class="nx">Perform</span><span class="o">.</span> <span class="nx">You</span> <span class="nx">may</span>
      <span class="k">not</span> <span class="nx">offer</span> <span class="k">or</span> <span class="nx">impose</span> <span class="nx">any</span> <span class="nx">terms</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">that</span> <span class="nx">restrict</span> <span class="nx">the</span>
      <span class="nx">terms</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">License</span> <span class="k">or</span> <span class="nx">the</span> <span class="nx">ability</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">recipient</span> <span class="nx">of</span> <span class="nx">the</span>
      <span class="nx">Work</span> <span class="nx">to</span> <span class="nx">exercise</span> <span class="nx">the</span> <span class="nx">rights</span> <span class="nx">granted</span> <span class="nx">to</span> <span class="nx">that</span> <span class="nx">recipient</span> <span class="nx">under</span>
      <span class="nx">the</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">License</span><span class="o">.</span> <span class="nx">You</span> <span class="nx">may</span> <span class="k">not</span> <span class="nx">sublicense</span> <span class="nx">the</span> <span class="nx">Work</span><span class="o">.</span> <span class="nx">You</span>
      <span class="nx">must</span> <span class="nx">keep</span> <span class="nx">intact</span> <span class="nx">all</span> <span class="nx">notices</span> <span class="nx">that</span> <span class="nx">refer</span> <span class="nx">to</span> <span class="k">this</span> <span class="nx">License</span> <span class="k">and</span> <span class="nx">to</span>
      <span class="nx">the</span> <span class="nx">disclaimer</span> <span class="nx">of</span> <span class="nx">warranties</span> <span class="nx">with</span> <span class="nx">every</span> <span class="nb">copy</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">You</span>
      <span class="nx">Distribute</span> <span class="k">or</span> <span class="nx">Publicly</span> <span class="nx">Perform</span><span class="o">.</span> <span class="nx">When</span> <span class="nx">You</span> <span class="nx">Distribute</span> <span class="k">or</span>
      <span class="nx">Publicly</span> <span class="nx">Perform</span> <span class="nx">the</span> <span class="nx">Work</span><span class="p">,</span> <span class="nx">You</span> <span class="nx">may</span> <span class="k">not</span> <span class="nx">impose</span> <span class="nx">any</span> <span class="nx">effective</span>
      <span class="nx">technological</span> <span class="nx">measures</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">that</span> <span class="nx">restrict</span> <span class="nx">the</span> <span class="nx">ability</span>
      <span class="nx">of</span> <span class="nx">a</span> <span class="nx">recipient</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">from</span> <span class="nx">You</span> <span class="nx">to</span> <span class="nx">exercise</span> <span class="nx">the</span> <span class="nx">rights</span>
      <span class="nx">granted</span> <span class="nx">to</span> <span class="nx">that</span> <span class="nx">recipient</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">License</span><span class="o">.</span> <span class="k">This</span>
      <span class="nx">Section</span> <span class="mi">4</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="nx">applies</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">as</span> <span class="nx">incorporated</span> <span class="nx">in</span> <span class="nx">a</span>
      <span class="nx">Collection</span><span class="p">,</span> <span class="nx">but</span> <span class="k">this</span> <span class="nx">does</span> <span class="k">not</span> <span class="k">require</span> <span class="nx">the</span> <span class="nx">Collection</span> <span class="nx">apart</span>
      <span class="nx">from</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="nx">itself</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">made</span> <span class="nx">subject</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="k">this</span>
      <span class="nx">License</span><span class="o">.</span> <span class="k">If</span> <span class="nx">You</span> <span class="nx">create</span> <span class="nx">a</span> <span class="nx">Collection</span><span class="p">,</span> <span class="nx">upon</span> <span class="nx">notice</span> <span class="nx">from</span> <span class="nx">any</span>
      <span class="nx">Licensor</span> <span class="nx">You</span> <span class="nx">must</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">extent</span> <span class="nx">practicable</span><span class="p">,</span> <span class="nx">remove</span> <span class="nx">from</span> <span class="nx">the</span>
      <span class="nx">Collection</span> <span class="nx">any</span> <span class="nx">credit</span> <span class="k">as</span> <span class="nx">required</span> <span class="nx">by</span> <span class="nx">Section</span> <span class="mi">4</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="k">as</span>
      <span class="nx">requested</span><span class="o">.</span> <span class="k">If</span> <span class="nx">You</span> <span class="nx">create</span> <span class="nx">an</span> <span class="nx">Adaptation</span><span class="p">,</span> <span class="nx">upon</span> <span class="nx">notice</span> <span class="nx">from</span> <span class="nx">any</span>
      <span class="nx">Licensor</span> <span class="nx">You</span> <span class="nx">must</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">extent</span> <span class="nx">practicable</span><span class="p">,</span> <span class="nx">remove</span> <span class="nx">from</span> <span class="nx">the</span>
      <span class="nx">Adaptation</span> <span class="nx">any</span> <span class="nx">credit</span> <span class="k">as</span> <span class="nx">required</span> <span class="nx">by</span> <span class="nx">Section</span> <span class="mi">4</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="k">as</span> <span class="nx">requested</span><span class="o">.</span>

   <span class="nx">b</span><span class="o">.</span> <span class="k">If</span> <span class="nx">You</span> <span class="nx">Distribute</span><span class="p">,</span> <span class="k">or</span> <span class="nx">Publicly</span> <span class="nx">Perform</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">or</span> <span class="nx">any</span>
      <span class="nx">Adaptations</span> <span class="k">or</span> <span class="nx">Collections</span><span class="p">,</span> <span class="nx">You</span> <span class="nx">must</span><span class="p">,</span> <span class="nx">unless</span> <span class="nx">a</span> <span class="nx">request</span> <span class="nx">has</span>
      <span class="nx">been</span> <span class="nx">made</span> <span class="nx">pursuant</span> <span class="nx">to</span> <span class="nx">Section</span> <span class="mi">4</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">keep</span> <span class="nx">intact</span> <span class="nx">all</span> <span class="nx">copyright</span>
      <span class="nx">notices</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">Work</span> <span class="k">and</span> <span class="nx">provide</span><span class="p">,</span> <span class="nx">reasonable</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">medium</span> <span class="k">or</span>
      <span class="nx">means</span> <span class="nx">You</span> <span class="nx">are</span> <span class="nx">utilizing</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">the</span> <span class="nx">name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">Original</span> <span class="nx">Author</span>
      <span class="p">(</span><span class="k">or</span> <span class="nx">pseudonym</span><span class="p">,</span> <span class="k">if</span> <span class="nx">applicable</span><span class="p">)</span> <span class="k">if</span> <span class="nx">supplied</span><span class="p">,</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="k">if</span> <span class="nx">the</span>
      <span class="nx">Original</span> <span class="nx">Author</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="nx">Licensor</span> <span class="nx">designate</span> <span class="nx">another</span> <span class="nx">party</span> <span class="k">or</span>
      <span class="nx">parties</span> <span class="p">(</span><span class="nx">e</span><span class="o">.</span><span class="nx">g</span><span class="o">.</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">sponsor</span> <span class="nx">institute</span><span class="p">,</span> <span class="nx">publishing</span> <span class="nx">entity</span><span class="p">,</span>
      <span class="nx">journal</span><span class="p">)</span> <span class="k">for</span> <span class="nx">attribution</span> <span class="p">(</span><span class="s2">&quot;Attribution Parties&quot;</span><span class="p">)</span> <span class="nx">in</span> <span class="nx">Licensor</span><span class="s1">&#39;s</span>
<span class="s1">      copyright notice, terms of service or by other reasonable</span>
<span class="s1">      means, the name of such party or parties; (ii) the title of</span>
<span class="s1">      the Work if supplied; (iii) to the extent reasonably</span>
<span class="s1">      practicable, the URI, if any, that Licensor specifies to be</span>
<span class="s1">      associated with the Work, unless such URI does not refer to</span>
<span class="s1">      the copyright notice or licensing information for the Work;</span>
<span class="s1">      and (iv), consistent with Section 3(b), in the case of an</span>
<span class="s1">      Adaptation, a credit identifying the use of the Work in the</span>
<span class="s1">      Adaptation (e.g., &quot;French translation of the Work by Original</span>
<span class="s1">      Author,&quot; or &quot;Screenplay based on original Work by Original</span>
<span class="s1">      Author&quot;). The credit required by this Section 4 (b) may be</span>
<span class="s1">      implemented in any reasonable manner; provided, however, that</span>
<span class="s1">      in the case of a Adaptation or Collection, at a minimum such</span>
<span class="s1">      credit will appear, if a credit for all contributing authors</span>
<span class="s1">      of the Adaptation or Collection appears, then as part of these</span>
<span class="s1">      credits and in a manner at least as prominent as the credits</span>
<span class="s1">      for the other contributing authors. For the avoidance of</span>
<span class="s1">      doubt, You may only use the credit required by this Section</span>
<span class="s1">      for the purpose of attribution in the manner set out above</span>
<span class="s1">      and, by exercising Your rights under this License, You may not</span>
<span class="s1">      implicitly or explicitly assert or imply any connection with,</span>
<span class="s1">      sponsorship or endorsement by the Original Author, Licensor</span>
<span class="s1">      and/or Attribution Parties, as appropriate, of You or Your use</span>
<span class="s1">      of the Work, without the separate, express prior written</span>
<span class="s1">      permission of the Original Author, Licensor and/or</span>
<span class="s1">      Attribution Parties.</span>

<span class="s1">   c. Except as otherwise agreed in writing by the Licensor or as</span>
<span class="s1">      may be otherwise permitted by applicable law, if You</span>
<span class="s1">      Reproduce, Distribute or Publicly Perform the Work either by</span>
<span class="s1">      itself or as part of any Adaptations or Collections, You must</span>
<span class="s1">      not distort, mutilate, modify or take other derogatory action</span>
<span class="s1">      in relation to the Work which would be prejudicial to the</span>
<span class="s1">      Original Author&#39;</span><span class="nx">s</span> <span class="nx">honor</span> <span class="k">or</span> <span class="nx">reputation</span><span class="o">.</span> <span class="nx">Licensor</span> <span class="nx">agrees</span> <span class="nx">that</span> <span class="nx">in</span>
      <span class="nx">those</span> <span class="nx">jurisdictions</span> <span class="p">(</span><span class="nx">e</span><span class="o">.</span><span class="nx">g</span><span class="o">.</span> <span class="nx">Japan</span><span class="p">),</span> <span class="nx">in</span> <span class="nx">which</span> <span class="nx">any</span> <span class="nx">exercise</span> <span class="nx">of</span> <span class="nx">the</span>
      <span class="nx">right</span> <span class="nx">granted</span> <span class="nx">in</span> <span class="nx">Section</span> <span class="mi">3</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">License</span> <span class="p">(</span><span class="nx">the</span> <span class="nx">right</span> <span class="nx">to</span>
      <span class="nx">make</span> <span class="nx">Adaptations</span><span class="p">)</span> <span class="nx">would</span> <span class="nx">be</span> <span class="nx">deemed</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">distortion</span><span class="p">,</span>
      <span class="nx">mutilation</span><span class="p">,</span> <span class="nx">modification</span> <span class="k">or</span> <span class="nx">other</span> <span class="nx">derogatory</span> <span class="nx">action</span>
      <span class="nx">prejudicial</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">Original</span> <span class="nx">Author</span><span class="s1">&#39;s honor and reputation, the</span>
<span class="s1">      Licensor will waive or not assert, as appropriate, this</span>
<span class="s1">      Section, to the fullest extent permitted by the applicable</span>
<span class="s1">      national law, to enable You to reasonably exercise Your right</span>
<span class="s1">      under Section 3(b) of this License (right to make Adaptations)</span>
<span class="s1">      but not otherwise.</span>

<span class="s1">5. Representations, Warranties and Disclaimer</span>

<span class="s1">UNLESS OTHERWISE MUTUALLY AGREED TO BY THE PARTIES IN WRITING,</span>
<span class="s1">LICENSOR OFFERS THE WORK AS-IS AND MAKES NO REPRESENTATIONS OR</span>
<span class="s1">WARRANTIES OF ANY KIND CONCERNING THE WORK, EXPRESS, IMPLIED,</span>
<span class="s1">STATUTORY OR OTHERWISE, INCLUDING, WITHOUT LIMITATION, WARRANTIES OF</span>
<span class="s1">TITLE, MERCHANTIBILITY, FITNESS FOR A PARTICULAR PURPOSE,</span>
<span class="s1">NONINFRINGEMENT, OR THE ABSENCE OF LATENT OR OTHER DEFECTS,</span>
<span class="s1">ACCURACY, OR THE PRESENCE OF ABSENCE OF ERRORS, WHETHER OR NOT</span>
<span class="s1">DISCOVERABLE. SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION OF</span>
<span class="s1">IMPLIED WARRANTIES, SO SUCH EXCLUSION MAY NOT APPLY TO YOU.</span>

<span class="s1">6. Limitation on Liability. EXCEPT TO THE EXTENT REQUIRED BY</span>
<span class="s1">   APPLICABLE LAW, IN NO EVENT WILL LICENSOR BE LIABLE TO YOU ON ANY</span>
<span class="s1">   LEGAL THEORY FOR ANY SPECIAL, INCIDENTAL, CONSEQUENTIAL, PUNITIVE</span>
<span class="s1">   OR EXEMPLARY DAMAGES ARISING OUT OF THIS LICENSE OR THE USE OF</span>
<span class="s1">   THE WORK, EVEN IF LICENSOR HAS BEEN ADVISED OF THE POSSIBILITY</span>
<span class="s1">   OF SUCH DAMAGES.</span>

<span class="s1">7. Termination</span>

<span class="s1">   a. This License and the rights granted hereunder will terminate</span>
<span class="s1">      automatically upon any breach by You of the terms of this</span>
<span class="s1">      License. Individuals or entities who have received Adaptations</span>
<span class="s1">      or Collections from You under this License, however, will not</span>
<span class="s1">      have their licenses terminated provided such individuals or</span>
<span class="s1">      entities remain in full compliance with those licenses.</span>
<span class="s1">      Sections 1, 2, 5, 6, 7, and 8 will survive any termination of</span>
<span class="s1">      this License.</span>

<span class="s1">   b. Subject to the above terms and conditions, the license granted</span>
<span class="s1">      here is perpetual (for the duration of the applicable</span>
<span class="s1">      copyright in the Work). Notwithstanding the above, Licensor</span>
<span class="s1">      reserves the right to release the Work under different license</span>
<span class="s1">      terms or to stop distributing the Work at any time; provided,</span>
<span class="s1">      however that any such election will not serve to withdraw this</span>
<span class="s1">      License (or any other license that has been, or is required to</span>
<span class="s1">      be, granted under the terms of this License), and this License</span>
<span class="s1">      will continue in full force and effect unless terminated as</span>
<span class="s1">      stated above.</span>

<span class="s1">8. Miscellaneous</span>

<span class="s1">   a. Each time You Distribute or Publicly Perform the Work or a</span>
<span class="s1">      Collection, the Licensor offers to the recipient a license to</span>
<span class="s1">      the Work on the same terms and conditions as the license</span>
<span class="s1">      granted to You under this License.</span>

<span class="s1">   b. Each time You Distribute or Publicly Perform an Adaptation,</span>
<span class="s1">      Licensor offers to the recipient a license to the original</span>
<span class="s1">      Work on the same terms and conditions as the license granted</span>
<span class="s1">      to You under this License.</span>

<span class="s1">   c. If any provision of this License is invalid or unenforceable</span>
<span class="s1">      under applicable law, it shall not affect the validity or</span>
<span class="s1">      enforceability of the remainder of the terms of this License,</span>
<span class="s1">      and without further action by the parties to this agreement,</span>
<span class="s1">      such provision shall be reformed to the minimum extent</span>
<span class="s1">      necessary to make such provision valid and enforceable.</span>

<span class="s1">   d. No term or provision of this License shall be deemed waived</span>
<span class="s1">      and no breach consented to unless such waiver or consent shall</span>
<span class="s1">      be in writing and signed by the party to be charged with such</span>
<span class="s1">      waiver or consent.</span>

<span class="s1">   e. This License constitutes the entire agreement between the</span>
<span class="s1">      parties with respect to the Work licensed here. There are no</span>
<span class="s1">      understandings, agreements or representations with respect to</span>
<span class="s1">      the Work not specified here. Licensor shall not be bound by</span>
<span class="s1">      any additional provisions that may appear in any communication</span>
<span class="s1">      from You. This License may not be modified without the mutual</span>
<span class="s1">      written agreement of the Licensor and You.</span>

<span class="s1">   f. The rights granted under, and the subject matter referenced,</span>
<span class="s1">      in this License were drafted utilizing the terminology of the</span>
<span class="s1">      Berne Convention for the Protection of Literary and Artistic</span>
<span class="s1">      Works (as amended on September 28, 1979), the Rome Convention</span>
<span class="s1">      of 1961, the WIPO Copyright Treaty of 1996, the WIPO</span>
<span class="s1">      Performances and Phonograms Treaty of 1996 and the Universal</span>
<span class="s1">      Copyright Convention (as revised on July 24, 1971). These</span>
<span class="s1">      rights and subject matter take effect in the relevant</span>
<span class="s1">      jurisdiction in which the License terms are sought to be</span>
<span class="s1">      enforced according to the corresponding provisions of the</span>
<span class="s1">      implementation of those treaty provisions in the applicable</span>
<span class="s1">      national law. If the standard suite of rights granted under</span>
<span class="s1">      applicable copyright law includes additional rights not</span>
<span class="s1">      granted under this License, such additional rights are deemed</span>
<span class="s1">      to be included in the License; this License is not intended to</span>
<span class="s1">      restrict the license of any rights under applicable law.</span>

<span class="s1">Creative Commons is not a party to this License, and makes no</span>
<span class="s1">warranty whatsoever in connection with the Work. Creative Commons</span>
<span class="s1">will not be liable to You or any party on any legal theory for any</span>
<span class="s1">damages whatsoever, including without limitation any general,</span>
<span class="s1">special, incidental or consequential damages arising in connection</span>
<span class="s1">to this license. Notwithstanding the foregoing two (2) sentences,</span>
<span class="s1">if Creative Commons has expressly identified itself as the Licensor</span>
<span class="s1">hereunder, it shall have all rights and obligations of Licensor.</span>

<span class="s1">Except for the limited purpose of indicating to the public that the</span>
<span class="s1">Work is licensed under the CCPL, Creative Commons does not authorize</span>
<span class="s1">the use by either party of the trademark &quot;Creative Commons&quot; or any</span>
<span class="s1">related trademark or logo of Creative Commons without the prior</span>
<span class="s1">written consent of Creative Commons. Any permitted use will be in</span>
<span class="s1">compliance with Creative Commons&#39;</span> <span class="nx">then</span><span class="o">-</span><span class="nb">current</span> <span class="nx">trademark</span> <span class="nx">usage</span>
<span class="nx">guidelines</span><span class="p">,</span> <span class="k">as</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">published</span> <span class="nx">on</span> <span class="nx">its</span> <span class="nx">website</span> <span class="k">or</span> <span class="nx">otherwise</span> <span class="nx">made</span>
<span class="nx">available</span> <span class="nx">upon</span> <span class="nx">request</span> <span class="nx">from</span> <span class="nb">time</span> <span class="nx">to</span> <span class="nb">time</span><span class="o">.</span> <span class="k">For</span> <span class="nx">the</span> <span class="nx">avoidance</span> <span class="nx">of</span>
<span class="nx">doubt</span><span class="p">,</span> <span class="k">this</span> <span class="nx">trademark</span> <span class="nx">restriction</span> <span class="nx">does</span> <span class="k">not</span> <span class="nx">form</span> <span class="nx">part</span> <span class="nx">of</span> <span class="k">this</span>
<span class="nx">License</span><span class="o">.</span>

<span class="nx">Creative</span> <span class="nx">Commons</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">contacted</span> <span class="nx">at</span> <span class="nx">http</span><span class="o">://</span><span class="nx">creativecommons</span><span class="o">.</span><span class="nx">org</span><span class="o">/.</span>

<span class="o">====================================================================</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="index.html#document-copyright">Copyright</a> 2018, Sebastian Bergmann
      
        <span class="commit">
          Revision <code>a2b51dd9</code>.
        </span>
      

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/zh_CN/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//phpunit.readthedocs.io/_/downloads/zh_CN/latest/htmlzip/">html</a></dd>
        
          <dd><a href="//phpunit.readthedocs.io/_/downloads/zh_CN/latest/epub/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/phpunit-chinese/?fromdocs=phpunit-chinese">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/phpunit-chinese/?fromdocs=phpunit-chinese">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>