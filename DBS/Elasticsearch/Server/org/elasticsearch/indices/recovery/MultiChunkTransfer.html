<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>MultiChunkTransfer (server 7.11.1 API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<meta name="description" content="declaration: package: org.elasticsearch.indices.recovery, class: MultiChunkTransfer">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../script-dir/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../script-dir/jquery-3.4.1.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.js"></script>
</head>
<body class="class-declaration">
<script type="text/javascript">var data = {"i0":6,"i1":6,"i2":6,"i3":10,"i4":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flexBox">
<header role="banner" class="flexHeader">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<div class="navListSearch"><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="skipNav"><a id="skip.navbar.top">
<!--   -->
</a></div>
</nav>
</header>
<div class="flexContent">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.elasticsearch.indices.recovery</a></div>
<h1 title="Class MultiChunkTransfer" class="title">Class MultiChunkTransfer&lt;Source,&#8203;Request extends <a href="MultiChunkTransfer.ChunkRequest.html" title="interface in org.elasticsearch.indices.recovery">MultiChunkTransfer.ChunkRequest</a>&gt;</h1>
</div>
<div class="contentContainer">
<div class="inheritance" title="Inheritance Tree">java.lang.Object
<div class="inheritance">org.elasticsearch.indices.recovery.MultiChunkTransfer&lt;Source,&#8203;Request&gt;</div>
</div>
<section class="description">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><code>java.io.Closeable</code>, <code>java.lang.AutoCloseable</code></dd>
</dl>
<hr>
<pre>public abstract class <span class="typeNameLabel">MultiChunkTransfer&lt;Source,&#8203;Request extends <a href="MultiChunkTransfer.ChunkRequest.html" title="interface in org.elasticsearch.indices.recovery">MultiChunkTransfer.ChunkRequest</a>&gt;</span>
extends java.lang.Object
implements java.io.Closeable</pre>
<div class="block">File chunks are sent/requested sequentially by at most one thread at any time. However, the sender/requestor won't wait for the response
 before processing the next file chunk request to reduce the recovery time especially on secure/compressed or high latency communication.
 <p>
 The sender/requestor can send up to <code>maxConcurrentFileChunks</code> file chunk requests without waiting for responses. Since the recovery
 target can receive file chunks out of order, it has to buffer those file chunks in memory and only flush to disk when there's no gap.
 To ensure the recover target never buffers more than <code>maxConcurrentFileChunks</code> file chunks, we allow the sender/requestor to send
 only up to <code>maxConcurrentFileChunks</code> file chunk requests from the last flushed (and acknowledged) file chunk. We leverage the local
 checkpoint tracker for this purpose. We generate a new sequence number and assign it to each file chunk request before sending; then mark
 that sequence number as processed when we receive a response for the corresponding file chunk request. With the local checkpoint tracker,
 we know the last acknowledged-flushed file-chunk is a file chunk whose <code>requestSeqId</code> equals to the local checkpoint because the
 recover target can flush all file chunks up to the local checkpoint.
 <p>
 When the number of un-replied file chunk requests reaches the limit (i.e. the gap between the max_seq_no and the local checkpoint is
 greater than <code>maxConcurrentFileChunks</code>), the sending/requesting thread will abort its execution. That process will be resumed by
 one of the networking threads which receive/handle the responses of the current pending file chunk requests. This process will continue
 until all chunk requests are sent/responded.</div>
</section>
<section class="summary">
<ul class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li class="blockList">
<section class="nestedClassSummary"><a id="nested.class.summary">
<!--   -->
</a>
<h2>Nested Class Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="MultiChunkTransfer.ChunkRequest.html" title="interface in org.elasticsearch.indices.recovery">MultiChunkTransfer.ChunkRequest</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li class="blockList">
<section class="constructorSummary"><a id="constructor.summary">
<!--   -->
</a>
<h2>Constructor Summary</h2>
<div class="memberSummary">
<table>
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<thead>
<tr>
<th class="colFirst" scope="col">Modifier</th>
<th class="colSecond" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor">
<td class="colFirst"><code>protected </code></td>
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(org.apache.logging.log4j.Logger,org.elasticsearch.common.util.concurrent.ThreadContext,org.elasticsearch.action.ActionListener,int,java.util.List)">MultiChunkTransfer</a></span>&#8203;(org.apache.logging.log4j.Logger&nbsp;logger,
<a href="../../common/util/concurrent/ThreadContext.html" title="class in org.elasticsearch.common.util.concurrent">ThreadContext</a>&nbsp;threadContext,
<a href="../../action/ActionListener.html" title="interface in org.elasticsearch.action">ActionListener</a>&lt;java.lang.Void&gt;&nbsp;listener,
int&nbsp;maxConcurrentChunks,
java.util.List&lt;<a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&gt;&nbsp;sources)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li class="blockList">
<section class="methodSummary"><a id="method.summary">
<!--   -->
</a>
<h2>Method Summary</h2>
<div class="memberSummary">
<div role="tablist" aria-orientation="horizontal"><button role="tab" aria-selected="true" aria-controls="memberSummary_tabpanel" tabindex="0" onkeydown="switchTab(event)" id="t0" class="activeTableTab">All Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t2" class="tableTab" onclick="show(2);">Instance Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t3" class="tableTab" onclick="show(4);">Abstract Methods</button><button role="tab" aria-selected="false" aria-controls="memberSummary_tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t4" class="tableTab" onclick="show(8);">Concrete Methods</button></div>
<div id="memberSummary_tabpanel" role="tabpanel">
<table aria-labelledby="t0">
<thead>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="altColor" id="i0">
<td class="colFirst"><code>protected abstract void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#executeChunkRequest(Request,org.elasticsearch.action.ActionListener)">executeChunkRequest</a></span>&#8203;(<a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Request</a>&nbsp;request,
<a href="../../action/ActionListener.html" title="interface in org.elasticsearch.action">ActionListener</a>&lt;java.lang.Void&gt;&nbsp;listener)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i1">
<td class="colFirst"><code>protected abstract void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#handleError(Source,java.lang.Exception)">handleError</a></span>&#8203;(<a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&nbsp;resource,
java.lang.Exception&nbsp;e)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor" id="i2">
<td class="colFirst"><code>protected abstract <a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Request</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#nextChunkRequest(Source)">nextChunkRequest</a></span>&#8203;(<a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&nbsp;resource)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor" id="i3">
<td class="colFirst"><code>protected void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#onNewResource(Source)">onNewResource</a></span>&#8203;(<a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&nbsp;resource)</code></th>
<td class="colLast">
<div class="block">This method is called when starting sending/requesting a new source.</div>
</td>
</tr>
<tr class="altColor" id="i4">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#start()">start</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="inheritedList">
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a><code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></div>
<div class="inheritedList">
<h3>Methods inherited from interface&nbsp;java.io.Closeable</h3>
<a id="methods.inherited.from.class.java.io.Closeable">
<!--   -->
</a><code>close</code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li class="blockList">
<section class="constructorDetails"><a id="constructor.detail">
<!--   -->
</a>
<h2>Constructor Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="&lt;init&gt;(org.apache.logging.log4j.Logger,org.elasticsearch.common.util.concurrent.ThreadContext,org.elasticsearch.action.ActionListener,int,java.util.List)">MultiChunkTransfer</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="memberName">MultiChunkTransfer</span>&#8203;(<span class="arguments">org.apache.logging.log4j.Logger&nbsp;logger,
<a href="../../common/util/concurrent/ThreadContext.html" title="class in org.elasticsearch.common.util.concurrent">ThreadContext</a>&nbsp;threadContext,
<a href="../../action/ActionListener.html" title="interface in org.elasticsearch.action">ActionListener</a>&lt;java.lang.Void&gt;&nbsp;listener,
int&nbsp;maxConcurrentChunks,
java.util.List&lt;<a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&gt;&nbsp;sources)</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li class="blockList">
<section class="methodDetails"><a id="method.detail">
<!--   -->
</a>
<h2>Method Details</h2>
<ul class="blockList">
<li class="blockList">
<section class="detail">
<h3><a id="start()">start</a></h3>
<div class="memberSignature"><span class="modifiers">public final</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">start</span>()</div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="onNewResource(java.lang.Object)">
<!--   -->
</a><a id="onNewResource(Source)">onNewResource</a></h3>
<div class="memberSignature"><span class="modifiers">protected</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">onNewResource</span>&#8203;(<span class="arguments"><a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&nbsp;resource)</span>
                      throws <span class="exceptions">java.io.IOException</span></div>
<div class="block">This method is called when starting sending/requesting a new source. Subclasses should override
 this method to reset the file offset or close the previous file and open a new file if needed.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="nextChunkRequest(java.lang.Object)">
<!--   -->
</a><a id="nextChunkRequest(Source)">nextChunkRequest</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType"><a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Request</a></span>&nbsp;<span class="memberName">nextChunkRequest</span>&#8203;(<span class="arguments"><a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&nbsp;resource)</span>
                                     throws <span class="exceptions">java.io.IOException</span></div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="executeChunkRequest(org.elasticsearch.indices.recovery.MultiChunkTransfer.ChunkRequest,org.elasticsearch.action.ActionListener)">
<!--   -->
</a><a id="executeChunkRequest(Request,org.elasticsearch.action.ActionListener)">executeChunkRequest</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">executeChunkRequest</span>&#8203;(<span class="arguments"><a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Request</a>&nbsp;request,
<a href="../../action/ActionListener.html" title="interface in org.elasticsearch.action">ActionListener</a>&lt;java.lang.Void&gt;&nbsp;listener)</span></div>
</section>
</li>
<li class="blockList">
<section class="detail">
<h3><a id="handleError(java.lang.Object,java.lang.Exception)">
<!--   -->
</a><a id="handleError(Source,java.lang.Exception)">handleError</a></h3>
<div class="memberSignature"><span class="modifiers">protected abstract</span>&nbsp;<span class="returnType">void</span>&nbsp;<span class="memberName">handleError</span>&#8203;(<span class="arguments"><a href="MultiChunkTransfer.html" title="type parameter in MultiChunkTransfer">Source</a>&nbsp;resource,
java.lang.Exception&nbsp;e)</span>
                             throws <span class="exceptions">java.lang.Exception</span></div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
</div>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</div>
</div>
</body>
</html>
